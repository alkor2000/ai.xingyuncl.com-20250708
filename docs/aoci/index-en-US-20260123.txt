===AI Application Platform Complete AOCI Index-20260127===

[AOCI Index Description]
This index is designed for AI attention mechanism to quickly understand the system overview, content should be concise and accurate

[Format & Rules]
Format: filename[tags]: F:Function | R:Related files | A:API path | S:Summary
Edge files (edge files that don't need indexing, listed at the end of each module with full path and filename, omit if none)
Version history only keeps latest feature description, no v1.1/v2.0
All directory paths must be complete absolute paths, no abbreviations

Tags[ABCDE]: 
Layer(F-Frontend/B-Backend/S-Service/C-Controller/M-Middleware/D-Database/U-Utility/R-Route) Module(C-Core/A-Auth/T-Chat/R-Credits/K-Knowledge/I-Image/V-Video/S-Storage/L-Calendar/E-Teaching/G-Workflow/H-Editor/P-SmartApp/O-Other/W-Wiki) Importance(9-Core/8-High/7-Business/5-Normal/3-Auxiliary) Feature(P-Credits/A-Async-Stream/T-Transaction-Concurrent/E-External-API/C-Config/R-Permission) Size(L-Large/M-Medium/S-Small)

===Code Index Section===

Module 1: Core System & Startup
--Backend Core--
/var/www/ai-platform/backend/src/
server.js[BCC9S]: F:Server startup entry | R:app.js,dbConnection,redisConnection | A:None | S:PM2 startup,Database/Redis init,SIGTERM graceful shutdown,port 4000
app.js[BCC9M]: F:Express application init | R:All routes,middleware | A:/health,/health/detailed,/pages/:userId/:slug | S:17 module routes including smartAppRoutes+wikiRoutes,dynamic rate limiting,health check,CORS/helmet,static files
.env[BCC9S]: F:Environment variables config | R:config/index.js | A:None | S:Production env,MySQL/Redis connection,JWT strong secret,CORS whitelist,Casbin permission switch
--Config & Connection--
/var/www/ai-platform/backend/src/config/
index.js[BCC9M]: F:Unified config management | R:All modules | A:None | S:Env variable management,smart Docker/PM2 detection,unified storage path,JWT/CORS/Redis config
/var/www/ai-platform/backend/src/database/
connection.js[DCC9M]: F:MySQL connection pool management | R:All Model layer | A:None | S:MySQL2 singleton,auto transaction management,execute prepared statements,simpleQuery for LIMIT/OFFSET
redis.js[DCC9M]: F:Redis cache connection | R:cacheService,rateLimitService | A:None | S:Redis singleton,auto reconnect,keyPrefix isolation,JSON serialization,error tolerance non-blocking
--Database Migration--
/var/www/ai-platform/backend/
knexfile.js[DCC8CS]: F:Knex database migration config | R:backend/.env,docker env vars | A:None | S:Support dev/prod dual env,dev reads backend/.env(localhost),prod reads env vars(mysql Docker service name),mysql2 driver,migration dir ./migrations
/var/www/ai-platform/backend/migrations/
20260127032549_000_baseline.js[DC9S]: F:Baseline migration file | R:knexfile.js | A:None | S:89 business tables baseline,up method empty(tables exist),down method empty(non-rollback),marks existing database as migration starting point
--Utilities--
/var/www/ai-platform/backend/src/utils/
logger.js[UCC9M]: F:Winston log management | R:All modules | A:None | S:Auto create directory,file+console dual output,5MB rotation,supports Docker/PM2
response.js[UCC9S]: F:Unified response format | R:All Controller | A:None | S:8 response methods,success/error/validation/unauthorized,unified timestamp and structure
errors.js[UCC9S]: F:Custom error class system | R:errorHandler,All Service | A:None | S:9 error classes,AppError base class,ValidationError/AuthenticationError etc
tokenCalculator.js[UTC8PM]: F:Token calculation estimation | R:ChatController,credits system | A:None | S:Chinese/English separate calculation,Chinese 1.5x English 1.3x,formatTokenCount formats K unit
--Middleware--
/var/www/ai-platform/backend/src/middleware/
errorHandler.js[MCC9M]: F:Global error handling | R:app.js,logger,response | A:None | S:Catch unhandled exceptions,JWT/database/Multer errors,prod hides stack trace,process signal handling
authMiddleware.js[MAC9RM]: F:JWT auth and permission check | R:User model,redisConnection,All routes | A:None | S:Support SSE query params,Token blacklist,account expiry,role/permission/group permission 4-layer check
uploadMiddleware.js[MO7S]: F:File upload middleware | R:multer,config,logger | A:Middleware | S:Multer image upload supporting 6 image formats,10MB size limit per file,chat-images dir by year/month,unique filename generateFileName timestamp+MD5,getFileUrl gets public access URL,deleteFile deletes file,handleUpload error handling wrapper
cacheMiddleware.js[MC7M]: F:API response cache middleware | R:redisConnection,logger | A:Middleware factory | S:Only cache GET requests,Redis storage TTL default 300s,intercept res.json method to cache successful responses,X-Cache header HIT/MISS,cache key by user ID or anonymous,Redis unavailable degrades non-blocking
documentUploadMiddleware.js[MO5M]: F:Document upload middleware | R:multer,config,logger,fs,crypto | A:Middleware | S:Support PDF/Word/TXT/Excel/PPT/RTF etc 12 formats,disk storage avoids memory overflow,50MB size limit,categorized by year/month,filename encoding fix latin1->utf8,extractDocumentContent content extraction limit 10000 chars
publicUploadMiddleware.js[MO5S]: F:Public upload middleware | R:multer,logger | A:Middleware | S:Business license etc no auth file upload,memory storage memoryStorage for OSS upload,support 6 image MIME+PDF,10MB size limit
systemUploadMiddleware.js[MO3S]: F:System file upload middleware | R:multer,config,logger,crypto,fs | A:Middleware | S:Site Logo etc system-level file upload,disk storage,support 6 image formats including SVG,2MB size limit
--System Services--
/var/www/ai-platform/backend/src/services/
healthCheckService.js[SC9S]: F:Health check service | R:dbConnection,redisConnection,os | A:/health,/health/detailed | S:System/database/Redis/memory 4 checks,quick check for load balancer,detailed check for monitoring,memory>90% alert
cacheService.js[SCC9TM]: F:Redis cache unified management | R:redisConnection | A:None | S:7 cache types,4-level TTL(5min/30min/2hr/24hr),fallback degradation mechanism,SCAN batch clear
rateLimitService.js[SC9CM]: F:Dynamic rate limit service | R:SystemConfig,express-rate-limit | A:Internal service | S:5 limiters(auth/emailCode/global/adminRead/adminWrite),enabled field supports disable,config hot update clears cache,default 2000 req/15min global
emailService.js[SA7ECS]: F:Email service | R:nodemailer,SystemConfig,logger | A:SMTP external | S:Nodemailer email sending,sendVerificationCode sends 6-digit code valid 5min,sendTestEmail test email,reads SMTP config from SystemConfig
--Data Models--
/var/www/ai-platform/backend/src/models/
SystemConfig.js[DSC8M]: F:System config management | R:dbConnection | A:None | S:Key-value storage+auto type conversion(json/boolean/number/string),batch UPSERT update,getFormattedSettings nested structure
Module.js[DCO9CRL]: F:System module model | R:dbConnection,crypto | A:None | S:System/external module dual type,allowed_groups JSON permission,super admin forced access to admin module,config encryption AES-256-CBC
--PM2 Config--
/var/www/ai-platform/
ecosystem.config.js[UC9CS]: F:PM2 process management config | R:None | A:None | S:PM2 config 2 processes ai-platform-auth backend 4000+ai-platform-frontend frontend 3000,backend 2GB memory+frontend 500M,log path logs separated,auto restart 5s delay max 10 times
--Frontend Core--
/var/www/ai-platform/frontend/src/
main.jsx[FC9S]: F:React application entry | R:App,i18n,networkService | A:Application startup | S:Network monitor service init mounted to window.networkService,refresh user state on network recovery,prod env no StrictMode to avoid double render
App.jsx[FC9CL]: F:Application main entry v1.2 default language init | R:Router,ConfigProvider,ThemeProvider,authStore,systemConfigStore,apiClient,i18n | A:/public/system-config | S:v1.2 added initDefaultLanguage useEffect gets system default language on startup,hasUserSelectedLanguage check+setSystemDefaultLanguage apply,languageInitialized state,19 lazy-loaded pages including SmartApps+Wiki,ProtectedRoute/PublicRoute guards,dynamic favicon+title update
/var/www/ai-platform/frontend/src/utils/
i18n.js[FUC9CS]: F:i18n internationalization config v1.1 system default language | R:i18next,react-i18next,i18next-browser-languagedetector,locales | A:None | S:v1.1 added 5 export functions hasUserSelectedLanguage+markUserSelectedLanguage+setSystemDefaultLanguage+changeLanguage+getSupportedLanguages,dual localStorage keys i18nextLng+userSelectedLanguage,priority user selection>system default>browser>zh-CN
--Frontend Utils & Services--
/var/www/ai-platform/frontend/src/utils/
api.js[FU9ACEL]: F:API client wrapper | R:axios,authStore | A:Interceptor global config | S:Smart Token auto refresh max 3 times,401 intercept+queue retry,streaming SSE support postStream,AbortController cancel mechanism,request tracking X-Request-ID
/var/www/ai-platform/frontend/src/services/
tokenRefreshService.js[SA9CM]: F:Token auto refresh service | R:authStore | A:Background scheduled task | S:Refresh 5min early,parseExpiresIn(s/m/h/d),page visibility listener,30s periodic check,anti-duplicate refresh lock,singleton pattern
networkService.js[FC9S]: F:Network status monitor service | R:message(antd) | A:Browser events | S:Simplified version only listens to browser online/offline events no active check,message shows network status,singleton pattern
--Frontend State Management--
/var/www/ai-platform/frontend/src/stores/
systemConfigStore.js[FC9CL]: F:System config state management | R:apiClient,authStore | A:/admin/settings,/public/system-config,/admin/settings/upload-logo | S:Site config name/logo/description,user config registration switch/default credits token,group-level config priority userSiteConfig,admin/regular user dual interface
--Frontend Build Config--
/var/www/ai-platform/frontend/
vite.config.js[FC5CS]: F:Vite build config | R:vite,react,vite-plugin-monaco-editor | A:Build config | S:Monaco Editor plugin complete Worker config,dev server 0.0.0.0 listen+proxy /api to 4000,manualChunks split strategy 8 vendor packages
package.json[FC9CS]: F:Frontend dependency management | R:None | A:Project config | S:React 18+Vite 5+Antd 5 tech stack,48 dependencies including Monaco+ReactFlow+ECharts+Mermaid+Prism
--Edge Files--
/var/www/ai-platform/backend/src/controllers/adminController.js, fileController.js, statsController.js
/var/www/ai-platform/backend/src/models/User.js.broken.20250907_141827
/var/www/ai-platform/backend/src/services/admin/UserTagService.batch.js
/var/www/ai-platform/backend/src/middleware/moduleProxy.js, permissions.js
/var/www/ai-platform/backend/src/routes/admin_mindmap_credits.js, admin_storage_route_addition.js
/var/www/ai-platform/backend/src/routes/services/index.js
/var/www/ai-platform/backend/test.sh, jest.config.js, .npmrc, sync-auth-to-casbin.js

Module 2: Authentication & Authorization System
--Backend Routes--
/var/www/ai-platform/backend/src/routes/
auth.js[RAC9S]: F:Auth route definition | R:AuthControllerRefactored,authMiddleware | A:/auth/login,/auth/register,/auth/sso,/auth/send-email-code,/auth/verify-invitation-code,/auth/check-email | S:4 login methods,invitation code verification,registration check endpoint,9 public+5 authenticated endpoints
public.js[RC7CS]: F:Public route definition | R:dbConnection,OrgApplicationController,PublicUploadController,publicUploadMiddleware | A:/public/custom-homepage,/public/system-config,/public/org-application/* | S:4 public endpoints no auth required,JSON_OBJECT query config avoids multiple queries,error fallback returns default values for availability
--Backend Controllers--
/var/www/ai-platform/backend/src/controllers/
AuthControllerRefactored.js[CAC9RL]: F:Auth controller core | R:User,SystemConfig,SSOService,EmailAuthService,TokenService,SiteConfigService,GroupService | A:All auth route endpoints | S:16 methods,4 login types(password/code/email-password-code/SSO),invitation code registration,account expiry check,forced verification mode
PublicUploadController.js[CO5ES]: F:Public upload controller | R:multer,ossService,ResponseHelper,crypto | A:Internal call | S:Business license etc no-login file upload,OSS/local auto switch,public/applications/{year}/{month} directory isolation
--Backend Services--
/var/www/ai-platform/backend/src/services/
jwtService.js[SAC9M]: F:Module JWT generation | R:User model,config | A:None | S:Support uuid/sub/name etc standard fields,4 transport methods query/header/cookie/post,SSO verification interface
authService.js[SAC5M]: F:Auth service legacy version | R:jwt,User,config,errors | A:Internal service | S:JWT generate/verify dual Token,register/login/refresh token,email format validation,password strength check 6 chars
/var/www/ai-platform/backend/src/services/auth/
TokenService.js[SAC9TM]: F:JWT token generation refresh | R:SystemConfig,redisConnection,config | A:None | S:access/refresh dual Token,dynamic expiry time,Redis blacklist,jti unique identifier,supports SSO user marking
EmailAuthService.js[SAC8S]: F:Email verification code service | R:EmailService,redisConnection | A:None | S:6-digit code,5min valid,60s send limit,Redis storage,email service dependency check
SSOService.js[SAC9RS]: F:SSO single sign-on | R:User,SystemConfig | A:None | S:MD5 signature verification,IP whitelist,timestamp anti-replay 5min,auto create/update SSO user,account expiry check
SiteConfigService.js[SAC7CS]: F:Site config service | R:SystemConfig,logger | A:Internal service | S:getUserSiteConfig gets user site config,group-level config priority group_site_name/group_site_logo,fallback default config prevents errors
--Data Models--
/var/www/ai-platform/backend/src/models/
User.js[DAC9PTRL]: F:User model core | R:bcrypt,dbConnection,logger | A:None | S:Soft delete auto rename releases unique fields,3-layer permission super_admin/admin/user,credits full lifecycle management(recharge/deduct/consume/expiry),account expiry management,UUID support
--Casbin Permission Engine--
/var/www/ai-platform/backend/src/services/casbin/
CasbinService.js[SAC9RL]: F:Casbin permission engine service | R:casbin,dbConnection,logger | A:Internal service | S:RBAC permission management singleton,custom MySQL adapter+deny policy table separation,checkPermission checks deny first then allow,role inheritance+permission query,policy hot reload
CasbinAuthAdapter.js[SAC9RL]: F:Casbin permission adapter | R:CasbinService,GlobalAuthorizationService,logger,config | A:Internal service | S:Casbin parallel adapter with original system,grayscale switch ENABLE_CASBIN/USE_CASBIN_RESULT,permission check comparison log,deny policy handling
CasbinSyncService.js[SAC8RTM]: F:Casbin data sync service | R:dbConnection,CasbinService,logger | A:Internal service | S:Sync from teaching_global_authorizations to Casbin,group/tag/user 3-level permission mapping,allow/deny policy batch import,incremental/full sync
--Casbin Config--
/var/www/ai-platform/backend/src/config/casbin/
teaching_model.conf[SC5CR]: F:Casbin teaching system permission model config | R:CasbinService,GlobalAuthorizationService | A:None | S:RBAC with domains model supports multi-level inheritance,g user->tag->group and g2 lesson->module dual inheritance,used for teaching system 3-level permission view_lesson/view_plan/edit
--Permission Middleware--
/var/www/ai-platform/backend/src/middleware/permissions/
superAdminMiddleware.js[MAC9RS]: F:Super admin permission middleware | R:ResponseHelper,logger | A:Middleware | S:5 permission checkers requireSuperAdmin/canManageCredits/canManageSystem/canManageAIModels/canManageGroups,role strict check super_admin,403 forbidden response
groupAdminMiddleware.js[MAC8RS]: F:Group admin permission middleware | R:User,ResponseHelper,logger | A:Middleware | S:5 permission checkers,canManageUser same group verification,canCreateUser forced role=user+group_id,restrictFieldsForGroupAdmin filters 7 restricted fields
index.js[MAC5S]: F:Permission middleware unified export | R:groupAdminMiddleware,superAdminMiddleware | A:Middleware | S:Export group admin and super admin permission middleware,unified entry
--Frontend Pages--
/var/www/ai-platform/frontend/src/pages/auth/
Login.jsx[FA9AL]: F:Login page | R:authStore,apiClient,LanguageSwitch | A:/auth/login,/auth/login-by-code,/auth/login-by-email-password | S:3 login modes(password/code/email-password-code),iOS style design,email code 60s countdown,enterprise application entry,mobile adaptation
/var/www/ai-platform/frontend/src/pages/profile/
Profile.jsx[FA8M]: F:Profile page | R:authStore,i18n,antd | A:Via authStore | S:3 Tabs(basic info/credits history/permission list),change password removed original password verification,credits stats card 3 metrics,role Tag color mapping
--Frontend State Management--
/var/www/ai-platform/frontend/src/stores/
authStore.js[FA9ACRM]: F:Auth state management | R:tokenRefreshService,systemConfigStore,apiClient | A:/auth/login,/auth/refresh,/auth/me,/auth/register | S:4 login methods,dual Token mechanism,parseExpiresIn parsing,persist persistence,login clears chatStore,site config sync

Module 3: Chat System
--Backend Routes--
/var/www/ai-platform/backend/src/routes/
chat.js[RTC9M]: F:Chat route definition | R:ChatControllerRefactored,authMiddleware,uploadMiddleware | A:/chat/models,/chat/conversations,/chat/messages | S:17 endpoints,5 rate limits(conversation 15/upload 30/credits 60/draft 120/message 30 per min),file upload middleware
--Backend Controllers--
/var/www/ai-platform/backend/src/controllers/
ChatControllerRefactored.js[CTC9APTL]: F:Chat controller core | R:ConversationService,MessageService,StreamMessageService,NonStreamMessageService,Conversation,Message,File,User,AIModel,CacheService | A:All chat route endpoints | S:21 methods,streaming/non-streaming dual mode,credits pre-deduction,draft management,message caching,file upload,0 credits free model support,message pair deletion
--Backend Services--
/var/www/ai-platform/backend/src/services/chat/
ConversationService.js[STC8RS]: F:Conversation business logic | R:Conversation,SystemPrompt,ModuleCombination,AIModel,CacheService | A:None | S:Conversation create/update validation,permission check(model/prompt/combination),parameter normalization context_length 0-1000,temperature 0-1
MessageService.js[STC9PAM]: F:Message business logic core | R:Message,File,SystemPrompt,ModuleCombination,AIService,AIStreamService,CacheService,StatsService | A:None | S:Message validation(content/credits/Token),file handling(image/PDF file field),AI context building(system prompt+module combination+history),stats update,credits refund
StreamMessageService.js[STC8AS]: F:Streaming message service | R:Message,File,AIStreamService,MessageService | A:None | S:SSE streaming send,placeholder creation status=streaming,completion handler callback,failure credits refund,supports image generation
NonStreamMessageService.js[STC8S]: F:Non-streaming message service v1.1 fix image display | R:Message,File,AIService,MessageService | A:None | S:Normal message send,AI call,stats update,response data assembly file info,v1.1 fix MySQL JSON field auto-parse causing image data processing failure+parseGeneratedImages smart parsing
/var/www/ai-platform/backend/src/services/
aiService.js[SAC9EPTL]: F:Non-streaming AI call core | R:AIModel,ImageGenerationService,axios | A:None | S:Azure config parsing api_key 3-segment,OpenRouter PDF format file field+plugins,image generation OpenRouter/Gemini,multi-provider adaptation,120s timeout
aiStreamService.js[SAC9AETL]: F:Streaming AI call core v2.0 error handling enhancement | R:AIModel,axios | A:None | S:SSE strict spec event+data format,X-Accel-Buffering prevents Nginx buffering,OpenRouter PDF plugin,Azure streaming independent implementation,v2.0 added safeStringify handles circular reference+parseAPIError converts API error to Chinese prompt+empty content sends error event
streamRecoveryService.js[STC8AS]: F:Streaming response recovery service | R:logger | A:Internal service | S:Streaming session memory management Map,checkpoint mechanism saves every 10,5min timeout auto cleanup,disconnection recovery content+checkpoints,singleton pattern
--Data Models--
/var/www/ai-platform/backend/src/models/
Conversation.js[DTC9M]: F:Conversation data model v1.1 smart app support | R:SystemConfig,Message | A:None | S:Support context_length(0-1000)/temperature(0-1)/priority(0-10),system prompt ID/module combination ID/smart_app_id,cleared_at clear time filter,sorted by priority+time,v1.1 added smart_app_id field links smart app
Message.js[DTC9TM]: F:Message data model | R:Conversation,File,dbConnection | A:None | S:sequence_number auto increment,4 statuses pending/streaming/completed/failed,streaming message recovery mechanism,deleteMessagePair transaction delete+sequence renumber,generated_images JSON field
File.js[DFC7M]: F:File info management | R:config,dbConnection | A:None | S:Smart URL generation supports Docker/PM2 path,8 prefix auto cleanup,protocol auto select http/https,file_path->stored_name mapping
--Frontend Pages--
/var/www/ai-platform/frontend/src/pages/chat/
Chat.jsx[FT9AL]: F:Chat main interface | R:chatStore,authStore,MessageList,ChatInputArea,ConversationSidebar | A:/chat/* | S:PC/mobile dual layout,improved scroll logic prevents conflict,userScrolled state control,streaming output 500ms interval scroll,mobile 3 views,image/document upload,export chat txt,clear conversation,delete message pair,pin conversation,v1.1 fix editing non-current conversation config override bug
--Frontend Components--
/var/www/ai-platform/frontend/src/components/chat/
MessageList.jsx[FT8M]: F:Message list component | R:MessageContent,ReactMarkdown,apiClient | A:None | S:MessageItem+EmptyMessages separated,React.memo optimized rendering,system announcement display,user avatar first letter,AI lightning icon SVG,typing state,streaming message marker
/var/www/ai-platform/frontend/src/components/chat/new/
ChatHeader.jsx[FT7S]: F:Chat header component simplified | R:Button,Typography,Space,MenuOutlined,SettingOutlined,i18n | A:None | S:Display conversation title and model name Tag,menu button toggles sidebar,settings button opens settings,left-right split layout
ChatInputArea.jsx[FT8M]: F:Chat input area component mobile optimized | R:ModelSelector,Upload,Tooltip,TextArea,forwardRef,i18n | A:None | S:Support image and document upload dual mode,mobile optimized 16px font prevents iOS zoom,forwardRef exposes focus/blur methods,uploaded file preview,ModelSelector integrated,send/stop button switch
ConversationSidebar.jsx[FT8M]: F:Conversation sidebar component iOS style optimized | R:Button,Empty,Spin,Tag,Typography,i18n | A:None | S:Collapse/expand functionality,pin icon PushpinFilled,message count,last message time formatting,new conversation button,iOS style card design
ModelSelector.jsx[FT7M]: F:Model selector component mobile shows full alias | R:Popover,Button,List,Typography,ThunderboltOutlined,CheckOutlined | A:None | S:Popover popup selection,display model name+credits+image support,click outside closes,responsive placement mobile top/PC topLeft
EmptyConversation.jsx[FT5S]: F:Empty conversation state component shows system announcement | R:apiClient,ReactMarkdown,Empty,Card,Spin,i18n | A:/admin/announcement | S:Display system announcement Markdown rendered,empty state Empty component,start new conversation button
--Frontend State Management--
/var/www/ai-platform/frontend/src/stores/
chatStore.js[FT9APL]: F:Chat state management v2.0 error display enhancement | R:apiClient,message | A:/chat/conversations,/chat/messages,/chat/models,/knowledge/combinations | S:State separation conversations independent currentConversation,streaming/non-streaming dual mode,500 conversation limit+1000 message limit,30s dynamic timeout,v2.0 fix onError callback keeps user message+AI message position shows error message
--Edge Files--
/var/www/ai-platform/frontend/src/pages/chat/Chat.jsx.optimized.20250808_195237, Chat.jsx.stable.20250808_194134, Chat_optimized_v1.jsx
/var/www/ai-platform/frontend/src/components/chat/CodeBlock.jsx, ConversationList.jsx, VirtualMessageList.jsx, MessageContent.less, MessageList.less
/var/www/ai-platform/frontend/src/components/chat/new/ConversationFormModal.jsx, ConversationSettingsDrawer.jsx, MobileChatInput.jsx, MobileChatInput.less, ModelSelector.less, OptimizedChatInput.jsx, EmptyConversation.less, index.js

Module 4: Credits Management System
--Backend Routes--
/var/www/ai-platform/backend/src/routes/
admin.js[RC8RM]: F:Admin route aggregation | R:13 sub-routes,various Controllers,permission middleware,rateLimitService | A:/api/admin/* | S:Dynamic layered rate limit read/write,14 sub-routes mounted,cache management+rate limit config+email+SSO+announcement+custom homepage
--Backend Controllers--
/var/www/ai-platform/backend/src/controllers/admin/
UserCreditsController.js[CR7PTS]: F:User credits management controller | R:CreditsService,User,ResponseHelper | A:GET/POST /admin/users/:id/credits/* | S:Credits info query,quota setting,recharge/deduct,expiry setting/extension,credits history paginated query
--Backend Services--
/var/www/ai-platform/backend/src/services/admin/
CreditsService.js[SAC7C]: F:Credits management service | R:User,dbConnection | A:None | S:Set/recharge/deduct/consume four operations,expiry setting/extension,credits history query,batch recharge transaction,credits statistics report,supports 0 credits free model

Module 5: Knowledge Module System - Magic Cube
--Backend Routes--
/var/www/ai-platform/backend/src/routes/
knowledgeRoutes.js[RK7S]: F:Knowledge module routes | R:KnowledgeModuleController,ModuleCombinationController,authMiddleware | A:/knowledge/modules,/knowledge/combinations | S:Module/combination CRUD endpoints,category/tag query,authenticate auth
--Data Models--
/var/www/ai-platform/backend/src/models/
KnowledgeModule.js[DKC9RPTL]: F:Knowledge module management | R:User,UserGroup,dbConnection,tokenCalculator | A:None | S:3 scopes personal/team/system,group_ids JSON array MEMBER OF query,tag permission knowledge_module_tag_permissions table,content_visible content visibility,token auto calculation
ModuleCombination.js[DKC9RPM]: F:Module combination management | R:KnowledgeModule,tokenCalculator | A:None | S:Per-module permission validation,findByIdForExecution execution-specific no hidden content,getCombinedContent blackbox mode content invisible still effective,super admin privilege
SystemPrompt.js[DKC7RM]: F:System prompt management | R:User,UserGroup,system_settings | A:None | S:content on-demand loading not in list return,group permission assignment system_prompt_groups table,feature switch system_prompts_enabled
--Frontend Pages--
/var/www/ai-platform/frontend/src/pages/knowledge/
KnowledgeBase.jsx[FK8L]: F:Magic Cube knowledge module assembly page | R:useKnowledgeStore,useAuthStore,dnd-kit,i18n | A:None | S:5-slot drag assembly,module plaza+combination list,token calculation 100K limit,3-scope modules personal/team/system,permission control,module activation switch,iOS style design
--Frontend State Management--
/var/www/ai-platform/frontend/src/stores/
knowledgeStore.js[FK7M]: F:Knowledge module state | R:apiClient | A:/knowledge/modules,/knowledge/combinations | S:Knowledge module CRUD,module combination CRUD,copy combination,category management,include_inactive parameter
--Backend Controllers--
/var/www/ai-platform/backend/src/controllers/
KnowledgeModuleController.js[CK7RM]: F:Knowledge module controller | R:KnowledgeModule,ResponseHelper,logger,dbConnection | A:/knowledge/modules,/knowledge/modules/:id,/knowledge/categories,/knowledge/group-tags | S:7 methods,3-scope filtering,permission validation super admin creates global+all group users create team,tag permission handling
ModuleCombinationController.js[CK7RS]: F:Module combination controller | R:ModuleCombination,ResponseHelper,logger | A:/knowledge/combinations,/knowledge/combinations/:id,/knowledge/combinations/:id/copy,/knowledge/combinations/:id/content | S:7 methods,permission validation can only operate own combinations,copy functionality
--Edge Files--
/var/www/ai-platform/frontend/src/components/knowledge/KnowledgeModuleFormModal.jsx, KnowledgeModuleList.jsx, KnowledgeModuleList.less, ModuleCombinationFormModal.jsx, ModuleCombinationList.jsx, ModuleCombinationList.less

Module 6: AI Model Management
--Backend Controllers--
/var/www/ai-platform/backend/src/controllers/admin/
AIModelController.js[CC7RCEM]: F:AI model management controller | R:AIModel,CacheService,ResponseHelper,logger | A:/admin/models | S:CRUD+test connection+group management,super admin sees all group admin hides sensitive info,new model default assigned to all active groups,document_upload_enabled support
--Data Models--
/var/www/ai-platform/backend/src/models/
AIModel.js[DCC9RETL]: F:AI model config management v1.1 fix sensitive field preservation | R:UserGroup,dbConnection,axios | A:None | S:Azure config parsing api_key 3-segment,group assignment+user restriction dual-layer permission,credits_per_chat supports 0 value free model,stream/image/document 3 switches,v1.1 fix update method api_key/api_endpoint empty keeps original value

Module 7: Image Generation System
--Backend Routes--
/var/www/ai-platform/backend/src/routes/
image.js[RI8S]: F:Image generation route definition | R:ImageController,ImageAdminController,authenticate,multer | A:/image/models,/image/generate,/image/upload-reference,/image/midjourney/*,/image/history,/image/gallery | S:multer memory storage 10MB image upload limit 6 MIME types,user-side 12 endpoints+admin-side 5 endpoints,Midjourney dedicated routes,Webhook no auth required
--Backend Controllers--
/var/www/ai-platform/backend/src/controllers/
imageController.js[CI8PEL]: F:Image generation controller | R:ImageService,MidjourneyService,ImageModel,ImageGeneration,ossService | A:/image/models,/image/generate,/image/upload-reference,/image/midjourney/*,/image/history,/image/gallery | S:User+admin dual controller,batch generate 1-4 images,Midjourney U/V/Reroll operations,image-to-image reference image upload OSS,favorite/public toggle
--Backend Services--
/var/www/ai-platform/backend/src/services/
imageService.js[SI9PETL]: F:Image generation service integration v2.0 Wanxiang API support | R:ImageModel,ImageGeneration,User,ossService,sharp | A:Internal service | S:Batch generate 1-4 images concurrent Promise.allSettled,Seedream series auto detection,Volcano/Midjourney/Wanxiang 3 providers,image-to-image image parameter,user directory isolation,credits deducted by actual success count,sharp thumbnail 400x400,v2.0 added isWanxiangModel Wanxiang model detection+buildWanxiangRequest request building stream:true+enable_interleave+callWanxiangAPI SSE streaming call X-DashScope-SSE header+collectedImages collects all data block image URLs+convertSizeForWanxiang size conversion x->*
imageGenerationService.js[SI9EM]: F:Image generation service | R:ossService,dbConnection,logger | A:Internal service | S:OpenRouter+Gemini dual format parsing,Base64 to Buffer save,user isolated directory,OSS/local auto switch,message ID traces user,image generation model detection
midjourneyService.js[SI8PEAL]: F:Midjourney image generation service | R:ImageModel,ImageGeneration,User,ossService,axios | A:Midjourney API | S:Imagine text-to-image/image-to-image+Action operations U/V/Reroll,base image base64Array support,2s polling 5min timeout,status mapping mapTaskStatus,Webhook callback handling
midjourneyProxyService.js[SI7PEPL]: F:Midjourney proxy service sync API | R:ImageModel,ImageGeneration,User,axios,logger | A:goapi.gptnb.ai | S:Sync return Midjourney image non-polling,4-image grid grid_layout,credits deducted by actual success count,5min timeout
--Data Models--
/var/www/ai-platform/backend/src/models/
ImageModel.js[DI7CEM]: F:Image model config management | R:dbConnection,crypto | A:None | S:AES-256-CBC encrypted API key,has_api_key identifier,sizes_supported JSON parsing,price_per_image type conversion,supports 4 providers(volcano/midjourney/dashscope/aliyun)
ImageGeneration.js[DI7M]: F:Image generation record model | R:dbConnection,logger | A:None | S:Midjourney fields support task_id/buttons/grid_layout,user history paginated,favorite/public toggle,public gallery,user statistics
--Frontend Pages--
/var/www/ai-platform/frontend/src/pages/image/
ImageGeneration.jsx[FI7S]: F:Image generation page export | R:./index | A:None | S:Export refactored image generation page index
--Frontend Components--
/var/www/ai-platform/frontend/src/components/admin/settings/
ImageModelSettings.jsx[FI7CEM]: F:Image model management settings component v1.1 Wanxiang support | R:adminStore,Form,Input,Select,InputNumber | A:/admin/image-models | S:Image model CRUD form,v1.1 added PROVIDER_CONFIG config object volcano/midjourney/dashscope/aliyun,provider selection auto-fills default endpoint and size format,Wanxiang config hints model ID recommended wan2.6-image+size format width*height,provider dropdown icon color differentiation
--Frontend State Management--
/var/www/ai-platform/frontend/src/stores/
imageStore.js[FI8AL]: F:Image generation state management | R:api,message | A:/image/generate,/image/midjourney/* | S:Midjourney async polling 2s interval/5min timeout,processingTasks state prevents duplicates,base64Array support,batch generation,favorite/public toggle
--Edge Files--
/var/www/ai-platform/backend/src/models/MidjourneyTask.js, GeminiFile.js
/var/www/ai-platform/frontend/src/pages/image/index.jsx, ImageGeneration.less
/var/www/ai-platform/frontend/src/pages/image/components/GenerationPanel/MidjourneyUploader.jsx, ModelSelector.jsx, ParameterSettings.jsx, PromptInput.jsx, ReferenceUploader.jsx, ReferenceUploader.less
/var/www/ai-platform/frontend/src/pages/image/components/ImageGallery/ImageCard.jsx, MidjourneyActions.jsx
/var/www/ai-platform/frontend/src/pages/image/hooks/useImageGeneration.js, useImageUpload.js, usePagination.js
/var/www/ai-platform/frontend/src/pages/image/utils/constants.js, imageHelpers.js

Module 8: Video Generation
--Backend Routes--
/var/www/ai-platform/backend/src/routes/
video.js[RV7S]: F:Video generation route definition | R:VideoController,VideoAdminController,authenticate,uploadMiddleware,ossService | A:/video/models,/video/generate,/video/upload-frame,/video/task/:id,/video/history,/video/gallery | S:First frame upload uploadImage middleware+OSS save video-frames directory,user-side 9 endpoints+admin-side 5 endpoints
--Backend Controllers--
/var/www/ai-platform/backend/src/controllers/
videoController.js[CV7PEAL]: F:Video generation controller user+admin | R:VideoService,VideoModel,VideoGeneration,klingVideoService,sora2VideoService | A:/video/models,/video/generate,/video/task/:id,/video/history,/video/gallery | S:Dual controller structure,3 providers support volcano/kling/sora2,polling task status completion callback,favorite/public/batch delete,credits deduction 402 error code
--Backend Services--
/var/www/ai-platform/backend/src/services/
videoService.js[SV9EPTL]: F:Video generation service integration | R:VideoModel,VideoGeneration,User,ossService,klingVideoService,sora2VideoService | A:Internal service | S:3 providers unified interface Volcano/Kling/Sora2,credits deduction+status polling,Volcano textContent command line params,Kling Image2Video/Text2Video branches,video download save OSS,10s polling 10min timeout
klingVideoService.js[SV7PEM]: F:Kling video generation service | R:ossService,jwt,redis,axios | A:https://api-beijing.klingai.com | S:JWT signature auth HS256 algorithm,25min Token memory cache,Text2Video/Image2Video dual mode,camera control buildCameraControl,aspect ratio conversion
sora2VideoService.js[SV7EL]: F:Sora2 video generation service | R:ossService,axios | A:https://goapi.gptnb.ai | S:GoAPI Provider,sora-2 basic/sora-2-pro professional dual model support,orientation conversion,OpenAI error translated to Chinese,progress percentage progress_pct
--Data Models--
/var/www/ai-platform/backend/src/models/
VideoModel.js[DV7CEM]: F:Video model config management | R:dbConnection,crypto | A:None | S:3 providers support volcano/kling/sora2,AES-256-CBC encryption Volcano only,Kling access_key+secret_key in api_config,resolution/duration/framerate/aspect ratio config
VideoGeneration.js[DV7M]: F:Video generation record model | R:dbConnection | A:None | S:3 providers support provider/orientation/generation_id/reference_images,user history paginated,public gallery,favorite/public toggle,batch delete
--Frontend Pages--
/var/www/ai-platform/frontend/src/pages/video/
VideoGeneration.jsx[FV8PEL]: F:Video generation complete page | R:videoStore,authStore,apiClient,i18n | A:/video/upload-frame | S:4 modes text/first-frame/last-frame/dual-frame+multi resolution duration aspect ratio,first/last frame Upload image upload 10MB,credits calculatePrice display,vertical video isVerticalVideo adapts contain,fullscreen preview Modal
--Frontend State Management--
/var/www/ai-platform/frontend/src/stores/
videoStore.js[FV8AL]: F:Video generation state management | R:apiClient,message | A:/video/models,/video/generate,/video/task/:id,/video/history | S:5s polling 10min timeout,processingTasks+completedTasks prevents status regression,smart data merge completed tasks not overwritten,restore incomplete tasks polling

Module 9: Agent Workflow
--Backend Routes--
/var/www/ai-platform/backend/src/routes/
agent.js[RG7S]: F:Agent workflow route definition | R:AgentController,authenticate | A:/agent/workflows,/agent/node-types,/agent/executions,/agent/test/*,/agent/wiki-items | S:Node type 1 endpoint+workflow CRUD 6 endpoints+execution 1 endpoint+test conversation 4 endpoints+execution history 3 endpoints+statistics 1 endpoint+knowledge base list 1 endpoint
--Backend Controllers--
/var/www/ai-platform/backend/src/controllers/
AgentController.js[CG8PRM]: F:Agent workflow controller | R:AgentWorkflow,AgentNodeType,AgentExecution,ExecutorService,TestSessionService | A:/agent/workflows,/agent/execute/:id,/agent/test/:id/session | S:Workflow CRUD,one-time execution+test conversation dual mode,test session management,node type list,execution history paginated,permission validation,insufficient credits 402,extractTextFromOutput smart extract AI reply text supports result/content/output/text multi-field recursive extraction
--Backend Services--
/var/www/ai-platform/backend/src/services/agent/
ExecutorService.js[SG9PTL]: F:Agent workflow execution engine | R:NodeRegistry,AgentWorkflow,AgentExecution,AgentNodeExecution,AgentNodeType,User | A:Internal service | S:Workflow orchestration+topological sort Kahn algorithm detects circular dependency,credits pre-deduct+actual consumption refund mechanism,10min timeout,upstream node output passing upstreamOutput,validateWorkflowConnections validates LLM nodes must have upstream connection,formatFinalOutput ensures return object format,shouldSkipNode conditional branch judgment+branchDecisions branch decision record+skippedNodes skipped node set supports classifier node multi-output conditional execution
TestSessionService.js[SG5S]: F:Agent test session management service | R:logger | A:Internal service | S:Memory storage Map manages sessions+message history,30min timeout+auto cleanup expired sessions every 10min,singleton pattern
NodeRegistry.js[SG9S]: F:Node registry factory pattern | R:StartNode,LLMNode,EndNode,KnowledgeNode,ClassifierNode,logger | A:Internal service | S:Node type register register+get get+create instance createInstance,built-in 5 node types start/llm/end/knowledge/classifier,singleton pattern,createInstance compatible with both call methods
--Node Implementations--
/var/www/ai-platform/backend/src/services/agent/nodes/
BaseNode.js[SG9S]: F:Node abstract base class | R:logger | A:Base class | S:execute abstract method subclass must implement,validate validates node config,replaceVariables variable replacement supports nested paths
StartNode.js[SG5S]: F:Start node | R:BaseNode | A:Node implementation | S:Workflow entry receives user input parameters,no credits consumed,directly returns input data
LLMNode.js[SG8EL]: F:AI conversation node | R:BaseNode,AIModel,axios | A:Node implementation | S:Call LLM for conversation inference,history turns control historyTurns default 10 turns,upstream output passing extractUpstreamContent,Azure+standard API dual support,120s timeout,isKnowledgeOutput detects knowledge base output+buildKnowledgePrompt builds knowledge base prompt+extractUpstreamContent supports knowledge_context field
EndNode.js[SG5S]: F:End node | R:BaseNode | A:Node implementation | S:Workflow exit outputs final result,supports 3 formats text/json/markdown,auto get upstream node output
KnowledgeNode.js[SG7M]: F:Knowledge base node | R:BaseNode,WikiItem,tokenCalculator | A:Node implementation | S:Load content from knowledge base as context passed to downstream nodes,direct load mode executeDirectLoad,supports multi-knowledge base merge,Token calculation,formatContentBlock formats content block,getConfig method fixes config read path this.data.config
ClassifierNode.js[SG8EPM]: F:Question classifier node | R:BaseNode,AIModel,axios,logger | A:Node implementation | S:Use AI to intelligently classify user questions,supports up to 100 classification categories,background_knowledge provides classification context,history_turns references conversation history,buildSystemPrompt builds classification prompt,buildClassificationPrompt builds user prompt,parseClassificationResult parses classification result returns category_id/category_name/category_index/confidence,Azure+standard API dual support,low temperature 0.1 ensures classification stability,60s timeout
--Data Models--
/var/www/ai-platform/backend/src/models/
AgentWorkflow.js[DG7M]: F:Agent workflow model | R:dbConnection,logger | A:None | S:Workflow CRUD+publish toggle+statistics,flow_data JSON field auto-parse,update fix filters undefined values,paginated query supports is_published filter
AgentExecution.js[DG7M]: F:Agent execution record model | R:dbConnection,logger | A:None | S:Execution record CRUD+statistics+cancel,input_data/output_data/execution_log 3 JSON fields,status state management,total_credits_used credits record,duration_ms execution time
AgentNodeExecution.js[DG7S]: F:Agent node execution log model | R:dbConnection,logger | A:None | S:Node execution tracking CRUD,JSON field parsing,findByExecutionAndNode main method,batch create batchCreate transaction support
AgentNodeType.js[DG7CM]: F:Agent node type model | R:dbConnection,logger | A:None | S:Node type config management CRUD,findByTypeKey query,config_schema JSON config,credits_per_execution credits consumption,max_inputs/max_outputs input output limits,toggle active state toggleActive
APIService.js[DC7PM]: F:API service model | R:dbConnection,crypto,errors | A:None | S:API service management+key generation MD5,validateApiKey validation+reset key,request dedup checkDuplicateRequest 24hr
--Frontend Pages--
/var/www/ai-platform/frontend/src/pages/agent/
AgentWorkspace.jsx[FG7S]: F:Agent workspace simplified | R:WorkflowList | A:None | S:Removed Tab tabs,directly renders WorkflowList component,gradient background
WorkflowList.jsx[FG8M]: F:Workflow list card layout v2.2 rename feature | R:agentStore,dayjs,Dropdown | A:/agent/workflows | S:FastGPT style card grid,search+Segmented filter(all/published/unpublished),responsive 4/3/2/1 columns,Dropdown menu event bubble fix,relative time display,create/delete Modal,v2.2 added rename menu item+rename modal to modify workflow name and description
WorkflowList.less[FG5M]: F:Workflow list styles | R:WorkflowList.jsx | A:None | S:iOS/FastGPT style cards,gradient background,hover float animation,responsive layout,Segmented filter styles
AgentWorkspace.less[FG3S]: F:Agent workspace styles | R:AgentWorkspace.jsx | A:None | S:Simplified gradient background styles
--Workflow Editor--
/var/www/ai-platform/frontend/src/pages/agent/editor/
WorkflowEditor.jsx[FG8L]: F:Workflow editor | R:agentStore,ReactFlow,ReactFlowProvider,useReactFlow,Toolbar,NodePanel,ConfigPanel,TestDrawer | A:None | S:ReactFlow canvas drag orchestration,config panel Drawer form,canvas initial zoom 0.6+fitView maxZoom 0.8,onUpdateNodeConfig updates both node.data.label and selectedNode,ClassifierNode classifier node registered,edge sourceHandle/targetHandle save and load supports conditional branch connection persistence,drag-drop support ReactFlowProvider wrapper+useReactFlow gets instance+onDragOver/onDrop handling+screenToFlowPosition coordinate conversion
/var/www/ai-platform/frontend/src/pages/agent/editor/components/
NodePanel.jsx[FG7M]: F:Node panel drag-add | R:Card,Space,Divider,Tooltip,message,DragOutlined | A:None | S:Basic nodes start/LLM/knowledge retrieval/question classifier,11 extension nodes placeholder MCP/A2A/text-to-image/MySQL/HTTP/code/loop/timer/email/document/vector,extension nodes colored+click prompts please apply for module permission,question classifier node orange theme BranchesOutlined icon,drag-add node draggable+onDragStart+dataTransfer passes node type
ConfigPanel.jsx[FG7M]: F:Config panel | R:Form,Input,Select,InputNumber,Slider,agentStore | A:None | S:Node config form LLM/start/end/knowledge base/classifier,adapted Drawer mode inDrawer parameter,top save button+status hint saved/has unsaved changes+loading state,renderClassifierConfig classifier node config panel AI model selection+background knowledge textarea+chat history turns+dynamic category list categories array add/delete/modify max 100
Toolbar.jsx[FG5S]: F:Toolbar component | R:Button,Space | A:None | S:Back/save/delete/test buttons,unsaved hint
TestDrawer.jsx[FG7M]: F:Test drawer component v1.1 optimized | R:Drawer,Input,Button,agentStore | A:None | S:Conversation test interface,message list,input send,clear conversation,loading state,v1.1 deleted top useless Alert description+zIndex=1100 avoids being covered+width adjusted to 480px
TestDrawer.less[FG5S]: F:Test drawer styles v1.1 | R:TestDrawer.jsx | A:None | S:Conversation bubble styles user blue gradient/AI green gradient,message list scroll,input area fixed bottom,v1.1 adjusted z-index ensures not covered
/var/www/ai-platform/frontend/src/pages/agent/editor/nodes/
StartNode.jsx[FG5S]: F:Start node component | R:reactflow,Handle | A:None | S:Green theme,input parameters display,workflow entry
LLMNode.jsx[FG5S]: F:LLM node component | R:reactflow,Handle | A:None | S:Blue theme,model name display,parameter preview
EndNode.jsx[FG5S]: F:End node component | R:reactflow,Handle | A:None | S:Red theme,output mapping display,workflow exit
KnowledgeNode.jsx[FG5S]: F:Knowledge base node component | R:reactflow,Handle | A:None | S:Purple theme,knowledge base name and retrieval config display
ClassifierNode.jsx[FG7M]: F:Question classifier node component | R:reactflow,Handle,Tag,Tooltip | A:None | S:Orange theme gradient background,multi-output port support each category corresponds to a colored Handle,getHandleTopPosition calculates output Handle vertical position evenly distributed 25%-75%,getCategoryColor generates 10 category colors cycling,dynamic node height minHeight based on category count,displays AI model+category list+background knowledge hint
/var/www/ai-platform/frontend/src/pages/agent/editor/styles/
editor.css[FG3S]: F:Editor styles | R:WorkflowEditor | A:None | S:3-column layout styles,node panel/canvas/config panel
--Frontend i18n--
/var/www/ai-platform/frontend/src/locales/zh-CN/
agent.json[FG5C]: F:Agent i18n | R:i18n | A:None | S:Workflow/execution/node Chinese text,search/filter/empty state text,12 extension nodes text extensionNodes object MCP/A2A/text-to-image etc+editor related text editor object
--Frontend State Management--
/var/www/ai-platform/frontend/src/stores/
agentStore.js[FG7AL]: F:Agent workflow state management | R:apiClient,message | A:/agent/workflows,/agent/node-types,/agent/executions,/agent/test/* | S:Zustand manages workflow CRUD+node types+model list+execution history+test sessions,test conversation 6 methods,120s timeout,402 insufficient credits handling
--Edge Files--
/var/www/ai-platform/frontend/src/pages/agent/ExecutionHistory.jsx

Module 10: Intelligent Teaching
--Backend Routes--
/var/www/ai-platform/backend/src/routes/
teachingRoutes.js[RE9RL]: F:Teaching system route definition v1.5.0 Phase3 route hardening | R:TeachingController,authenticate,requireAdmin,requireSuperAdmin,7 permission middleware | A:/teaching/modules,/teaching/lessons,/teaching/permissions,/teaching/groups,/teaching/authorization,/teaching/teaching-plan | S:30+ route endpoints,3-level permission system view_lesson/view_plan/edit,7 permission middleware fine-grained control,Phase3 added requireAdmin and requireSuperAdmin middleware for authorization route dual-layer protection
--Backend Controllers--
/var/www/ai-platform/backend/src/controllers/
TeachingController.js[CE9TRL]: F:Teaching system controller v2.3.0 Phase1-4 complete fix | R:TeachingModule,TeachingLesson,TeachingPermission,TeachingModuleGroup,GlobalAuthorizationService | A:/teaching/modules,/teaching/lessons,/teaching/permissions,/teaching/groups,/teaching/authorization,/teaching/teaching-plan | S:3-level permission system view_lesson student/view_plan teacher/edit editor,module+lesson+group+teaching plan management,Phase4 permission boundary validation validatePermissionBoundary recursive check tags users prevents group admin privilege escalation,Phase1 transaction rollback+row lock concurrency control
--Backend Services--
/var/www/ai-platform/backend/src/services/
GlobalAuthorizationService.js[SE9RL]: F:Global authorization service 3-level permission v4.2.0 multi-tag merge+permission boundary validation | R:dbConnection,logger | A:Internal service | S:3-level permission complete return hasViewLesson/hasViewPlan/hasEdit,group->tag->user 3-level permission inheritance,getUserModulePermission+getUserLessonPermission,v4.2.0 fix multi-tag permission merge bug takes max permission iterates all tags no break,validatePermissionBoundary recursive permission boundary check
--Permission Middleware--
/var/www/ai-platform/backend/src/middleware/
teachingPermissions.js[ME9RM]: F:Teaching system permission middleware v2.0 request-level cache optimization | R:TeachingModule,TeachingLesson,ResponseHelper,logger | A:Middleware | S:7 permission middleware create/edit/view/delete module+view/edit lesson+manage permissions,getUserTags gets user tags+v2.0 request-level cache optimization stored in req._userTagsCache,teacher-exclusive content check
--Data Models--
/var/www/ai-platform/backend/src/models/
TeachingModule.js[DE7RM]: F:Teaching module model | R:dbConnection,GlobalAuthorizationService | A:None | S:3-level permission return version checkUserPermission returns string edit/view_plan/view_lesson/null,matches GlobalAuthorizationService 3-level permission,creator_id auto edit permission
TeachingLesson.js[DE7M]: F:Teaching lesson model | R:dbConnection | A:None | S:Lesson CRUD+content type permission,materials lesson resources support max 5 limit,TEACHER_ONLY_TYPES teacher-exclusive content teaching_plan/answer/guide/assessment
TeachingPermission.js[DE5M]: F:Teaching permission model | R:dbConnection | A:None | S:Module/lesson permission grant revoke,user/group/tag 3-level authorization,expires_at expiry time,revoke/revokeMultiple batch revoke
TeachingModuleGroup.js[DE5M]: F:Teaching group model | R:dbConnection | A:None | S:Module group management CRUD,sort_order sorting,setModuleGroups batch association,getGroupModules query group modules
--Frontend Pages--
/var/www/ai-platform/frontend/src/pages/teaching/
Teaching.jsx[FE7S]: F:Teaching system main page | R:ModuleList | A:None | S:Simplified directly renders ModuleList component no Tab tabs
ModuleDetail.jsx[FE8L]: F:Module detail page | R:teachingStore,authStore,LessonList | A:/teaching/modules/:id,/teaching/modules/:id/lessons | S:Module info display+lesson list,permission control view_lesson/view_plan/edit,create/edit/delete lesson,iOS style
LessonDetail.jsx[FE8L]: F:Lesson detail page | R:teachingStore,authStore,LessonViewer,LessonEditor | A:/teaching/lessons/:id | S:Switch viewer/editor based on permission,3-level permission judgment view_lesson read-only/view_plan includes teaching plan/edit full editing,breadcrumb navigation
LessonEditor.jsx[FE8L]: F:Lesson editor | R:teachingStore,Monaco,ReactQuill,MaterialsManager | A:/teaching/lessons,/teaching/lessons/:id | S:Rich text edit+code edit switch,teaching plan edit paged teacher_plan/answer/guide/assessment,lesson resources management,draft auto save
LessonViewer.jsx[FE7M]: F:Lesson viewer | R:teachingStore,ReactMarkdown,Prism | A:/teaching/lessons/:id,/teaching/lessons/:id/teaching-plan/:page | S:Read-only display lesson content,teaching plan paged view view_plan permission,code highlight,Markdown rendering,browse history
--Frontend Components--
/var/www/ai-platform/frontend/src/components/teaching/
ModuleList.jsx[FE8L]: F:Module list core component | R:teachingStore,authStore | A:None | S:Grouped display+search filter+permission control,creator/super admin/group admin edit permission,mobile adaptation,module card+favorite+pin,iOS style design
MaterialsManager.jsx[FE5M]: F:Lesson materials manager component | R:Upload,message | A:None | S:Max 5 materials limit,file upload/delete/sort,supports document/image/video,materials array JSON format
MaterialsDisplay.jsx[FE5S]: F:Lesson materials display component | R:Card,Tag | A:None | S:Read-only display lesson materials list,file type icon mapping,download link generation,file size formatting
IOSLayout.jsx[FE7M]: F:iOS style layout container | R:Layout | A:None | S:iOS design style unified layout,frosted glass effect,rounded cards,gradient background,responsive adaptation
/var/www/ai-platform/frontend/src/components/teaching/selectors/
GroupSelector.jsx[FE5S]: F:User group selector | R:adminStore,Select | A:/admin/user-groups | S:Dropdown select organization,supports search,permission filter,multi-select mode
TagSelector.jsx[FE5S]: F:User tag selector | R:adminStore,Select | A:/admin/user-tags | S:Dropdown select tag,in-group tag filter,supports search,multi-select mode
UserSelector.jsx[FE5S]: F:User selector | R:adminStore,Select | A:/admin/users | S:Dropdown select user,supports search,displays username+notes,permission filter
--Authorization Management Components--
/var/www/ai-platform/frontend/src/components/admin/settings/ModuleAuthorizationManagement/
index.jsx[FE9RL]: F:Module authorization management main component v2.0 dual-layer architecture | R:useAuthorizationData,useAuthorizationState,usePermissionLogic | A:/teaching/authorization,/teaching/modules,/admin/user-groups,/admin/user-tags | S:Super admin group-level authorization+group admin tag user assignment,dual-layer config architecture superAdminConfig/groupAdminConfig,permission boundary validation frontend pre-check,3-level permission+lesson-level fine-grained control
/var/www/ai-platform/frontend/src/components/admin/settings/ModuleAuthorizationManagement/components/
GroupList.jsx[FE7M]: F:Organization list component | R:Collapse,GroupItem | A:None | S:Expand collapse organization list,selected highlight,unconfigured group hint,statistics info display
GroupItem.jsx[FE7M]: F:Organization item component | R:Card,Tag | A:None | S:Single organization card,module stats/user stats,action buttons view/edit/delete
ModulePermissionSelector.jsx[FE8L]: F:Module permission selector core | R:Tree,Checkbox,Button | A:/teaching/modules/:id/lessons | S:Tree structure module->lesson,3-level permission checkboxes,select all/clear/inherit,lazy load lesson list,permission boundary frontend pre-check
TagItem.jsx[FE7M]: F:Tag item component | R:Card,Switch,Badge | A:None | S:Tag permission config card,inherit switch,user list expand,statistics info
UserItem.jsx[FE5S]: F:User item component | R:Card,Tag | A:None | S:User permission config card,inherit switch,delete button,permission status display
OperationBar.jsx[FE5S]: F:Operation bar component | R:Space,Button | A:None | S:Save/cancel/reset/preview buttons,status hint,quick actions
PermissionHelpAlert.jsx[FE3S]: F:Permission help alert component | R:Alert | A:None | S:3-level permission explanation,operation hints,collapse expand
/var/www/ai-platform/frontend/src/components/admin/settings/ModuleAuthorizationManagement/hooks/
useAuthorizationData.js[FE8M]: F:Authorization data Hook | R:teachingStore,adminStore,authStore | A:Data fetch and management | S:Get module/organization/tag/user lists,dual-layer config loading,permission upper limit query getSuperAdminConfig
useAuthorizationState.js[FE7M]: F:Authorization state Hook | R:useState,useCallback | A:State management | S:currentGroup/selectedModules/tagConfigs/userConfigs state management,state reset/update methods
usePermissionLogic.js[FE8L]: F:Permission logic Hook | R:permissionBoundary,permissionCalculator | A:Business logic | S:Permission calculation/validation/merge,inheritance logic handling,boundary check,conflict detection
/var/www/ai-platform/frontend/src/components/admin/settings/ModuleAuthorizationManagement/utils/
permissionBoundary.js[FE7S]: F:Permission boundary validation tool | R:None | A:Utility function | S:validatePermissionBoundary frontend validation,recursive check tags users,error message collection
permissionCalculator.js[FE5S]: F:Permission calculator tool | R:None | A:Utility function | S:Calculate effective permission,inheritance chain calculation,max permission merge
permissionMigration.js[FE5S]: F:Permission migration tool | R:None | A:Utility function | S:v1->v2 dual-layer architecture migration,config format conversion,compatibility handling
deepCopy.js[FE3S]: F:Deep copy tool | R:None | A:Utility function | S:Deep clone object,prevents reference pollution
/var/www/ai-platform/frontend/src/components/admin/settings/ModuleAuthorizationManagement/constants/
permissionTypes.js[FE5S]: F:Permission type constants | R:None | A:Constant definition | S:3-level permission definition view_lesson/view_plan/edit,permission mapping,default values
uiMessages.js[FE3S]: F:UI message constants | R:None | A:Constant definition | S:Error hints/success messages/confirm dialog text
--Frontend State Management--
/var/www/ai-platform/frontend/src/stores/
teachingStore.js[FE7RL]: F:Intelligent teaching system state management | R:api,message | A:/teaching/modules,/teaching/lessons,/teaching/permissions,/teaching/groups,/teaching/teaching-plan | S:Zustand manages module+lesson+group+permission+teaching plan,403 error friendly handling avoids detail page error on redirect,teaching plan save+get functionality,draft auto save+browse history
--Edge Files--
/var/www/ai-platform/backend/src/controllers/TeachingController.dual_layer_save.js, TeachingController.js.new

Module 11: HTML Editor
--Backend Routes--
/var/www/ai-platform/backend/src/routes/
htmlEditor.js[RH5S]: F:HTML editor route definition | R:HtmlEditorController,authenticate | A:/html-editor/credits-config,/html-editor/projects,/html-editor/pages,/html-editor/templates | S:Credits config query+project CRUD 4 endpoints+page CRUD 6 endpoints+publish toggle+template list
--Backend Controllers--
/var/www/ai-platform/backend/src/controllers/
HtmlEditorController.js[CH7PL]: F:HTML editor controller v1.1 page list limit fix | R:HtmlProject,HtmlPage,User,dbConnection | A:/html-editor/projects,/html-editor/pages,/pages/:userId/:slug | S:Auto create default project,3 credits deduction types create 10/update 2/publish 5,title-only update no credits,default project delete protection,permanent link generation,v1.1 getPages default limit changed from 20 to 500 fixes page missing issue
--Data Models--
/var/www/ai-platform/backend/src/models/
HtmlProject.js[DH7M]: F:HTML project/folder model | R:dbConnection | A:None | S:Tree structure recursive query,tag safeJsonParse encoding fix,cascade delete sub-projects,ownership check,default project marker
HtmlPage.js[DH7M]: F:HTML page model | R:dbConnection,crypto | A:None | S:Page CRUD,slug unique generation keeps only alphanumeric+6 random chars,compileContent compiles HTML+CSS+JS,publish management is_published/publish_url,version number auto increment
--Frontend Utils--
/var/www/ai-platform/frontend/src/utils/
monacoConfig.js[FUH5CS]: F:Monaco editor config | R:None | A:None | S:Simplified version only provides editor options config no loading interference,defaultEditorOptions default config,themes config vs-dark/vs-light
--Frontend Pages--
/var/www/ai-platform/frontend/src/pages/htmlEditor/
HtmlEditor.jsx[FH8PL]: F:HTML editor main page v1.5 permanent link optimization | R:htmlEditorStore,authStore,@monaco-editor/react,i18n | A:/html-editor/projects,/html-editor/pages,/html-editor/credits-config | S:iOS style design,Monaco editor integration,project/page management CRUD,3 credits deduction types,real-time preview iframe desktop/tablet/mobile 3 modes,permanent link generation,dark/light theme switch,v1.1 fix Monaco right-click menu Paste not working+custom clipboard Action,v1.2-v1.4 fix auto create page loop refresh+useRef track state+wait for credits load complete,v1.5 removed generate link confirm+success popup added close button
HtmlEditor.less[FH3S]: F:HTML editor styles | R:HtmlEditor.jsx | A:None | S:iOS style styles,page list scroll style page-list-scroll
--Frontend State Management--
/var/www/ai-platform/frontend/src/stores/
htmlEditorStore.js[FH7M]: F:HTML editor state management v1.1 page list limit fix | R:apiClient,message | A:/html-editor/projects,/html-editor/pages,/html-editor/templates | S:Project/page/template CRUD,current page state,publish/unpublish,page list local update,v1.1 getPages default limit changed to 500 fixes page missing+added pagination/hasMore state+added loadMorePages method for scroll loading

Module 12: Smart Calendar
--Backend Routes--
/var/www/ai-platform/backend/src/routes/
calendar.js[RL7PM]: F:Calendar route definition | R:CalendarController,authenticate,requirePermission,rateLimit | A:/calendar/events,/calendar/categories,/calendar/ai-analysis,/calendar/background-knowledge,/calendar/settings | S:26 endpoints,event management 8 endpoints+category 4 endpoints+AI analysis 5 endpoints+background knowledge 5 endpoints+settings 3 endpoints+statistics 1 endpoint,dual rate limit 60/min+AI analysis 5/5min
--Backend Controllers--
/var/www/ai-platform/backend/src/controllers/
CalendarController.js[CL7PL]: F:Calendar controller | R:CalendarEvent,CalendarCategory,CalendarAIAnalysis,CalendarUserSettings,CalendarBackgroundKnowledge,CalendarService | A:/calendar/events,/calendar/categories,/calendar/ai-analysis,/calendar/background-knowledge,/calendar/settings | S:Event CRUD+category management+AI analysis+background knowledge management,content optional title required default status daily,monthly stats+batch delete+quick complete
--Backend Services--
/var/www/ai-platform/backend/src/services/
CalendarService.js[SL8PECM]: F:Calendar AI analysis service | R:CalendarEvent,CalendarAIAnalysis,CalendarConfig,CalendarPromptTemplate,CalendarBackgroundKnowledge,AIModel,User,AIService,dayjs | A:Internal service | S:Configurable credits multiplier+prompt template rendering+background knowledge concatenation,Prompt building includes title field,timezone fix dayjs handling
--Data Models--
/var/www/ai-platform/backend/src/models/
CalendarEvent.js[DL7M]: F:Calendar event model | R:dbConnection | A:None | S:title required content optional,event CRUD+status management+recurring events+monthly stats backtick avoids MySQL reserved word conflict,importance range 0-10 validation
CalendarConfig.js[DL5CS]: F:Calendar config model | R:dbConnection | A:None | S:Credits multiplier config singleton pattern range 1.0-10.0,auto create default config 1.0 if not exists
CalendarAIAnalysis.js[DL7M]: F:Calendar AI analysis record model | R:dbConnection,errors,logger | A:None | S:Analysis history CRUD+stats getUserStats,analysis_result JSON parsing,credits_consumed credits consumed,paginated query getUserAnalyses,ownership check
CalendarCategory.js[DL5M]: F:Calendar category data model | R:dbConnection,errors,logger | A:None | S:System preset+user custom dual type,getUserCategories gets user available categories,system category cannot modify delete protection,check events under category prevents accidental delete
CalendarUserSettings.js[DL5M]: F:Calendar user settings model | R:dbConnection,errors,logger | A:None | S:getOrCreate auto create default settings,AI analysis config scan_days_before/scan_days_after/template_id,auto analysis frequency daily/weekly/monthly,reset
CalendarBackgroundKnowledge.js[DL5M]: F:Calendar background knowledge model | R:dbConnection,errors,logger | A:None | S:User background info management for AI analysis context,getEnabledKnowledge gets enabled entries,title 100+content 2000 char limit,reorder batch sort transaction,toggleEnabled status toggle
CalendarPromptTemplate.js[DL5CM]: F:Calendar prompt template model | R:dbConnection,errors,logger | A:None | S:Prompt template CRUD+default template management,renderPrompt variable replacement {key} placeholder,display_order sorting,is_default unique default protection cannot delete,CalendarService reference
--Frontend Pages--
/var/www/ai-platform/frontend/src/pages/calendar/
Calendar.jsx[FL8L]: F:Smart calendar page | R:useCalendarStore,useAuthStore,BackgroundKnowledgeManager,dayjs,ReactMarkdown,antd | A:None | S:Mobile Tab navigation optimization+grid calendar view 3x3/4x4,AI analysis settings persisted to database,content optional default status daily,background knowledge management Modal
--Frontend State Management--
/var/www/ai-platform/frontend/src/stores/
calendarStore.js[FL8L]: F:Calendar state management | R:api,message | A:/calendar/events,/calendar/categories,/calendar/ai-analysis,/calendar/background-knowledge,/calendar/settings | S:Zustand manages events+categories+AI analysis+background knowledge+settings,autoPerformAnalysis auto analysis 24hr check

Module 13: Storage Management System
--Frontend Pages--
/var/www/ai-platform/frontend/src/pages/storage/
StorageManager.jsx[FS8L]: F:Smart cloud storage main page v1.1 | R:storageStore,authStore,react-dnd | A:None | S:iOS style interface,drag upload,grid/list dual view,right-click menu,folder tree flattened,v1.1 added smart cloud storage title+folder list subtitle+current folder name display
StorageManager.less[FS5M]: F:Smart cloud storage styles v1.1 | R:StorageManager.jsx | A:None | S:Gradient color system,iOS style cards,file type colored gradients,v1.1 added folder-list-title+current-folder-name styles
--Frontend i18n--
/var/www/ai-platform/frontend/src/locales/zh-CN/
storage.json[FS5C]: F:Smart cloud storage i18n | R:i18n | A:None | S:File management all Chinese text,v1.1 added smartStorage/folderList/myFolder
--Backend Routes--
/var/www/ai-platform/backend/src/routes/
storageRoutes.js[RS7S]: F:Storage management routes | R:StorageController,authMiddleware | A:/storage/files,/storage/folders | S:File upload/delete/move,folder create/rename/delete,storage stats,batch delete
--Backend Controllers--
/var/www/ai-platform/backend/src/controllers/
StorageController.js[CS8PTRL]: F:Storage management controller | R:UserFile,UserFolder,ossService,multer,dbConnection | A:/storage/files/upload,/storage/folders/:id/rename | S:Disk storage avoids memory overflow,filename encoding fix latin1->utf8,3 folder types permission global/group/personal,credits deduction transaction+row lock fixes concurrency,100+ file type whitelist,folder rename recursive update sub-paths
--Backend Services--
/var/www/ai-platform/backend/src/services/
ossService.js[SS9EM]: F:OSS storage service | R:ali-oss,fs,dbConnection | A:Internal service | S:Aliyun OSS+local storage dual mode,config reads from system_settings,secret hiding detection ******,signed URL generation,thumbnail processing OSS image processing,batch delete
--Data Models--
/var/www/ai-platform/backend/src/models/
UserFolder.js[DS7RTM]: F:User folder model | R:dbConnection | A:None | S:3 folder types personal/global/group,recursive update sub-folder paths on rename,tree structure query,cascade soft delete,auto create organization folder
UserFile.js[DS7RM]: F:User file model | R:dbConnection,ossService | A:None | S:uploaded_by records uploader,soft delete+storage stats update,3 folder types permission query,file move,ownership check,default 10GB quota
--Frontend State Management--
/var/www/ai-platform/frontend/src/stores/
storageStore.js[FS7M]: F:Storage management state | R:apiClient | A:/storage/files,/storage/folders,/admin/oss/,/admin/storage-credits/ | S:Folder tree+3 folder types global/org/personal,file upload progress,batch delete,folder rename,OSS config management,credits calculation 5MB segments
--Edge Files--
/var/www/ai-platform/frontend/src/pages/storage/StorageManager.jsx.error.20250827_024403

Module 14: OCR
--Backend Routes--
/var/www/ai-platform/backend/src/routes/
ocrRoutes.js[RO5ES]: F:OCR route definition | R:OcrController,authenticate,multer,requireSuperAdmin | A:/ocr/config,/ocr/process-image,/ocr/process-pdf,/ocr/process-batch,/ocr/tasks | S:7 endpoints,multer config 50MB+20 files+7 MIME types,single image/PDF/batch processing+task details history+admin config update
--Backend Controllers--
/var/www/ai-platform/backend/src/controllers/
OcrController.js[CO5EPS]: F:OCR controller | R:ocrService,ResponseHelper,dbConnection,User | A:/ocr/config,/ocr/process-image,/ocr/process-pdf,/ocr/process-batch,/ocr/tasks | S:7 endpoints,single image/PDF/batch processing+task history+config management,multer file upload validation 7 MIME types,credits check+deduction,batch processing error collection
--Backend Services--
/var/www/ai-platform/backend/src/services/
ocrService.js[SO7PEL]: F:OCR recognition service | R:axios,dbConnection,ossService,User | A:Mistral OCR API | S:Mistral OCR API integration supports image+PDF,Base64 conversion+180s timeout,per-page billing image 5 credits/PDF page 3 credits,filename encoding fix latin1->utf8,cleanup OCR result cleanupOCRResult removes empty tables,24hr dedup
--Frontend State Management--
/var/www/ai-platform/frontend/src/stores/
ocrStore.js[FO5S]: F:OCR frontend state management | R:zustand,apiClient,message | A:/ocr/config,/ocr/process-image,/ocr/process-pdf,/ocr/process-batch,/ocr/tasks | S:Single image/PDF/batch 3 modes,FormData upload multipart,task list paginated,config management config

Module 15: Mind Map
--Frontend Pages--
/var/www/ai-platform/frontend/src/pages/mindmap/
Mindmap.jsx[FH8PL]: F:Mind map main page v1.2 fix zoom error | R:markmap-lib,markmap-view,MermaidPreview,SvgPreview,authStore | A:/mindmap,/mindmap/credits-config,/mindmap/export-log | S:iOS tech style design,Markdown/Mermaid/SVG 3 modes,credits management,export SVG/PNG/PDF/MD,v1.1 fix PDF export text empty+layout 30%/70%,v1.2 fix SVG mode d3-zoom error+CSS transform scaling
Mindmap.less[FH3S]: F:Mind map styles v1.2 fix zoom | R:Mindmap.jsx | A:None | S:iOS tech style,editor 30% preview 70% layout,v1.2 gave SVG explicit pixel size avoids d3-zoom error
/var/www/ai-platform/frontend/src/pages/mindmap/components/
SvgPreview.jsx[FH4M]: F:SVG preview component v1.5 safe rendering | R:DOMPurify | A:None | S:v1.1 fix SVG size issue,v1.2 supports foreignObject+HTML content,v1.3 complex SVG uses iframe rendering,v1.4-v1.5 fix sandbox security warning+CSS works normally
MermaidPreview.jsx[FH3S]: F:Mermaid flowchart preview component | R:mermaid | A:None | S:Mermaid syntax rendering,real-time preview
/var/www/ai-platform/frontend/src/pages/mindmap/constants/
templates.js[FH2S]: F:Mind map default templates | R:None | A:None | S:Markdown/Mermaid/SVG 3 template sample code
--Backend Routes--
/var/www/ai-platform/backend/src/routes/
mindmapRoutes.js[RO5PBM]: F:Mind map route definition | R:authenticate,dbConnection,SystemConfig,User | A:/mindmap/credits-config,/mindmap/,/mindmap/export-log | S:7 endpoints,credits config+check credits+list+save+update+export log+delete,supports markdown/mermaid/svg 3 modes
--Edge Files--
/var/www/ai-platform/frontend/src/pages/mindmap/components/index.js

Module 16: Admin Backend
--Backend Routes--
/var/www/ai-platform/backend/src/routes/admin/
userRoutes.js[RAC8RS]: F:User management routes v1.1 batch create | R:UserManagementController,authMiddleware,permissions | A:/api/admin/users,/api/admin/users/batch-create,/api/admin/users/:id/* | S:User CRUD+account expiry+model permission+remove from group,v1.1 added POST /batch-create batch create users route
usageLogRoutes.js[RAC7RS]: F:Usage log routes v1.1 view chat permission | R:UsageLogController,authMiddleware | A:/api/admin/usage-logs,/api/admin/usage-logs/can-view-chat | S:Usage log list+summary+export,v1.1 added GET /can-view-chat check group admin view chat permission
userTagRoutes.js[RAC7RS]: F:User tag routes | R:UserTagController,authMiddleware | A:/admin/user-tags/* | S:12 endpoints,in-group tag CRUD+user tag assign/remove+batch operations+filter users+statistics,requirePermission('user.manage') permission control
systemPromptRoutes.js[RAC7RS]: F:System prompt routes | R:SystemPromptController,authMiddleware | A:/admin/system-prompts/* | S:7 endpoints,CRUD+feature toggle toggle+status query,requireRole(['super_admin']) super admin exclusive
groupRoutes.js[RAC8RSL]: F:User group routes | R:UserGroupController,permissions,systemUploadMiddleware | A:/admin/user-groups/* | S:16 endpoints,group CRUD+credits pool+invitation code+expiry+site config+Logo upload,dual-layer permission user.manage/group.manage distinguishes group admin and super admin
modelRoutes.js[RAC7RS]: F:AI model management routes | R:AIModelController,permissions | A:/admin/models/* | S:7 endpoints,CRUD+test connection+group management,canViewAIModels/canManageAIModels dual-layer permission
analyticsRoutes.js[RAC7RS]: F:Data analytics routes | R:AnalyticsController,authMiddleware | A:/admin/analytics/* | S:3 endpoints,comprehensive analysis+export report+realtime dashboard,requireRole(['admin','super_admin'])
moduleRoutes.js[RAC8RS]: F:System module routes | R:ModuleController,superAdminMiddleware | A:/admin/modules/* | S:9 endpoints,user modules 2 public+module CRUD 7 super admin exclusive,health check+status toggle
ossRoutes.js[RAC5RS]: F:OSS config routes | R:OSSConfigController,permissions | A:/admin/oss/* | S:6 endpoints,OSS config+test connection+credits config+statistics,canManageSystem() super admin exclusive
--Backend Controllers--
/var/www/ai-platform/backend/src/controllers/admin/
UserManagementController.js[CA8RMv1.2]: F:User management controller v1.2 view chat permission | R:UserService,ResponseHelper,CacheService | A:GET/POST/PUT/DELETE /admin/users/*,POST /admin/users/batch-create | S:User list with tags/details/CRUD,model permission query update,remove from group,account expiry setting/extension/sync group expiry,v1.1 batch create users,v1.2 added can_view_chat_history field read/write supports group admin view chat permission
UsageLogController.js[CA7RSv1.1]: F:Usage log controller v1.1 view chat permission | R:UsageLogService,User,ResponseHelper | A:/admin/usage-logs,/admin/usage-logs/summary,/admin/usage-logs/export,/admin/usage-logs/can-view-chat | S:Usage log list+summary stats+Excel export,v1.1 added canViewChat method checks group admin can_view_chat_history permission
UserGroupController.js[CA8RETM]: F:User group management controller | R:GroupService,UserFolder,ossService,CacheService | A:GET/POST/PUT/DELETE /admin/groups/* | S:Group CRUD+auto create OSS folder,credits pool allocate/reclaim,invitation code CRUD+log query,member limit/expiry/site config
AnalyticsController.js[CC7RS]: F:Data analytics controller | R:AnalyticsService,ResponseHelper,moment,ROLES | A:/admin/analytics,/admin/analytics/export,/admin/analytics/dashboard | S:3 methods getAnalytics/exportAnalytics/getDashboard,group admin data isolation actualGroupId,Excel export buffer response,serial query fixes MySQL concurrency issue
UserTagController.js[CA7RSM]: F:User tag management controller | R:UserTagService,ResponseHelper,logger,dbConnection | A:/admin/user-tags/group/:groupId,/admin/user-tags,/admin/user-tags/:id,/admin/user-tags/user/:userId,/admin/user-tags/filter-users,/admin/user-tags/statistics/:groupId | S:12 methods,in-group tag CRUD+batch get getBatchTagInfo,user tag assign/remove/overwrite update,filter users by tags AND/OR,group admin permission check can only operate own group
SystemPromptController.js[CA7RSM]: F:System prompt management controller | R:SystemPrompt,SystemConfig,ResponseHelper,logger,CacheService | A:/admin/system-prompts,/admin/system-prompts/:id,/admin/system-prompts/toggle,/admin/system-prompts/status | S:7 methods,CRUD+feature toggle toggle+status query,cache clear,super admin exclusive
ModuleController.js[CA8RSL]: F:System module management controller | R:Module,ResponseHelper,JWTService,logger,CacheService | A:/admin/modules,/admin/modules/:id,/admin/modules/user-modules,/admin/modules/:id/auth-url,/admin/modules/:id/health | S:9 methods,system/external module dual type management,getUserModules user accessible modules,getModuleAuthUrl JWT auth URL generation,health check,core module cannot disable/delete protection
OSSConfigController.js[CA5RCEM]: F:OSS config management controller | R:ResponseHelper,logger,dbConnection,ali-oss | A:/admin/oss/config,/admin/oss/test,/admin/oss/credits,/admin/oss/stats | S:6 methods,OSS config CRUD+test connection,Aliyun OSS+local storage dual mode,accessKeySecret secret hiding ******,storage credits config transaction update,storage stats
--Backend Services--
/var/www/ai-platform/backend/src/services/admin/
UserService.js[SAC9URETL]: F:User management service v1.1 batch create+email optional | R:User,GroupService,SystemConfig,moment,bcrypt | A:None | S:User CRUD+soft delete,group change credits return logic,model permission management,remove from group functionality,account expiry management+group sync,v1.1 added batchCreateUsers batch create users username rule generation+group credits pool deduction+random/unified password+transaction row lock,email changed to optional validateUserData
UsageLogService.js[SAC7S]: F:Usage log service | R:dbConnection | A:None | S:Usage log list paginated+summary stats+TOP users+model usage distribution,group admin data isolation,Excel export data formatting
GroupService.js[SAC9GRETL]: F:User group service | R:User,AIModel,dbConnection | A:None | S:Group CRUD+clone,credits pool credits_pool/credits_pool_used allocate reclaim,member limit user_limit check,group expiry expire_date sync,site config site_customization,invitation code system 5 uppercase chars+usage limit+logs,auto assign AI models
UserTagService.js[SAC7UT]: F:User tag service | R:dbConnection | A:None | S:Tag CRUD,batch get getBatchTagInfo,assign/remove/overwrite update user tags,filter users by tags AND/OR relationship,tag stats+user count,in-group tag isolation
AnalyticsService.js[SCC7L]: F:Data analytics BI service | R:dbConnection,XLSX,moment,errors | A:Internal service | S:Comprehensive analysis 6 dimensions overview/timeSeries/users/models/modules/tags,time granularity day/week/month,user distribution 5 credits ranges,TOP20 user ranking,model analysis chat+image dual type,Excel export multi-Sheet,fix deleted_at filter 20+ queries
StatsService.js[SCC8M]: F:System stats service | R:dbConnection,errors | A:Internal service | S:6 stats types user/group/conversation/model/credits/realtime,group admin data isolation,online user 5min activity check,today's data stats,7-day trend analysis,credits expiring reminder expiring_soon,fix deleted_at filter 15+ queries
--Stats Controller--
/var/www/ai-platform/backend/src/controllers/
statsController.js[COC7S]: F:Stats controller | R:StatsService,User,dbConnection | A:/stats/realtime,/stats/online-users,/stats/heartbeat,/stats/user-credits | S:Realtime stats,online user list,heartbeat endpoint 5min activity check,user credits stats today's consumption+group info+expiry status,direct DB query no Redis
--Frontend Pages--
/var/www/ai-platform/frontend/src/pages/admin/
Settings.jsx[FA9CRL]: F:Admin backend settings main page v1.4 smart apps | R:adminStore,authStore,systemConfigStore,25+ settings components | A:Aggregates all /admin/* settings | S:Tabs aggregate 25+ settings components,super admin sees all/group admin sees stats+logs+teaching+models,AI model CRUD+test,system module CRUD+health check,v1.4 added smart app management Tab
Users.jsx[FC8RL]: F:User management main page v1.1 batch create | R:adminStore,authStore,14 sub-components | A:/admin/users,/admin/user-groups,/admin/user-tags | S:3 tab pages users/groups/tags,search state preserved prevents loss,pagination dual-layer user+group,group credits pool+invitation code+site config+expiry management,v1.1 added batch create button+BatchCreateUsersModal popup
Analytics.jsx[FA8L]: F:Data analytics BI page iOS style | R:analyticsStore,adminStore,authStore,ECharts,dayjs | A:None | S:6 dimension analysis overview/timeSeries/users/models/modules,iOS tech style gradient color charts,TOP20 user ranking with module consumption details chat/image/video/storage/html,time granularity day/week/month filter,RangePicker date range,Excel export,group admin data isolation actualGroupId
/var/www/ai-platform/frontend/src/pages/dashboard/
Dashboard.jsx[FC8M]: F:Dashboard page | R:authStore,moduleStore,apiClient,ReactMarkdown | A:/stats/user-credits,/admin/announcement | S:Welcome message+date time,feature module grid excludes admin and dashboard,credits center 4 stats,system announcement Markdown edit super admin,mobile responsive
--Frontend Components--
/var/www/ai-platform/frontend/src/components/admin/settings/
UsageLogs.jsx[FA7RMv1.2]: F:Usage logs component v1.2 permission hide | R:adminStore,authStore,apiClient,ConversationContentDrawer | A:/admin/usage-logs,/admin/usage-logs/summary,/admin/usage-logs/can-view-chat | S:Usage log list+summary stats+TOP users,v1.1 permission check canViewChat,v1.2 completely hides content column when no permission useMemo dynamic column generation,group admin unaware of view functionality existence
SmartAppSettings.jsx[FA8CMv1.2]: F:Smart app management component v1.2 temperature input optimization | R:api,Form,Table,Modal,Switch | A:/admin/smart-apps/* | S:Smart app CRUD table+edit popup,category/publish status filter,toggle publish Switch,copy app functionality,v1.2 temperature changed from Slider to InputNumber manual input range 0-2 step 0.1
SystemModuleFormModal.jsx[FA7CRLv1.1]: F:System module form modal v1.1 icon expansion | R:adminStore,Form,Modal,Select,*Icons | A:Via Settings.jsx | S:System/external module edit form,v1.1 icon selector expanded from 22 to 180+ uniqueIcons deduped sorted+listHeight 400+filterOption fuzzy search,SSO JWT auth config secret/algorithm/expiresIn/tokenMethod/ssoEndpoint,Payload field selection 11 user fields,access permission allowed_groups multi-select,core module isCoreModule restrict editing
/var/www/ai-platform/frontend/src/components/admin/users/
BatchCreateUsersModal.jsx[FA7UPM]: F:Batch create users modal v1.1 new | R:Form,InputNumber,Select,Table,Statistic,adminStore | A:None | S:Username rule generation prefix+separator+sequence+digits,group credits pool balance check+deduction preview,unified/random password switch,creation result table,copy to clipboard+CSV export functionality
UserFormModal.jsx[FA7UMv1.3]: F:User form modal v1.3 view chat permission | R:Form,Input,Select,Tabs,Switch,moment | A:None | S:User create/edit form,UUID display+copy,account expiry management Tab,password reset Tab,v1.1 email changed to optional,v1.2 group admin special permission area+view group member chat records switch can_view_chat_history,v1.3 fix Switch initial value binding issue initialValues+setTimeout delayed setting
index.js[FA5S]: F:User component export index v1.1 update | R:16 user management components | A:None | S:Export UserTable/UserFormModal/UserSearchForm/UserDetailDrawer/UserGroupTable/UserGroupFormModal/UserCreditsTab/DistributeCreditsModal/GroupCreditsPoolModal/GroupUserLimitModal/GroupExpireDateModal/GroupSiteConfigModal/GroupInvitationCodeModal/GroupInvitationLogsModal/UserModelRestrictModal,v1.1 added BatchCreateUsersModal export
UserTable.jsx[FA7M]: F:User list table | R:Table,Tag,Space,Popconfirm | A:None | S:User table display,status/role/group Tag,action buttons edit/delete/reset password/model permission/tag management/credits allocation,permission control,pagination
UserSearchForm.jsx[FA5S]: F:User search form | R:Form,Input,Select,Button | A:None | S:Username/email/role/status/group multi-condition search,reset functionality
UserDetailDrawer.jsx[FA5M]: F:User detail drawer | R:Drawer,Descriptions,Statistic | A:None | S:User basic info/credits info/account info display,Token usage stats,expiry display
UserGroupTable.jsx[FA7M]: F:User group list table | R:Table,Tag,Space,Popconfirm | A:None | S:Group table display,credits pool/member count/expiry,action buttons edit/delete/credits pool/limit/expiry/site config/invitation code,permission control
UserGroupFormModal.jsx[FA5M]: F:User group form modal | R:Form,Input,ColorPicker | A:None | S:Group create/edit form,color picker,expiry setting
UserCreditsTab.jsx[FA7PM]: F:User credits management Tab | R:Statistic,Table,Button | A:None | S:Credits stats cards,recharge/deduct operations,credits history table,expiry management
DistributeCreditsModal.jsx[FA5PM]: F:Credits distribution modal | R:Form,InputNumber,Radio | A:None | S:Group credits pool allocate/reclaim switch,balance display,reason description
GroupCreditsPoolModal.jsx[FA5PM]: F:Group credits pool settings modal | R:Form,InputNumber,Statistic | A:None | S:Credits pool total setting,current status display
GroupUserLimitModal.jsx[FA5S]: F:Group member limit settings modal | R:Form,InputNumber | A:None | S:Member limit setting,current count display
GroupExpireDateModal.jsx[FA5S]: F:Group expiry settings modal | R:Form,DatePicker,Switch | A:None | S:Group expiry setting,sync to members switch
GroupSiteConfigModal.jsx[FA5M]: F:Group site config modal | R:Form,Input,Upload | A:None | S:Site name/Logo config,preview functionality
GroupInvitationCodeModal.jsx[FA5M]: F:Group invitation code management modal | R:Form,Input,Switch,InputNumber | A:None | S:Invitation code setting/generation,usage limit,expiry
GroupInvitationLogsModal.jsx[FA5M]: F:Invitation code usage logs modal | R:Table,Modal | A:None | S:Invitation registration record list,paginated query
UserModelRestrictModal.jsx[FA7RM]: F:User model restriction modal | R:Modal,Checkbox,Table | A:/admin/users/:id/model-permissions,/admin/users/:id/model-restrictions | S:User available model list,restrict model selection,save restriction config
--Frontend i18n--
/var/www/ai-platform/frontend/src/locales/zh-CN/
admin.json[FA5Cv1.1]: F:Admin backend Chinese i18n v1.1 view chat permission | R:i18n | A:None | S:Admin backend all Chinese text,v1.1 added canViewChatHistory/canViewChatHistory.help/canViewChatHistory.warning group admin view chat permission related text
--Frontend State Management--
/var/www/ai-platform/frontend/src/stores/
moduleStore.js[FC7RS]: F:System module state management | R:apiClient | A:/admin/modules/user-modules | S:Zustand manages user accessible modules,getUserModules gets active module list,getModuleByName query by name,controls sidebar module display permission
adminStore.js[FA8OL]: F:Admin backend state v1.1 batch create | R:apiClient | A:/admin/users,/admin/users/batch-create,/admin/user-groups,/admin/models,/admin/settings,/admin/system-prompts,/admin/usage-logs | S:User/group/credits/model/system full management,include_tags support,invitation code management,site config,expiry management,v1.1 added batchCreateUsers batch create users API call
analyticsStore.js[FC7S]: F:Data analytics frontend state | R:zustand,api,message | A:/admin/analytics,/admin/analytics/dashboard,/admin/analytics/export | S:Fix API path removed /api prefix,filters filter startDate/endDate/groupId/tagIds/timeGranularity,Excel export blob download
statsStore.js[FC7S]: F:Stats data frontend state | R:zustand,apiClient | A:/stats/realtime,/stats/heartbeat | S:Cancelled WebSocket changed to 30s polling,realtimeStats 7 metrics,online count onlineCount,heartbeat endpoint
--Edge Files--
/var/www/ai-platform/backend/src/routes/admin/agentNodeTypes.js, apiServiceRoutes.js, calendarConfigRoutes.js, creditsRoutes.js, orgApplicationRoutes.js, statsRoutes.js, storageCreditRoutes.js
/var/www/ai-platform/backend/src/controllers/admin/AgentNodeTypeController.js, APIServiceController.js, CalendarConfigController.js, MindmapCreditsController.js, OrgApplicationController.js, StorageCreditController.js, SystemStatsController.js
/var/www/ai-platform/frontend/src/components/admin/settings/APIServiceActionModal.jsx, APIServiceFormModal.jsx, APIServiceTable.jsx, index.js, index.less
/var/www/ai-platform/frontend/src/components/admin/tags/index.js, TagStatistics.jsx, UserTagAssign.jsx, UserTagManager.jsx
/var/www/ai-platform/frontend/src/components/admin/users/UserTagFilter.jsx

Module 17: Other Tools & Services
--Database Services--
/var/www/ai-platform/backend/src/services/
statsService.js[SOC7M]: F:Stats data service | R:dbConnection | A:None | S:No Redis direct DB query,user online 5min check,today's active stats,hot models Top3,realtime stats 7 metrics
--Backend Routes--
/var/www/ai-platform/backend/src/routes/
stats.js[RC7S]: F:Stats data route definition | R:StatsController,authMiddleware | A:/api/stats/realtime,/api/stats/online-users,/api/stats/heartbeat,/api/stats/user-credits | S:4 endpoints realtime stats+online users+heartbeat+user credits stats,all routes require auth authenticate,online user list requires user.manage permission
--Frontend Pages--
/var/www/ai-platform/frontend/src/pages/ocr/
OcrTool.jsx[FO7PEL]: F:OCR text recognition tool page | R:useOcrStore,useAuthStore,Upload,Modal,Tabs,Collapse | A:/ocr/process-image,/ocr/process-pdf,/ocr/process-batch,/ocr/tasks,/ocr/config | S:3 recognition modes single image+PDF+batch max 20 files,credits billing image 5/each+PDF by page 3/page,file upload max 50MB,drag upload Dragger component,history Table display,iOS glass card style
--Edge Files--
/var/www/ai-platform/backend/src/services/statsService.js

Module 18: Smart App Plaza
--Backend Routes--
/var/www/ai-platform/backend/src/routes/
smartAppRoutes.js[RP8RM]: F:Smart app route definition v2.2 favorites feature | R:SmartAppController,authenticate,requireSuperAdmin | A:User-side /smart-apps,Admin-side /admin/smart-apps | S:User-side 10 endpoints GET list+GET categories+GET favorites list+GET details+GET config+POST usage record+POST add favorite+DELETE remove favorite+GET conversation+POST clear conversation,Admin-side 11 endpoints CRUD+toggle publish+category CRUD,v2.2 added 3 favorites routes GET /favorites+POST/:id/favorite+DELETE/:id/favorite,dual route export router+adminRouter
--Backend Controllers--
/var/www/ai-platform/backend/src/controllers/
SmartAppController.js[CP8RM]: F:Smart app controller v2.2 favorites feature | R:SmartApp,AIModel,ResponseHelper,logger,dbConnection | A:All smartAppRoutes endpoints | S:Dual controller SmartAppAdminController+SmartAppUserController,admin-side CRUD+toggle publish+category CRUD returns toFullJSON with system prompt,user-side list returns array format with is_favorited favorite status+details+config+usage record,v2.2 added 3 favorite methods getFavorites/addFavorite/removeFavorite,getCategories returns favoriteCount favorite count,v2.1 config sync getOrCreateConversation compares 4 config items auto UPDATE
--Backend Data Models--
/var/www/ai-platform/backend/src/models/
SmartApp.js[DP7CRMv2.2]: F:Smart app data model v2.2 favorites feature | R:dbConnection,logger | A:None | S:Smart app CRUD+publish toggle+usage count stats,v2.2 added 5 favorite methods addFavorite/removeFavorite/getFavorites/getFavoriteIds/isFavorited,findPublished supports userId param LEFT JOIN favorites table returns is_favorited status,toJSON outputs is_favorited field,v2.0 category_ids JSON array 1-3 categories+credits_per_use credits 0-9999+JSON_CONTAINS query+populateCategories batch populate
--Frontend Pages--
/var/www/ai-platform/frontend/src/pages/smartApps/
SmartApps.jsx[FP8L]: F:App plaza main page v2.3 compact layout | R:useSmartAppStore,SmartAppChatModal,HeartOutlined,HeartFilled | A:/smart-apps,/smart-apps/categories,/smart-apps/favorites | S:iOS style app card grid,v2.2 favorites feature favoriteCount+toggleFavorite+handleFavoriteClick stop propagation,dynamic categories categories+categoryStats,Segmented category filter supports favorites value,hot badge use_count>10,v2.3 added PC 4 columns xs=12/sm=12/md=8/lg=6+mobile 6-grid 2 columns+isMobile responsive hides category labels+description single line ellipsis rows=1+Row gutter mobile 8/PC 12
SmartApps.less[FP5S]: F:App plaza styles v2.3 compact 6-grid | R:SmartApps.jsx | A:None | S:iOS style design,v2.2 favorite button heartBeat animation,v2.3 added category horizontal scroll overflow-x:auto+hidden scrollbar scrollbar-width:none+card compact min-height PC 160px/mobile 140px+padding PC 14px/mobile 10px+.mobile-card mobile centered layout flex-direction:column+icon 52px
--Frontend Components--
/var/www/ai-platform/frontend/src/components/admin/settings/
SmartAppSettings.jsx[FA8CM]: F:Smart app management component v2.0 category management+multi-category+credits | R:api,Form,Table,Modal,Switch,Drawer,ColorPicker | A:/admin/smart-apps/*,/admin/smart-apps/categories/* | S:Smart app CRUD table+edit popup,v2.0 added category management Drawer+category CRUD+ColorPicker color picker,category_ids multi-select Select max 3 categories,credits_per_use credits InputNumber range 0-9999,category/publish status filter by category_id,table shows multi-category Tag+credits Tag,copy app functionality
/var/www/ai-platform/frontend/src/components/smartApps/
SmartAppChatModal.jsx[FP8AL]: F:Smart app chat window component | R:apiClient,authStore,ReactMarkdown,remarkGfm,SyntaxHighlighter | A:/smart-apps/:id/conversation,/chat/conversations/:id/messages | S:Fixed centered popup not draggable,bottom-right resize-handle resize handle adjusts size,minimized floating ball bottom-right fixed position,pointer-events:none allows clicking outside window,conversation persisted localStorage stores window size,streaming output postStream,messages sorted by created_at,AI avatar lightning SVG+user first letter,code block highlight oneDark,ESC closes
SmartAppChatModal.less[FP5S]: F:Smart app chat window styles | R:SmartAppChatModal.jsx | A:None | S:wrapper layer pointer-events:none passthrough+window pointer-events:auto,fixed centered flex layout,gradient title bar+AI bubble,resize-handle bottom-right resize handle gradient background,minimized-ball floating ball hover scale animation,streaming-cursor blink animation,responsive mobile full width
index.js[FP3S]: F:Smart app component export index | R:SmartAppChatModal | A:None | S:Export SmartAppChatModal component
--Frontend State Management--
/var/www/ai-platform/frontend/src/stores/
smartAppStore.js[FP7M]: F:Smart app state management v2.2 favorites feature | R:apiClient,message | A:/smart-apps,/smart-apps/categories,/smart-apps/favorites,/smart-apps/:id,/smart-apps/:id/config,/smart-apps/:id/use,/smart-apps/:id/favorite,/smart-apps/:id/conversation,/smart-apps/:id/conversation/clear | S:Zustand manages apps array with is_favorited+categories+categoryStats+favoriteCount dynamically loaded from database,v2.2 added getFavorites gets favorites list+toggleFavorite toggles favorite status updates local apps and favoriteCount,getCategories returns {categories,stats,favoriteCount} 3 data,getAppsByCategory filters by category_ids multi-category,getOrCreateConversation gets or creates conversation+clearConversation clears conversation

Module 19: Wiki Knowledge Base
--Backend Routes--
/var/www/ai-platform/backend/src/routes/
wikiRoutes.js[RW7S]: F:Wiki route definition v3.0 version equality | R:WikiController,authMiddleware | A:/wiki/items,/wiki/items/:id,/wiki/items/:id/version,/wiki/items/:id/versions,/wiki/versions/:id(GET+PUT),/wiki/items/:id/versions/:versionId(DELETE),/wiki/items/:id/pin,/wiki/items/:id/editors | S:Wiki CRUD+version management,v3.0 added PUT /wiki/versions/:id save to specified version,removed rollback(version equality doesn't need),13 endpoints
--Backend Controllers--
/var/www/ai-platform/backend/src/controllers/
WikiController.js[CW8RML]: F:Wiki controller v3.0 version equality | R:WikiItem,ResponseHelper,logger | A:All wikiRoutes endpoints | S:14 methods,v3.0 added updateVersion save to specified version,updateItem changed to only update basic info is_pinned/sort_order,3-level scope permission personal/team/global,version create/history/delete,editor add/remove,pin toggle
--Backend Data Models--
/var/www/ai-platform/backend/src/models/
WikiItem.js[DW9RTJM]: F:Wiki data model type fix | R:dbConnection,errors,logger | A:None | S:Refactored version management all versions equal,added updateVersion save to specified version+createNewVersion copy based on specified version+updateBasicInfo update basic info,3-level scope personal/team/global,version management max 50 versions auto cleanup,JSON fields notes/links max 10 each,editor management wiki_editors table,permission check checkAccess/checkCanEdit/isEditor,fix createNewVersion type comparison bug converted wikiId/baseVersionId to parseInt+Number() ensures type consistency+auto fallback to latest version when current version doesn't exist
--Frontend State Management--
/var/www/ai-platform/frontend/src/stores/
wikiStore.js[FW8M]: F:Wiki state management v3.0 version equality | R:apiClient,message | A:/wiki/items,/wiki/items/:id,/wiki/items/:id/version,/wiki/items/:id/versions,/wiki/versions/:id(GET+PUT),/wiki/items/:id/versions/:versionId | S:v3.0 refactored uses currentVersion instead of selectedVersionNumber,added saveVersion save to specified version,switch version=switch workspace loads full content,Zustand manages items+currentItem+currentVersion+versions+editors,CRUD+version management createVersion/getVersions/switchToVersion/saveVersion/deleteVersion+editor management+pin toggle
--Frontend Pages--
/var/www/ai-platform/frontend/src/pages/wiki/
Wiki.jsx[FW8L]: F:Wiki main page v4.0 version equality | R:wikiStore,authStore,dayjs,i18n | A:None | S:v4.0 refactored version management logic:switch to which version edits that one+save to currently viewing version+new version copies based on current version,iOS frosted glass tech style design,3-level scope filter Segmented,card list Grid,edit Drawer,version dropdown select+3 buttons(new version/save/delete version),notes notes/links links max 10 each Form.List
Wiki.less[FW5M]: F:Wiki styles v3.1 | R:Wiki.jsx | A:None | S:iOS frosted glass tech style,gradient header+icon,card hover animation,scope label colored,edit drawer custom header,version dropdown menu wiki-version-dropdown,content label row wiki-content-label-row toolbar inline,responsive mobile adaptation
--Frontend i18n--
/var/www/ai-platform/frontend/src/locales/zh-CN/
wiki.json[FW5C]: F:Wiki i18n | R:i18n | A:None | S:Wiki all Chinese text,3-level scope/action buttons/form fields/version management/confirm dialogs

--Other Uncategorized Edge Files--
/var/www/ai-platform/frontend/src/pages/CustomLanding.jsx
/var/www/ai-platform/frontend/src/pages/error/NotFound.jsx
/var/www/ai-platform/frontend/src/pages/module/ModulePage.jsx, ModulePage.less
/var/www/ai-platform/frontend/src/pages/auth/OrgApplication.jsx, Register.jsx, SSOCallback.jsx
/var/www/ai-platform/frontend/src/components/common/ImageViewer.jsx, ImageViewer.less, LanguageSwitch.jsx
/var/www/ai-platform/frontend/src/components/Layout/MainLayout.jsx
/var/www/ai-platform/frontend/src/components/ProtectedRoute.jsx, ThemeProvider.jsx
/var/www/ai-platform/frontend/src/layout/AuthLayout.jsx, MainLayout.jsx
/var/www/ai-platform/frontend/src/services/messageRetryService.js
/var/www/ai-platform/frontend/src/utils/dateFormat.js, monacoConfig.js, permissions.js, socket.js, tagExport.js, tokenCalculator.js

===AI Application Platform Code Index Section-Complete===

===AI Application Platform Complete Database Index-20260127===
[Index Description]
Simplified tags[ABC]: A-Table type(U-User/T-Transaction/C-Content/S-System/L-Log/E-Teaching/A-Workflow/P-SmartApp/W-Wiki) B-Feature(P-Credits/S-SoftDelete/U-UUID-PK/J-JSON-Field/F-Multi-FK) C-Importance(9-Core/7-Business/5-Config/3-Auxiliary)
Field constraints: PK-Primary Key UK-Unique Key FK-Foreign Key IX-Index SD-Soft Delete JS-JSON CR-Credits DT-DateTime
Format: table_name[ABC] | primary_key | unique_keys | foreign_keys | indexes | special_fields

Total: 86 tables (including 3 views, 3 backup tables)

User Auth Module - 11 tables
users[U9PS] | id[PK] | uuid,email,username[UK] | group_id->user_groups[FK] | role,status,expire_at,credits_expire_at[IX] | credits_quota/used[CR],deleted_at[SD],can_view_chat_history[BOOL]
user_groups[U7PSJ] | id[PK] | name,invitation_code[UK] | created_by->users[FK] | is_active,sort_order[IX] | credits_pool/used[CR],expire_date[DT],site_customization[JS]
user_tags[U5F] | id[PK] | group_id+name[UK] | group_id->user_groups,created_by->users[FK] | is_active,sort_order[IX] | -
user_tag_relations[T5F] | id[PK] | - | user_id->users,tag_id->user_tags[FK] | - | -
user_tag_history[L3] | id[PK] | - | user_id->users,tag_id->user_tags,operator_id->users[FK] | created_at[IX] | -
user_sessions[L3] | id[PK] | - | user_id->users[FK] | expires_at[IX] | -
token_blacklist[L5] | id[PK] | token_jti[UK] | user_id->users[FK] | expires_at[IX] | -
invitation_codes[S5] | id[PK] | code[UK] | created_by->users[FK] | is_active,expires_at[IX] | -
invitation_code_logs[L3] | id[PK] | - | code_id->invitation_codes,user_id->users[FK] | created_at[IX] | -
user_activities[L5F] | id[PK] | - | user_id->users[FK] | created_at[IX] | -
permissions[S5] | id[PK] | - | - | - | -

Credits System - 3 tables
credit_transactions[T9PF] | id[PK] | - | user_id->users,operator_id->users,model_id->ai_models,conversation_id->conversations[FK] | user_id+created_at,transaction_type,request_id[IX] | amount,balance_after[CR]
billing_logs[L5PF] | id[PK] | - | user_id->users,conversation_id->conversations[FK] | user_id,created_at,billing_type[IX] | tokens_used,credits_used[CR]
storage_credit_config[S3P] | id[PK] | - | - | - | price_per_mb[CR]
storage_credits_config_simple[S3P] | id[PK] | - | - | - | base_credits,credits_per_5mb[CR]

Chat System - 3 tables
conversations[C9USJF] | id(uuid)[PK] | - | user_id->users,system_prompt_id->system_prompts,module_combination_id->module_combinations,smart_app_id->smart_apps[FK] | user_id,priority,model_name,cleared_at[IX] | cleared_at[DT],smart_app_id[FK]
messages[C9USJF] | id(uuid)[PK] | - | conversation_id->conversations,file_id->files[FK] | conversation_id,sequence_number,status[IX] | generated_images[JS]
files[C7UF] | id(uuid)[PK] | - | user_id->users,conversation_id->conversations[FK] | user_id,status[IX] | extracted_content[TEXT]

AI Model Config - 5 tables
ai_models[S7PJCF] | id[PK] | name[UK] | - | provider,is_active,is_public,credits_per_chat[IX] | api_key[ENC],model_config[JS],credits_per_chat[CR]
ai_model_groups[T5F] | id[PK] | model_id+group_id[UK] | model_id->ai_models,group_id->user_groups[FK] | - | -
user_model_restrictions[T3F] | id[PK] | - | user_id->users,model_id->ai_models[FK] | - | -
system_prompts[S5J] | id[PK] | - | - | is_active,sort_order[IX] | group_ids[JS],content[TEXT]
system_prompt_groups[T3F] | id[PK] | - | prompt_id->system_prompts,group_id->user_groups[FK] | - | -

Knowledge Module Magic Cube - 5 tables
knowledge_modules[C7PSJ] | id[PK] | - | creator_id->users,group_id->user_groups[FK] | module_scope,is_active[IX] | group_ids[JS],content[TEXT],tokens[CR]
module_combinations[C5J] | id[PK] | - | user_id->users[FK] | is_active[IX] | estimated_tokens[CR]
module_combination_items[T5F] | id[PK] | combination_id+module_id[UK] | combination_id->module_combinations,module_id->knowledge_modules[FK] | order_index[IX] | -
knowledge_module_tag_permissions[T3F] | id[PK] | - | module_id->knowledge_modules,tag_id->user_tags[FK] | - | -
system_modules[S5J] | id[PK] | name[UK] | - | module_category,is_active,sort_order[IX] | config[JS]

Smart App Plaza - 3 tables
smart_apps[P7PJCF] | id[PK] | - | model_id->ai_models,creator_id->users[FK] | is_published,sort_order[IX] | system_prompt[TEXT],temperature[DEC],context_length[INT],use_count[CR],credits_per_use[CR],category_ids[JS]
smart_app_categories[P5C] | id[PK] | name[UK] | - | sort_order,is_active[IX] | color[VARCHAR],updated_at[DT]
user_smart_app_favorites[P5F] | id[PK] | user_id+smart_app_id[UK] | user_id->users,smart_app_id->smart_apps[FK] | user_id,smart_app_id[IX] | created_at[DT]

Agent Workflow - 6 tables
agent_workflows[A7UJ] | id[PK] | - | user_id->users[FK] | is_published[IX] | flow_data[JS]
agent_executions[A7PJF] | id[PK] | - | workflow_id->agent_workflows,user_id->users[FK] | status,started_at[IX] | input/output_data,execution_log[JS],total_credits_used[CR]
agent_node_executions[A5PJF] | id[PK] | - | execution_id->agent_executions[FK] | node_type,status[IX] | input/output_data[JS],credits_used[CR]
agent_node_types[S5PJ] | id[PK] | type_key[UK] | - | category,is_active,display_order[IX] | config_schema[JS],credits_per_execution[CR],max_inputs[INT],max_outputs[INT]
agent_workflow_templates[S3J] | id[PK] | - | - | - | template_data[JS]
api_services[S5PF] | id[PK] | service_id[UK] | - | - | api_key[ENC],credits_per_call[CR]
api_service_actions[S3PF] | id[PK] | service_id+action_type[UK] | service_id->api_services[FK] | status[IX] | credits[CR]

Intelligent Teaching - 10 tables
teaching_modules[E7SF] | id[PK] | - | creator_id->users,owner_group_id->user_groups,deleted_by->users[FK] | visibility,status,is_deleted[IX] | deleted_at[SD]
teaching_lessons[E7SJF] | id[PK] | - | module_id->teaching_modules,creator_id->users,deleted_by->users[FK] | content_type,status,is_deleted[IX] | materials,content[JS],deleted_at[SD]
teaching_permissions[E5F] | id[PK] | module_id+lesson_id+user_id/group_id/tag_id+permission_type[UK] | module_id->teaching_modules,user_id->users,group_id->user_groups,tag_id->user_tags[FK] | permission_type[IX] | expires_at[DT]
teaching_module_groups[E3F] | id[PK] | - | - | - | -
teaching_module_group_relations[T3F] | id[PK] | - | module_id->teaching_modules,group_id->teaching_module_groups[FK] | - | -
teaching_global_authorizations[E5J] | id[PK] | - | - | - | permissions[JS]
teaching_lesson_plans[E3J] | id[PK] | - | lesson_id->teaching_lessons,user_id->users[FK] | - | content[JS]
teaching_lesson_drafts[E3J] | id[PK] | - | lesson_id->teaching_lessons,user_id->users[FK] | - | draft_content[JS]
teaching_view_logs[L5F] | id[PK] | - | module_id->teaching_modules,lesson_id->teaching_lessons,user_id->users[FK] | created_at[IX] | -
teaching_permissions_backup_20251031[L1] | - | - | - | - | BACKUP

Image Generation - 4 tables
image_models[S5PJ] | id[PK] | - | - | - | api_key[ENC],sizes_supported[JS],price_per_image[CR]
image_generations[C7PSJF] | id[PK] | - | user_id->users,model_id->image_models,parent_id->image_generations[FK] | task_id,status,is_public[IX] | buttons[JS],credits_consumed[CR]
midjourney_tasks[C5J] | id[PK] | - | user_id->users[FK] | task_id[IX] | response_data[JS]
gemini_files[L3] | id[PK] | - | - | - | -

Video Generation - 2 tables
video_models[S5PJ] | id[PK] | - | - | - | api_config[JS],price_multiplier[CR]
video_generations[C7PSJF] | id[PK] | - | user_id->users,model_id->video_models[FK] | task_id,status,is_public,provider[IX] | raw_response[JS],credits_consumed[CR]

HTML Editor - 5 tables
html_projects[E5SF] | id[PK] | - | user_id->users[FK] | is_default[IX] | deleted_at[SD]
html_pages[E7SJ] | id[PK] | user_id+slug[UK] | project_id->html_projects,user_id->users[FK] | is_published,view_count[IX] | compiled_content[TEXT],credits_consumed[CR]
html_templates[E3] | id[PK] | - | - | - | content[TEXT]
html_resources[E3] | id[PK] | - | - | - | -
html_pages_slug_backup[L1] | - | - | - | - | BACKUP

Storage System - 3 tables
user_folders[S7SF] | id[PK] | - | user_id->users,parent_id->user_folders,group_id->user_groups[FK] | folder_type,is_deleted[IX] | is_deleted[SD]
user_files[S7SF] | id[PK] | - | user_id->users,folder_id->user_folders,uploaded_by->users[FK] | is_deleted[IX] | is_deleted,deleted_at[SD]
user_storage[S5] | id[PK] | - | user_id->users[FK] | - | storage_used,quota[INT]

Smart Calendar - 8 tables
calendar_events[E5F] | id[PK] | - | user_id->users,parent_event_id->calendar_events[FK] | event_date,status,category[IX] | -
calendar_categories[E3] | id[PK] | - | user_id->users[FK] | - | -
calendar_ai_analyses[E5PJ] | id[PK] | - | user_id->users[FK] | analysis_date[IX] | ai_response[JS],credits_used[CR]
calendar_background_knowledge[E3J] | id[PK] | - | user_id->users[FK] | - | knowledge_content[JS]
calendar_config[S3P] | id[PK] | - | - | - | credit_multiplier[CR]
calendar_prompt_templates[E3] | id[PK] | - | - | - | template[TEXT]
calendar_prompt_templates_backup_20251011[L1] | - | - | - | - | BACKUP
calendar_user_settings[E3J] | id[PK] | - | user_id->users[FK] | - | settings[JS]

OCR - 2 tables
ocr_tasks[C5PF] | id[PK] | - | user_id->users[FK] | status[IX] | credits_consumed[CR]
ocr_results[C5J] | id[PK] | - | task_id->ocr_tasks[FK] | - | ocr_result[JS]

Wiki Knowledge Base - 3 tables
wiki_items[W7SJF] | id[PK] | - | creator_id->users,group_id->user_groups[FK] | scope,is_pinned,creator_id,group_id[IX] | notes[JS],links[JS],content[TEXT],current_version[INT],version_count[INT]
wiki_versions[W5JF] | id[PK] | wiki_id+version_number[UK] | wiki_id->wiki_items,created_by->users[FK] | wiki_id,version_number[IX] | notes_snapshot[JS],links_snapshot[JS],content[TEXT],change_summary[VARCHAR]
wiki_editors[W3F] | id[PK] | wiki_id+user_id[UK] | wiki_id->wiki_items,user_id->users,added_by->users[FK] | wiki_id[IX] | -

Other System - 12 tables
org_applications[S3] | id[PK] | - | - | - | -
application_form_config[S3J] | id[PK] | - | - | - | form_config[JS]
user_mindmaps[C3PJ] | id[PK] | - | user_id->users[FK] | - | mindmap_data[JS],credits_consumed[CR]
file_shares[C3F] | id[PK] | - | file_id->files,shared_by->users[FK] | - | expires_at[DT]
oss_config[S3J] | id[PK] | - | - | - | config[JS]
system_settings[S9J] | id[PK] | setting_key[UK] | - | - | setting_value[TEXT]
migrations_history[L3] | id[PK] | - | - | - | -
schema_migrations[L3] | version[PK] | - | - | - | -
casbin_rule[S5] | id[PK] | - | - | - | -
casbin_deny_policies[S3] | id[PK] | - | - | - | -
casbin_metadata[S3] | id[PK] | - | - | - | -
knex_migrations[L5] | id[PK] | - | - | - | name[VARCHAR],batch[INT],migration_time[DT]
knex_migrations_lock[S3] | index[PK] | - | - | - | is_locked[INT]

Views - 3
v_teaching_permission_hierarchy[VIEW] | Teaching permission hierarchy view
v_user_accessible_teaching_modules[VIEW] | User accessible modules view
v_user_tags_detail[VIEW] | User tags detail view

===AI Application Platform Complete Database Index-20260127-Complete===
