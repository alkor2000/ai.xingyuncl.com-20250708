===AI Application Platform Full Index-20260123===

[Index Notes]
This index enables AI attention mechanisms to quickly understand the full system architecture with concise and precise content

===Code Index Section===

Format: filename[tags]: F:Function | R:Relations | A:API paths | S:Summary
Tags[ABCDE]: Layer(F-Frontend/B-Backend/S-Service/C-Controller/M-Middleware/D-Database/U-Utility/R-Route) Module(C-Core/A-Auth/T-Chat/R-Credits/K-Knowledge/I-Image/V-Video/S-Storage/L-Calendar/E-Teaching/G-Workflow/H-Editor/P-SmartApp/O-Other/W-Wiki) Priority(9-Core/8-High/7-Business/5-Normal/3-Auxiliary) Features(P-Credits/A-Async-Stream/T-Transaction/E-External-API/C-Config/R-Permission) Size(L-Large/M-Medium/S-Small)

Module 1: Core System & Startup
--Backend Core--
/var/www/ai-platform/backend/src/
server.js[BCC9S]: F:Server startup entry | R:app.js,dbConnection,redisConnection | A:None | S:PM2 startup,DB/Redis init,SIGTERM graceful shutdown,port 4000
app.js[BCC9M]: F:Express app initialization | R:all routes,middleware | A:/health,/health/detailed,/pages/:userId/:slug | S:17 module routes incl smartAppRoutes+wikiRoutes,dynamic rate limiting,health check,CORS/helmet,static files
.env[BCC9S]: F:Environment variables config | R:config/index.js | A:None | S:Production env,MySQL/Redis connection,JWT strong secret,CORS whitelist,Casbin permission switch
--Config & Connection--
/var/www/ai-platform/backend/src/config/
index.js[BCC9M]: F:Unified config management | R:all modules | A:None | S:Env var management,smart Docker/PM2 detection,unified storage paths,JWT/CORS/Redis config
/var/www/ai-platform/backend/src/database/
connection.js[DCC9M]: F:MySQL connection pool management | R:all Model layer | A:None | S:MySQL2 singleton,auto transaction management,execute prepared statements,simpleQuery for LIMIT/OFFSET
redis.js[DCC9M]: F:Redis cache connection | R:cacheService,rateLimitService | A:None | S:Redis singleton,auto reconnect,keyPrefix isolation,JSON serialization,error tolerance non-blocking
--Utilities--
/var/www/ai-platform/backend/src/utils/
logger.js[UCC9M]: F:Winston log management | R:all modules | A:None | S:Auto create directories,file+console dual output,5MB rotation,supports Docker/PM2
response.js[UCC9S]: F:Unified response format | R:all Controllers | A:None | S:8 response methods,success/error/validation/unauthorized,unified timestamp and structure
errors.js[UCC9S]: F:Custom error class system | R:errorHandler,all Services | A:None | S:9 error classes,AppError base class,ValidationError/AuthenticationError etc
tokenCalculator.js[UTC8PM]: F:Token calculation estimation | R:ChatController,credits system | A:None | S:Separate CN/EN calculation,CN 1.5x EN 1.3x,formatTokenCount K unit formatting
--Middleware--
/var/www/ai-platform/backend/src/middleware/
errorHandler.js[MCC9M]: F:Global error handling | R:app.js,logger,response | A:None | S:Catch unhandled exceptions,JWT/DB/Multer errors,hide stack in production,process signal handling
authMiddleware.js[MAC9RM]: F:JWT auth and permission check | R:User model,redisConnection,all routes | A:None | S:SSE query param support,Token blacklist,account expiry,role/permission/group 4-layer check
uploadMiddleware.js[MO7S]: F:File upload middleware | R:multer,config,logger | A:Middleware | S:Multer image upload 6 formats,10MB limit single file,year/month chat-images directory,unique filename timestamp+MD5,getFileUrl public URL,deleteFile,handleUpload error wrapper
cacheMiddleware.js[MC7M]: F:API response cache middleware | R:redisConnection,logger | A:Middleware factory | S:GET only cache,Redis TTL default 300s,intercept res.json cache success,X-Cache header HIT/MISS,user ID or anonymous cache key,Redis unavailable graceful degradation
documentUploadMiddleware.js[MO5M]: F:Document upload middleware | R:multer,config,logger,fs,crypto | A:Middleware | S:PDF/Word/TXT/Excel/PPT/RTF 12 formats,disk storage avoid memory overflow,50MB limit,year/month categorize,filename encoding fix latin1->utf8,extractDocumentContent 10000 char limit
publicUploadMiddleware.js[MO5S]: F:Public upload middleware | R:multer,logger | A:Middleware | S:Business license no-auth upload,memoryStorage for OSS,6 image MIME+PDF,10MB limit
systemUploadMiddleware.js[MO3S]: F:System file upload middleware | R:multer,config,logger,crypto,fs | A:Middleware | S:Site Logo system file upload,disk storage,6 image formats incl SVG,2MB limit
--System Services--
/var/www/ai-platform/backend/src/services/
healthCheckService.js[SC9S]: F:Health check service | R:dbConnection,redisConnection,os | A:/health,/health/detailed | S:System/DB/Redis/Memory 4 checks,quick check for load balancer,detailed for monitoring,memory>90% alert
cacheService.js[SCC9TM]: F:Redis cache unified management | R:redisConnection | A:None | S:7 cache types,4-level TTL(5min/30min/2hr/24hr),fallback degradation,SCAN batch clear
rateLimitService.js[SC9CM]: F:Dynamic rate limit service | R:SystemConfig,express-rate-limit | A:Internal service | S:5 limiters(auth/emailCode/global/adminRead/adminWrite),enabled field disable support,config hot update clear cache,default 2000/15min global
emailService.js[SA7ECS]: F:Email service | R:nodemailer,SystemConfig,logger | A:SMTP external | S:Nodemailer email send,sendVerificationCode 6-digit 5min valid,sendTestEmail test,read SMTP config from SystemConfig
--Data Models--
/var/www/ai-platform/backend/src/models/
SystemConfig.js[DSC8M]: F:System config management | R:dbConnection | A:None | S:Key-value storage+auto type conversion(json/boolean/number/string),batch UPSERT update,getFormattedSettings nested structure
Module.js[DCO9CRL]: F:System module model | R:dbConnection,crypto | A:None | S:System/external module dual types,allowed_groups JSON permission,super admin force access admin module,config encrypt AES-256-CBC
--PM2 Config--
/var/www/ai-platform/
ecosystem.config.js[UC9CS]: F:PM2 process management config | R:None | A:None | S:PM2 config 2 processes ai-platform-auth backend 4000+ai-platform-frontend frontend 3000,backend 2GB+frontend 500M memory,log paths separated,auto restart 5s delay max 10 times
--Frontend Core--
/var/www/ai-platform/frontend/src/
main.jsx[FC9S]: F:React app entry | R:App,i18n,networkService | A:App startup | S:Network monitor service init mount to window.networkService,refresh user state on network recovery,no StrictMode in production avoid double render
App.jsx[FC9CM]: F:App entry main component v1.2 Wiki route | R:Router,ConfigProvider,ThemeProvider,authStore,systemConfigStore | A:Route config | S:React route config,lazy load 19 page modules incl SmartApps+Wiki,ProtectedRoute/PublicRoute guards,dynamic favicon+title update,i18n support,v1.2 added /wiki route
--Frontend Utils & Services--
/var/www/ai-platform/frontend/src/utils/
api.js[FU9ACEL]: F:API client wrapper | R:axios,authStore | A:Interceptor global config | S:Smart Token auto refresh max 3 times,401 intercept+queue retry,SSE stream postStream support,AbortController cancel,request tracking X-Request-ID
/var/www/ai-platform/frontend/src/services/
tokenRefreshService.js[SA9CM]: F:Token auto refresh service | R:authStore | A:Background scheduled task | S:Auto refresh 5min before expiry,parseExpiresIn(s/m/h/d),page visibility listener,30s periodic check,anti-duplicate refresh lock,singleton
networkService.js[FC9S]: F:Network status monitor service | R:message(antd) | A:Browser events | S:Simplified only listen browser online/offline no active check,message prompt network status,singleton
--Frontend State Management--
/var/www/ai-platform/frontend/src/stores/
systemConfigStore.js[FC9CL]: F:System config state management | R:apiClient,authStore | A:/admin/settings,/public/system-config,/admin/settings/upload-logo | S:Site config name/logo/description,user config registration switch/default credits token,group config priority userSiteConfig,admin/normal user dual API
--Frontend Build Config--
/var/www/ai-platform/frontend/
vite.config.js[FC5CS]: F:Vite build config | R:vite,react,vite-plugin-monaco-editor | A:Build config | S:Monaco Editor plugin complete Worker config,dev server 0.0.0.0+proxy /api to 4000,manualChunks split 8 vendor packages
package.json[FC9CS]: F:Frontend dependency management | R:None | A:Project config | S:React 18+Vite 5+Antd 5 tech stack,48 dependencies incl Monaco+ReactFlow+ECharts+Mermaid+Prism

Module 2: Authentication & Authorization System
--Backend Routes--
/var/www/ai-platform/backend/src/routes/
auth.js[RAC9S]: F:Auth route definitions | R:AuthControllerRefactored,authMiddleware | A:/auth/login,/auth/register,/auth/sso,/auth/send-email-code,/auth/verify-invitation-code,/auth/check-email | S:4 login methods,invitation code verify,registration check endpoints,9 public+5 authenticated endpoints
public.js[RC7CS]: F:Public route definitions | R:dbConnection,OrgApplicationController,PublicUploadController,publicUploadMiddleware | A:/public/custom-homepage,/public/system-config,/public/org-application/* | S:4 public endpoints no auth,JSON_OBJECT query config avoid multiple queries,error fallback return defaults ensure availability
--Backend Controllers--
/var/www/ai-platform/backend/src/controllers/
AuthControllerRefactored.js[CAC9RL]: F:Auth controller core | R:User,SystemConfig,SSOService,EmailAuthService,TokenService,SiteConfigService,GroupService | A:All auth route endpoints | S:16 methods,4 login types(password/code/email-password-code/SSO),invitation code registration,account expiry check,forced verification mode
PublicUploadController.js[CO5ES]: F:Public upload controller | R:multer,ossService,ResponseHelper,crypto | A:Internal call | S:Business license no-login upload,OSS/local auto switch,public/applications/{year}/{month} directory isolation
--Backend Services--
/var/www/ai-platform/backend/src/services/
jwtService.js[SAC9M]: F:Module JWT generation | R:User model,config | A:None | S:Support uuid/sub/name standard fields,4 transport methods query/header/cookie/post,SSO verify interface
authService.js[SAC5M]: F:Auth service legacy version | R:jwt,User,config,errors | A:Internal service | S:JWT generate/verify dual Token,register/login/refresh token,email format validation,password strength check 6 chars
/var/www/ai-platform/backend/src/services/auth/
TokenService.js[SAC9TM]: F:JWT token generate refresh | R:SystemConfig,redisConnection,config | A:None | S:access/refresh dual Token,dynamic expiry time,Redis blacklist,jti unique identifier,SSO user mark support
EmailAuthService.js[SAC8S]: F:Email verification code service | R:EmailService,redisConnection | A:None | S:6-digit code,5min valid,60s send limit,Redis storage,email service dependency check
SSOService.js[SAC9RS]: F:SSO single sign-on | R:User,SystemConfig | A:None | S:MD5 signature verify,IP whitelist,timestamp anti-replay 5min,auto create/update SSO user,account expiry check
SiteConfigService.js[SAC7CS]: F:Site config service | R:SystemConfig,logger | A:Internal service | S:getUserSiteConfig get user site config,group config priority group_site_name/group_site_logo,fallback default config prevent errors
--Data Models--
/var/www/ai-platform/backend/src/models/
User.js[DAC9PTRL]: F:User model core | R:bcrypt,dbConnection,logger | A:None | S:Soft delete auto rename release unique fields,3-layer permission super_admin/admin/user,credits full lifecycle management(recharge/deduct/consume/expiry),account expiry management,UUID support
--Casbin Permission Engine--
/var/www/ai-platform/backend/src/services/casbin/
CasbinService.js[SAC9RL]: F:Casbin permission engine service | R:casbin,dbConnection,logger | A:Internal service | S:RBAC permission management singleton,custom MySQL adapter+deny policy table separation,checkPermission check deny first then allow,role inheritance+permission query,policy hot reload
CasbinAuthAdapter.js[SAC9RL]: F:Casbin permission adapter | R:CasbinService,GlobalAuthorizationService,logger,config | A:Internal service | S:Casbin parallel adapter with original system,grayscale switch ENABLE_CASBIN/USE_CASBIN_RESULT,permission check comparison logs,deny policy handling
CasbinSyncService.js[SAC8RTM]: F:Casbin data sync service | R:dbConnection,CasbinService,logger | A:Internal service | S:Sync from teaching_global_authorizations to Casbin,group/tag/user 3-level permission mapping,allow/deny policy batch import,incremental/full sync
--Casbin Config--
/var/www/ai-platform/backend/src/config/casbin/
teaching_model.conf[SC5CR]: F:Casbin teaching system permission model config | R:CasbinService,GlobalAuthorizationService | A:None | S:RBAC with domains model multi-level inheritance,g user->tag->group and g2 lesson->module dual inheritance,for teaching system 3-level permission view_lesson/view_plan/edit
--Permission Middleware--
/var/www/ai-platform/backend/src/middleware/permissions/
superAdminMiddleware.js[MAC9RS]: F:Super admin permission middleware | R:ResponseHelper,logger | A:Middleware | S:5 permission checkers requireSuperAdmin/canManageCredits/canManageSystem/canManageAIModels/canManageGroups,role strict check super_admin,403 forbidden response
groupAdminMiddleware.js[MAC8RS]: F:Group admin permission middleware | R:User,ResponseHelper,logger | A:Middleware | S:5 permission checkers,canManageUser same group verify,canCreateUser force role=user+group_id,restrictFieldsForGroupAdmin filter 7 restricted fields
index.js[MAC5S]: F:Permission middleware unified export | R:groupAdminMiddleware,superAdminMiddleware | A:Middleware | S:Export group admin and super admin permission middleware,unified entry
--Frontend Pages--
/var/www/ai-platform/frontend/src/pages/auth/
Login.jsx[FA9AL]: F:Login page | R:authStore,apiClient,LanguageSwitch | A:/auth/login,/auth/login-by-code,/auth/login-by-email-password | S:3 login modes(password/code/email-password-code),iOS style design,email code 60s countdown,enterprise application entry,mobile adaptation
/var/www/ai-platform/frontend/src/pages/profile/
Profile.jsx[FA8M]: F:Profile page | R:authStore,i18n,antd | A:Via authStore | S:3 Tabs(basic info/credits history/permissions list),change password removed original password verify,credits stats 3 indicators,role Tag color mapping
--Frontend State Management--
/var/www/ai-platform/frontend/src/stores/
authStore.js[FA9ACRM]: F:Auth state management | R:tokenRefreshService,systemConfigStore,apiClient | A:/auth/login,/auth/refresh,/auth/me,/auth/register | S:4 login methods,dual Token mechanism,parseExpiresIn parse,persist persistence,login clear chatStore,site config sync

Module 3: Chat System
--Backend Routes--
/var/www/ai-platform/backend/src/routes/
chat.js[RTC9M]: F:Chat route definitions | R:ChatControllerRefactored,authMiddleware,uploadMiddleware | A:/chat/models,/chat/conversations,/chat/messages | S:17 endpoints,5 rate limits(conversation 15/upload 30/credits 60/draft 120/message 30 per min),file upload middleware
--Backend Controllers--
/var/www/ai-platform/backend/src/controllers/
ChatControllerRefactored.js[CTC9APTL]: F:Chat controller core | R:ConversationService,MessageService,StreamMessageService,NonStreamMessageService,Conversation,Message,File,User,AIModel,CacheService | A:All chat route endpoints | S:21 methods,stream/non-stream dual mode,credits pre-deduction,draft management,message cache,file upload,0 credits free model support,message pair delete
--Backend Services--
/var/www/ai-platform/backend/src/services/chat/
ConversationService.js[STC8RS]: F:Conversation business logic | R:Conversation,SystemPrompt,ModuleCombination,AIModel,CacheService | A:None | S:Conversation create/update validation,permission check(model/prompt/combination),parameter normalize context_length 0-1000,temperature 0-1
MessageService.js[STC9PAM]: F:Message business logic core | R:Message,File,SystemPrompt,ModuleCombination,AIService,AIStreamService,CacheService,StatsService | A:None | S:Message validation(content/credits/Token),file processing(image/PDF file field),AI context build(system prompt+module combination+history),stats update,credits refund
StreamMessageService.js[STC8AS]: F:Stream message service | R:Message,File,AIStreamService,MessageService | A:None | S:SSE stream send,placeholder create status=streaming,completion handler callback,failure credits refund,image generation support
NonStreamMessageService.js[STC8S]: F:Non-stream message service v1.1 fix image display | R:Message,File,AIService,MessageService | A:None | S:Normal message send,AI call,stats update,response data assemble file info,v1.1 fix MySQL JSON field auto parse causing image data processing failure+parseGeneratedImages smart parse
/var/www/ai-platform/backend/src/services/
aiService.js[SAC9EPTL]: F:Non-stream AI call core | R:AIModel,ImageGenerationService,axios | A:None | S:Azure config parse api_key 3-segment,OpenRouter PDF format file field+plugins,image generation OpenRouter/Gemini,multi provider adaptation,120s timeout
aiStreamService.js[SAC9AETL]: F:Stream AI call core v2.0 error handling enhanced | R:AIModel,axios | A:None | S:SSE strict spec event+data format,X-Accel-Buffering prevent Nginx buffering,OpenRouter PDF plugin,Azure stream independent implementation,v2.0 added safeStringify handle circular reference+parseAPIError convert API error to Chinese prompt+empty content send error event
streamRecoveryService.js[STC8AS]: F:Stream response recovery service | R:logger | A:Internal service | S:Stream session memory management Map,checkpoint mechanism save every 10,5min timeout auto cleanup,disconnect recovery content+checkpoints,singleton
--Data Models--
/var/www/ai-platform/backend/src/models/
Conversation.js[DTC9M]: F:Conversation data model v1.1 smart app support | R:SystemConfig,Message | A:None | S:Support context_length(0-1000)/temperature(0-1)/priority(0-10),system prompt ID/module combination ID/smart_app_id,cleared_at filter cleared time,sort by priority+time,v1.1 added smart_app_id field link to smart app
Message.js[DTC9TM]: F:Message data model | R:Conversation,File,dbConnection | A:None | S:sequence_number auto increment,4 status pending/streaming/completed/failed,stream message recovery mechanism,deleteMessagePair transaction delete+sequence renumber,generated_images JSON field
File.js[DFC7M]: F:File info management | R:config,dbConnection | A:None | S:Smart URL generation support Docker/PM2 paths,8 prefix auto cleanup,protocol auto select http/https,file_path->stored_name mapping
--Frontend Pages--
/var/www/ai-platform/frontend/src/pages/chat/
Chat.jsx[FT9AL]: F:Chat main interface | R:chatStore,authStore,MessageList,ChatInputArea,ConversationSidebar | A:/chat/* | S:PC/mobile dual layout,improved scroll logic prevent conflict,userScrolled state control,stream output 500ms interval scroll,mobile 3 views,image/document upload,export chat txt,clear conversation,delete message pair,pin conversation,v1.1 fix edit non-current conversation config override bug
--Frontend Components--
/var/www/ai-platform/frontend/src/components/chat/
MessageList.jsx[FT8M]: F:Message list component | R:MessageContent,ReactMarkdown,apiClient | A:None | S:MessageItem+EmptyMessages separation,React.memo optimize render,system announcement display,user avatar first letter,AI lightning icon SVG,typing status,stream message mark
/var/www/ai-platform/frontend/src/components/chat/new/
ChatHeader.jsx[FT7S]: F:Chat header component simplified | R:Button,Typography,Space,MenuOutlined,SettingOutlined,i18n | A:None | S:Display conversation title and model name Tag,menu button toggle sidebar,settings button open settings,left-right split layout
ChatInputArea.jsx[FT8M]: F:Chat input area component mobile optimized | R:ModelSelector,Upload,Tooltip,TextArea,forwardRef,i18n | A:None | S:Support image and document upload dual mode,mobile optimized 16px font prevent iOS zoom,forwardRef expose focus/blur methods,uploaded file preview,ModelSelector integrated,send/stop button toggle
ConversationSidebar.jsx[FT8M]: F:Conversation sidebar component iOS style optimized | R:Button,Empty,Spin,Tag,Typography,i18n | A:None | S:Collapse/expand function,pin icon PushpinFilled,message count,last message time format,new conversation button,iOS style card design
ModelSelector.jsx[FT7M]: F:Model selector component mobile show full alias | R:Popover,Button,List,Typography,ThunderboltOutlined,CheckOutlined | A:None | S:Popover popup select,display model name+credits+image support,click outside close,responsive placement mobile top/PC topLeft
EmptyConversation.jsx[FT5S]: F:Empty conversation state component show system announcement | R:apiClient,ReactMarkdown,Empty,Card,Spin,i18n | A:/admin/announcement | S:Display system announcement Markdown render,empty state Empty component,start new conversation button
--Frontend State Management--
/var/www/ai-platform/frontend/src/stores/
chatStore.js[FT9APL]: F:Chat state management v2.0 error display enhanced | R:apiClient,message | A:/chat/conversations,/chat/messages,/chat/models,/knowledge/combinations | S:State separation conversations independent currentConversation,stream/non-stream dual mode,500 conversations limit+1000 messages limit,30s dynamic timeout,v2.0 fix onError callback retain user message+AI message position show error message

Module 4: Credits Management System
--Backend Routes--
/var/www/ai-platform/backend/src/routes/
admin.js[RC8RM]: F:Admin route aggregation | R:13 sub-routes,various Controllers,permission middleware,rateLimitService | A:/api/admin/* | S:Dynamic layered rate limit read/write,14 sub-routes mounted,cache management+rate limit config+email+SSO+announcement+custom homepage
--Backend Controllers--
/var/www/ai-platform/backend/src/controllers/admin/
UserCreditsController.js[CR7PTS]: F:User credits management controller | R:CreditsService,User,ResponseHelper | A:GET/POST /admin/users/:id/credits/* | S:Credits info query,quota setting,recharge/deduct,expiry set/extend,credits history paginated query
--Backend Services--
/var/www/ai-platform/backend/src/services/admin/
CreditsService.js[SAC7C]: F:Credits management service | R:User,dbConnection | A:None | S:Set/recharge/deduct/consume 4 operations,expiry set/extend,credits history query,batch recharge transaction,credits stats report,support 0 credits free model

Module 5: Knowledge Module System - Magic Cube
--Backend Routes--
/var/www/ai-platform/backend/src/routes/
knowledgeRoutes.js[RK7S]: F:Knowledge module routes | R:KnowledgeModuleController,ModuleCombinationController,authMiddleware | A:/knowledge/modules,/knowledge/combinations | S:Module/combination CRUD endpoints,category/tag query,authenticate auth
--Data Models--
/var/www/ai-platform/backend/src/models/
KnowledgeModule.js[DKC9RPTL]: F:Knowledge module management | R:User,UserGroup,dbConnection,tokenCalculator | A:None | S:3 scopes personal/team/system,group_ids JSON array MEMBER OF query,tag permission knowledge_module_tag_permissions table,content_visible content visibility,token auto calculate
ModuleCombination.js[DKC9RPM]: F:Module combination management | R:KnowledgeModule,tokenCalculator | A:None | S:Per-module permission verify,findByIdForExecution execution use no hide content,getCombinedContent blackbox mode invisible content still effective,super admin privilege
SystemPrompt.js[DKC7RM]: F:System prompt management | R:User,UserGroup,system_settings | A:None | S:content lazy load not in list return,group permission assign system_prompt_groups table,feature switch system_prompts_enabled
--Frontend Pages--
/var/www/ai-platform/frontend/src/pages/knowledge/
KnowledgeBase.jsx[FK8L]: F:Magic Cube knowledge module assembly page | R:useKnowledgeStore,useAuthStore,dnd-kit,i18n | A:None | S:5 slot drag assembly,module plaza+combination list,token calculate 100K limit,3 scope modules personal/team/system,permission control,module activation switch,iOS style design
--Frontend State Management--
/var/www/ai-platform/frontend/src/stores/
knowledgeStore.js[FK7M]: F:Knowledge module state | R:apiClient | A:/knowledge/modules,/knowledge/combinations | S:Knowledge module CRUD,module combination CRUD,copy combination,category management,include_inactive parameter
--Backend Controllers--
/var/www/ai-platform/backend/src/controllers/
KnowledgeModuleController.js[CK7RM]: F:Knowledge module controller | R:KnowledgeModule,ResponseHelper,logger,dbConnection | A:/knowledge/modules,/knowledge/modules/:id,/knowledge/categories,/knowledge/group-tags | S:7 methods,3 scope filter,permission verify super admin create global+all group users create team,tag permission handling
ModuleCombinationController.js[CK7RS]: F:Module combination controller | R:ModuleCombination,ResponseHelper,logger | A:/knowledge/combinations,/knowledge/combinations/:id,/knowledge/combinations/:id/copy,/knowledge/combinations/:id/content | S:7 methods,permission verify only operate own combinations,copy function

Module 6: AI Model Management
--Backend Controllers--
/var/www/ai-platform/backend/src/controllers/admin/
AIModelController.js[CC7RCEM]: F:AI model management controller | R:AIModel,CacheService,ResponseHelper,logger | A:/admin/models | S:CRUD+test connection+group management,super admin see all group admin hide sensitive info,new default assign all active groups,document_upload_enabled support
--Data Models--
/var/www/ai-platform/backend/src/models/
AIModel.js[DCC9RETL]: F:AI model config management v1.1 fix sensitive field retain | R:UserGroup,dbConnection,axios | A:None | S:Azure config parse api_key 3-segment,group assign+user restrict dual layer permission,credits_per_chat support 0 value free model,stream/image/document 3 switches,v1.1 fix update method api_key/api_endpoint empty retain original value

Module 7: Image Generation System
--Backend Routes--
/var/www/ai-platform/backend/src/routes/
image.js[RI8S]: F:Image generation route definitions | R:ImageController,ImageAdminController,authenticate,multer | A:/image/models,/image/generate,/image/upload-reference,/image/midjourney/*,/image/history,/image/gallery | S:multer memory storage 10MB image upload limit 6 MIME types,user side 12 endpoints+admin side 5 endpoints,Midjourney dedicated routes,Webhook no auth
--Backend Controllers--
/var/www/ai-platform/backend/src/controllers/
imageController.js[CI8PEL]: F:Image generation controller | R:ImageService,MidjourneyService,ImageModel,ImageGeneration,ossService | A:/image/models,/image/generate,/image/upload-reference,/image/midjourney/*,/image/history,/image/gallery | S:User+admin dual controller,batch generate 1-4 images,Midjourney U/V/Reroll operations,img2img reference upload OSS,favorite/public toggle
--Backend Services--
/var/www/ai-platform/backend/src/services/
imageService.js[SI9PETL]: F:Image generation service integration v2.0 Wanxiang API support | R:ImageModel,ImageGeneration,User,ossService,sharp | A:Internal service | S:Batch generate 1-4 concurrent Promise.allSettled,Seedream series auto detect,Volcano/Midjourney/Wanxiang 3 providers,img2img image parameter,user directory isolation,credits deduct by actual success count,sharp thumbnail 400x400,v2.0 added isWanxiangModel Wanxiang model detect+buildWanxiangRequest request build stream:true+enable_interleave+callWanxiangAPI SSE stream call X-DashScope-SSE header+collectedImages collect all data block image URLs+convertSizeForWanxiang size convert x->*
imageGenerationService.js[SI9EM]: F:Image generation service | R:ossService,dbConnection,logger | A:Internal service | S:OpenRouter+Gemini dual format parse,Base64 to Buffer save,user isolated directory,OSS/local auto switch,message ID trace user,image generation model detect
midjourneyService.js[SI8PEAL]: F:Midjourney image generation service | R:ImageModel,ImageGeneration,User,ossService,axios | A:Midjourney API | S:Imagine text2img/img2img+Action operations U/V/Reroll,base image base64Array support,2s poll 5min timeout,status mapping mapTaskStatus,Webhook callback handling
midjourneyProxyService.js[SI7PEPL]: F:Midjourney proxy service sync API | R:ImageModel,ImageGeneration,User,axios,logger | A:goapi.gptnb.ai | S:Sync return Midjourney image no polling,4 image grid grid_layout,credits deduct by actual success count,5min timeout
--Data Models--
/var/www/ai-platform/backend/src/models/
ImageModel.js[DI7CEM]: F:Image model config management | R:dbConnection,crypto | A:None | S:AES-256-CBC encrypt API key,has_api_key identifier,sizes_supported JSON parse,price_per_image type convert,support 4 providers(volcano/midjourney/dashscope/aliyun)
ImageGeneration.js[DI7M]: F:Image generation record model | R:dbConnection,logger | A:None | S:Midjourney fields support task_id/buttons/grid_layout,user history paginated,favorite/public toggle,public gallery,user stats
--Frontend Pages--
/var/www/ai-platform/frontend/src/pages/image/
ImageGeneration.jsx[FI7S]: F:Image generation page export | R:./index | A:None | S:Export refactored image generation page index
--Frontend Components--
/var/www/ai-platform/frontend/src/components/admin/settings/
ImageModelSettings.jsx[FI7CEM]: F:Image model management settings component v1.1 Wanxiang support | R:adminStore,Form,Input,Select,InputNumber | A:/admin/image-models | S:Image model CRUD form,v1.1 added PROVIDER_CONFIG config object volcano/midjourney/dashscope/aliyun,provider select auto fill default endpoint and size format,Wanxiang config hint model ID recommend wan2.6-image+size format width*height,provider dropdown icon color differentiate
--Frontend State Management--
/var/www/ai-platform/frontend/src/stores/
imageStore.js[FI8AL]: F:Image generation state management | R:api,message | A:/image/generate,/image/midjourney/* | S:Midjourney async poll 2s interval/5min timeout,processingTasks state prevent duplicate,base64Array support,batch generate,favorite/public toggle

Module 8: Video Generation
--Backend Routes--
/var/www/ai-platform/backend/src/routes/
video.js[RV7S]: F:Video generation route definitions | R:VideoController,VideoAdminController,authenticate,uploadMiddleware,ossService | A:/video/models,/video/generate,/video/upload-frame,/video/task/:id,/video/history,/video/gallery | S:First frame upload uploadImage middleware+OSS save video-frames directory,user side 9 endpoints+admin side 5 endpoints
--Backend Controllers--
/var/www/ai-platform/backend/src/controllers/
videoController.js[CV7PEAL]: F:Video generation controller user+admin | R:VideoService,VideoModel,VideoGeneration,klingVideoService,sora2VideoService | A:/video/models,/video/generate,/video/task/:id,/video/history,/video/gallery | S:Dual controller structure,3 providers support volcano/kling/sora2,poll task status completion callback,favorite/public/batch delete,credits deduct 402 error code
--Backend Services--
/var/www/ai-platform/backend/src/services/
videoService.js[SV9EPTL]: F:Video generation service integration | R:VideoModel,VideoGeneration,User,ossService,klingVideoService,sora2VideoService | A:Internal service | S:3 providers unified interface Volcano/Kling/Sora2,credits deduct+poll status,Volcano textContent command line args,Kling Image2Video/Text2Video branches,video download save OSS,10s poll 10min timeout
klingVideoService.js[SV7PEM]: F:Kling video generation service | R:ossService,jwt,redis,axios | A:https://api-beijing.klingai.com | S:JWT signature auth HS256 algorithm,25min Token memory cache,Text2Video/Image2Video dual mode,camera control buildCameraControl,aspect ratio convert
sora2VideoService.js[SV7EL]: F:Sora2 video generation service | R:ossService,axios | A:https://goapi.gptnb.ai | S:GoAPI Provider,sora-2 basic/sora-2-pro professional dual model support,orientation convert,OpenAI error translate Chinese,progress percentage progress_pct
--Data Models--
/var/www/ai-platform/backend/src/models/
VideoModel.js[DV7CEM]: F:Video model config management | R:dbConnection,crypto | A:None | S:3 providers support volcano/kling/sora2,AES-256-CBC encrypt Volcano only,Kling access_key+secret_key in api_config,resolution/duration/fps/ratio config
VideoGeneration.js[DV7M]: F:Video generation record model | R:dbConnection | A:None | S:3 providers support provider/orientation/generation_id/reference_images,user history paginated,public gallery,favorite/public toggle,batch delete
--Frontend Pages--
/var/www/ai-platform/frontend/src/pages/video/
VideoGeneration.jsx[FV8PEL]: F:Video generation full page | R:videoStore,authStore,apiClient,i18n | A:/video/upload-frame | S:4 modes text/first frame/last frame/dual frame+multi resolution duration ratio,first/last frame Upload image upload 10MB,credits pricing calculatePrice display,vertical video isVerticalVideo adapt contain,fullscreen preview Modal
--Frontend State Management--
/var/www/ai-platform/frontend/src/stores/
videoStore.js[FV8AL]: F:Video generation state management | R:apiClient,message | A:/video/models,/video/generate,/video/task/:id,/video/history | S:5s poll 10min timeout,processingTasks+completedTasks prevent status rollback,smart merge data completed tasks no override,resume incomplete task poll

Module 9: Agent Workflow
--Backend Routes--
/var/www/ai-platform/backend/src/routes/
agent.js[RG7S]: F:Agent workflow route definitions | R:AgentController,authenticate | A:/agent/workflows,/agent/node-types,/agent/executions,/agent/test/*,/agent/wiki-items | S:Node types 1 endpoint+workflow CRUD 6 endpoints+execution 1 endpoint+test conversation 4 endpoints+execution history 3 endpoints+stats 1 endpoint+wiki items 1 endpoint
--Backend Controllers--
/var/www/ai-platform/backend/src/controllers/
AgentController.js[CG8PRM]: F:Agent workflow controller | R:AgentWorkflow,AgentNodeType,AgentExecution,ExecutorService,TestSessionService | A:/agent/workflows,/agent/execute/:id,/agent/test/:id/session | S:Workflow CRUD,one-time execution+test conversation dual mode,test session management,node type list,execution history paginated,permission verify,insufficient credits 402,extractTextFromOutput smart extract AI reply text support result/content/output/text multi-field recursive extract
--Backend Services--
/var/www/ai-platform/backend/src/services/agent/
ExecutorService.js[SG9PTL]: F:Agent workflow execution engine | R:NodeRegistry,AgentWorkflow,AgentExecution,AgentNodeExecution,AgentNodeType,User | A:Internal service | S:Workflow orchestration+topological sort Kahn algorithm detect circular dependency,credits pre-deduct+actual consumption refund mechanism,10min timeout,upstream node output pass upstreamOutput,validateWorkflowConnections verify LLM node must have upstream connection,formatFinalOutput ensure return object format,shouldSkipNode conditional branch judgment+branchDecisions branch decision record+skippedNodes skip node set support classifier node multi-output conditional execution
TestSessionService.js[SG5S]: F:Agent test session management service | R:logger | A:Internal service | S:Memory storage Map manage session+message history,30min timeout+every 10min auto cleanup expired sessions,singleton
NodeRegistry.js[SG9S]: F:Node registry factory pattern | R:StartNode,LLMNode,EndNode,KnowledgeNode,ClassifierNode,logger | A:Internal service | S:Node type register+get+createInstance,built-in 5 node types start/llm/end/knowledge/classifier,singleton,createInstance compatible with two call methods
--Node Implementations--
/var/www/ai-platform/backend/src/services/agent/nodes/
BaseNode.js[SG9S]: F:Node abstract base class | R:logger | A:Base class | S:execute abstract method subclass must implement,validate verify node config,replaceVariables variable replace support nested paths
StartNode.js[SG5S]: F:Start node | R:BaseNode | A:Node implementation | S:Workflow entry receive user input parameters,no credits consumption,directly return input data
LLMNode.js[SG8EL]: F:AI conversation node | R:BaseNode,AIModel,axios | A:Node implementation | S:Call LLM for conversation inference,history turns control historyTurns default 10,upstream output pass extractUpstreamContent,Azure+standard API dual support,120s timeout,isKnowledgeOutput detect knowledge output+buildKnowledgePrompt build knowledge prompt+extractUpstreamContent support knowledge_context field
EndNode.js[SG5S]: F:End node | R:BaseNode | A:Node implementation | S:Workflow exit output final result,support 3 formats text/json/markdown,auto get upstream node output
KnowledgeNode.js[SG7M]: F:Knowledge node | R:BaseNode,WikiItem,tokenCalculator | A:Node implementation | S:Load content from knowledge base as context pass to downstream nodes,direct load mode executeDirectLoad,support multi knowledge merge,Token calculate,formatContentBlock format content block,getConfig method fix config read path this.data.config
ClassifierNode.js[SG8EPM]: F:Question classifier node | R:BaseNode,AIModel,axios,logger | A:Node implementation | S:Use AI to intelligently classify user questions,support up to 100 classification categories,background knowledge background_knowledge provide classification context,history turns history_turns reference conversation history,buildSystemPrompt build classification prompt,buildClassificationPrompt build user prompt,parseClassificationResult parse classification result return category_id/category_name/category_index/confidence,Azure+standard API dual support,low temperature 0.1 ensure classification stability,60s timeout
--Data Models--
/var/www/ai-platform/backend/src/models/
AgentWorkflow.js[DG7M]: F:Agent workflow model | R:dbConnection,logger | A:None | S:Workflow CRUD+publish toggle+stats,flow_data JSON field auto parse,update fix filter undefined values,paginated query support is_published filter
AgentExecution.js[DG7M]: F:Agent execution record model | R:dbConnection,logger | A:None | S:Execution record CRUD+stats+cancel,input_data/output_data/execution_log 3 JSON fields,status state management,total_credits_used credits record,duration_ms execution time
AgentNodeExecution.js[DG7S]: F:Agent node execution log model | R:dbConnection,logger | A:None | S:Node execution tracking CRUD,JSON field parse,findByExecutionAndNode main method,batch create batchCreate transaction support
AgentNodeType.js[DG7CM]: F:Agent node type model | R:dbConnection,logger | A:None | S:Node type config management CRUD,findByTypeKey query,config_schema JSON config,credits_per_execution credits consumption,max_inputs/max_outputs input output limits,toggle active status toggleActive
APIService.js[DC7PM]: F:API service model | R:dbConnection,crypto,errors | A:None | S:API service management+key generate MD5,validateApiKey verify+reset key,request dedup checkDuplicateRequest 24 hours
--Frontend Pages--
/var/www/ai-platform/frontend/src/pages/agent/
AgentWorkspace.jsx[FG7S]: F:Agent workspace simplified | R:WorkflowList | A:None | S:Remove Tab labels,directly render WorkflowList component,gradient background
WorkflowList.jsx[FG8M]: F:Workflow list card layout v2.2 rename function | R:agentStore,dayjs,Dropdown | A:/agent/workflows | S:FastGPT style card grid,search+Segmented filter(all/published/unpublished),responsive 4/3/2/1 columns,Dropdown menu event bubbling fix,relative time display,create/delete Modal,v2.2 added rename menu item+rename modal modify workflow name and description
WorkflowList.less[FG5M]: F:Workflow list styles | R:WorkflowList.jsx | A:None | S:iOS/FastGPT style card,gradient background,hover float animation,responsive layout,Segmented filter styles
AgentWorkspace.less[FG3S]: F:Agent workspace styles | R:AgentWorkspace.jsx | A:None | S:Simplified gradient background styles
--Workflow Editor--
/var/www/ai-platform/frontend/src/pages/agent/editor/
WorkflowEditor.jsx[FG8L]: F:Workflow editor | R:agentStore,ReactFlow,ReactFlowProvider,useReactFlow,Toolbar,NodePanel,ConfigPanel,TestDrawer | A:None | S:ReactFlow canvas drag orchestration,config panel Drawer drawer form,canvas initial zoom 0.6+fitView maxZoom 0.8,onUpdateNodeConfig simultaneously update node.data.label and selectedNode,ClassifierNode classifier node register,edge sourceHandle/targetHandle save and load support conditional branch connection persistence,drag drop support ReactFlowProvider wrap+useReactFlow get instance+onDragOver/onDrop handle+screenToFlowPosition coordinate convert
/var/www/ai-platform/frontend/src/pages/agent/editor/components/
NodePanel.jsx[FG7M]: F:Node panel drag add | R:Card,Space,Divider,Tooltip,message,DragOutlined | A:None | S:Basic nodes start/LLM/knowledge retrieval/question classifier,11 extension nodes placeholder MCP/A2A/text2img/MySQL/HTTP/code/loop/timer/email/document/vector,extension nodes color display+click prompt apply for module permission,question classifier node orange theme BranchesOutlined icon,drag add node draggable+onDragStart+dataTransfer pass node type
ConfigPanel.jsx[FG7M]: F:Config panel | R:Form,Input,Select,InputNumber,Slider,agentStore | A:None | S:Node config form LLM/start/end/knowledge/classifier,adapt Drawer drawer mode inDrawer parameter,top save button+status prompt saved/unsaved changes+loading state,renderClassifierConfig classifier node config panel AI model select+background knowledge textarea+chat history turns+dynamic category list categories array add/remove/edit max 100
Toolbar.jsx[FG5S]: F:Toolbar component | R:Button,Space | A:None | S:Back/save/delete/test buttons,unsaved prompt
TestDrawer.jsx[FG7M]: F:Test drawer component v1.1 optimized | R:Drawer,Input,Button,agentStore | A:None | S:Conversation test interface,message list,input send,clear conversation,loading state,v1.1 remove top useless Alert description text+zIndex=1100 avoid being covered+width adjusted to 480px
TestDrawer.less[FG5S]: F:Test drawer styles v1.1 | R:TestDrawer.jsx | A:None | S:Conversation bubble styles user blue gradient/AI green gradient,message list scroll,input area fixed bottom,v1.1 adjust z-index ensure not covered
/var/www/ai-platform/frontend/src/pages/agent/editor/nodes/
StartNode.jsx[FG5S]: F:Start node component | R:reactflow,Handle | A:None | S:Green theme,input parameters display,workflow entry
LLMNode.jsx[FG5S]: F:LLM node component | R:reactflow,Handle | A:None | S:Blue theme,model name display,parameter preview
EndNode.jsx[FG5S]: F:End node component | R:reactflow,Handle | A:None | S:Red theme,output mapping display,workflow exit
KnowledgeNode.jsx[FG5S]: F:Knowledge node component | R:reactflow,Handle | A:None | S:Purple theme,knowledge name and retrieval config display
ClassifierNode.jsx[FG7M]: F:Question classifier node component | R:reactflow,Handle,Tag,Tooltip | A:None | S:Orange theme gradient background,multi-output port support each category corresponds to one color Handle,getHandleTopPosition calculate output Handle vertical position evenly distributed 25%-75%,getCategoryColor generate 10 category colors cycle,dynamic node height minHeight adjust based on category count,display AI model+category list+background knowledge hint
/var/www/ai-platform/frontend/src/pages/agent/editor/styles/
editor.css[FG3S]: F:Editor styles | R:WorkflowEditor | A:None | S:Three-column layout styles,node panel/canvas/config panel
--Frontend i18n--
/var/www/ai-platform/frontend/src/locales/zh-CN/
agent.json[FG5C]: F:Agent i18n | R:i18n | A:None | S:Workflow/execution/node Chinese text,search/filter/empty state text,12 extension node text extensionNodes object MCP/A2A/text2img etc+editor related text editor object
--Frontend State Management--
/var/www/ai-platform/frontend/src/stores/
agentStore.js[FG7AL]: F:Agent workflow state management | R:apiClient,message | A:/agent/workflows,/agent/node-types,/agent/executions,/agent/test/* | S:Zustand manage workflow CRUD+node types+model list+execution history+test session,test conversation 6 methods,120s timeout,402 insufficient credits handling

Module 10: Smart Teaching
--Backend Routes--
/var/www/ai-platform/backend/src/routes/
teachingRoutes.js[RE9RL]: F:Teaching system route definitions v1.5.0 Phase3 route hardening | R:TeachingController,authenticate,requireAdmin,requireSuperAdmin,7 permission middleware | A:/teaching/modules,/teaching/lessons,/teaching/permissions,/teaching/groups,/teaching/authorization,/teaching/teaching-plan | S:30+ route endpoints,3-level permission system view_lesson/view_plan/edit,7 permission middleware fine-grained control,Phase3 added requireAdmin and requireSuperAdmin middleware implement authorization route dual protection
--Backend Controllers--
/var/www/ai-platform/backend/src/controllers/
TeachingController.js[CE9TRL]: F:Teaching system controller v2.3.0 Phase1-4 complete fix | R:TeachingModule,TeachingLesson,TeachingPermission,TeachingModuleGroup,GlobalAuthorizationService | A:/teaching/modules,/teaching/lessons,/teaching/permissions,/teaching/groups,/teaching/authorization,/teaching/teaching-plan | S:3-level permission system view_lesson student/view_plan teacher/edit editor,module+lesson+group+teaching plan management,Phase4 permission boundary validation validatePermissionBoundary recursive check tag user prevent group admin exceed,Phase1 transaction rollback+row lock concurrency control
--Backend Services--
/var/www/ai-platform/backend/src/services/
GlobalAuthorizationService.js[SE9RL]: F:Global authorization service 3-level permission v4.2.0 multi-tag merge+permission boundary validation | R:dbConnection,logger | A:Internal service | S:3-level permission complete return hasViewLesson/hasViewPlan/hasEdit,group->tag->user 3-level permission inheritance,getUserModulePermission+getUserLessonPermission,v4.2.0 fix multi-tag permission merge bug take max permission iterate all tags no break,validatePermissionBoundary recursive permission boundary check
--Permission Middleware--
/var/www/ai-platform/backend/src/middleware/
teachingPermissions.js[ME9RM]: F:Teaching system permission middleware v2.0 request-level cache optimization | R:TeachingModule,TeachingLesson,ResponseHelper,logger | A:Middleware | S:7 permission middleware create/edit/view/delete module+view/edit lesson+manage permissions,getUserTags get user tags+v2.0 request-level cache optimization store in req._userTagsCache,teacher-only content check
--Data Models--
/var/www/ai-platform/backend/src/models/
TeachingModule.js[DE7RM]: F:Teaching module model | R:dbConnection,GlobalAuthorizationService | A:None | S:3-level permission return version checkUserPermission return string edit/view_plan/view_lesson/null,match GlobalAuthorizationService 3-level permission,creator_id auto edit permission
TeachingLesson.js[DE7M]: F:Teaching lesson model | R:dbConnection | A:None | S:Lesson CRUD+content type permission,materials lesson materials support max 5 limit,TEACHER_ONLY_TYPES teacher-only content teaching_plan/answer/guide/assessment
TeachingPermission.js[DE5M]: F:Teaching permission model | R:dbConnection | A:None | S:Module/lesson permission grant revoke,user/group/tag 3-level authorization,expires_at expiry time,revoke/revokeMultiple batch revoke
TeachingModuleGroup.js[DE5M]: F:Teaching group model | R:dbConnection | A:None | S:Module group management CRUD,sort_order sorting,setModuleGroups batch associate,getGroupModules query group modules
--Frontend Pages--
/var/www/ai-platform/frontend/src/pages/teaching/
Teaching.jsx[FE7S]: F:Teaching system main page | R:ModuleList | A:None | S:Simplified directly render ModuleList component no Tab labels
ModuleDetail.jsx[FE8L]: F:Module detail page | R:teachingStore,authStore,LessonList | A:/teaching/modules/:id,/teaching/modules/:id/lessons | S:Module info display+lesson list,permission control view_lesson/view_plan/edit,create/edit/delete lesson,iOS style
LessonDetail.jsx[FE8L]: F:Lesson detail page | R:teachingStore,authStore,LessonViewer,LessonEditor | A:/teaching/lessons/:id | S:Switch viewer/editor based on permission,3-level permission judgment view_lesson readonly/view_plan include teaching plan/edit full edit,breadcrumb navigation
LessonEditor.jsx[FE8L]: F:Lesson editor | R:teachingStore,Monaco,ReactQuill,MaterialsManager | A:/teaching/lessons,/teaching/lessons/:id | S:Rich text edit+code edit toggle,teaching plan edit paginated teacher_plan/answer/guide/assessment,lesson materials management,draft auto save
LessonViewer.jsx[FE7M]: F:Lesson viewer | R:teachingStore,ReactMarkdown,Prism | A:/teaching/lessons/:id,/teaching/lessons/:id/teaching-plan/:page | S:Readonly display lesson content,teaching plan paginated view view_plan permission,code highlight,Markdown render,browse history
--Frontend Components--
/var/www/ai-platform/frontend/src/components/teaching/
ModuleList.jsx[FE8L]: F:Module list core component | R:teachingStore,authStore | A:None | S:Group display+search filter+permission control,creator/super admin/group admin edit permission,mobile adaptation,module card+favorite+pin,iOS style design
MaterialsManager.jsx[FE5M]: F:Lesson materials management component | R:Upload,message | A:None | S:Max 5 materials limit,file upload/delete/sort,support document/image/video,materials array JSON format
MaterialsDisplay.jsx[FE5S]: F:Lesson materials display component | R:Card,Tag | A:None | S:Readonly display lesson materials list,file type icon mapping,download link generate,file size format
IOSLayout.jsx[FE7M]: F:iOS style layout container | R:Layout | A:None | S:iOS design style unified layout,frosted glass effect,rounded card,gradient background,responsive adaptation
/var/www/ai-platform/frontend/src/components/teaching/selectors/
GroupSelector.jsx[FE5S]: F:User group selector | R:adminStore,Select | A:/admin/user-groups | S:Dropdown select organization,support search,permission filter,multi-select mode
TagSelector.jsx[FE5S]: F:User tag selector | R:adminStore,Select | A:/admin/user-tags | S:Dropdown select tag,group tag filter,support search,multi-select mode
UserSelector.jsx[FE5S]: F:User selector | R:adminStore,Select | A:/admin/users | S:Dropdown select user,support search,display username+remark,permission filter
--Authorization Management Components--
/var/www/ai-platform/frontend/src/components/admin/settings/ModuleAuthorizationManagement/
index.jsx[FE9RL]: F:Module authorization management main component v2.0 dual layer architecture | R:useAuthorizationData,useAuthorizationState,usePermissionLogic | A:/teaching/authorization,/teaching/modules,/admin/user-groups,/admin/user-tags | S:Super admin group-level authorization+group admin tag user assign,dual layer config architecture superAdminConfig/groupAdminConfig,permission boundary validation frontend pre-check,3-level permission+lesson-level fine-grained control
/var/www/ai-platform/frontend/src/components/admin/settings/ModuleAuthorizationManagement/components/
GroupList.jsx[FE7M]: F:Organization list component | R:Collapse,GroupItem | A:None | S:Expand collapse organization list,selected highlight,unconfigured group prompt,stats info display
GroupItem.jsx[FE7M]: F:Organization item component | R:Card,Tag | A:None | S:Single organization card,module stats/user stats,action buttons view/edit/delete
ModulePermissionSelector.jsx[FE8L]: F:Module permission selector core | R:Tree,Checkbox,Button | A:/teaching/modules/:id/lessons | S:Tree structure module->lesson,3-level permission checkbox,select all/clear/inherit,lazy load lesson list,permission boundary frontend pre-check
TagItem.jsx[FE7M]: F:Tag item component | R:Card,Switch,Badge | A:None | S:Tag permission config card,inherit switch,user list expand,stats info
UserItem.jsx[FE5S]: F:User item component | R:Card,Tag | A:None | S:User permission config card,inherit switch,delete button,permission status display
OperationBar.jsx[FE5S]: F:Operation bar component | R:Space,Button | A:None | S:Save/cancel/reset/preview buttons,status prompt,quick actions
PermissionHelpAlert.jsx[FE3S]: F:Permission help alert component | R:Alert | A:None | S:3-level permission description,operation hints,collapse expand
/var/www/ai-platform/frontend/src/components/admin/settings/ModuleAuthorizationManagement/hooks/
useAuthorizationData.js[FE8M]: F:Authorization data Hook | R:teachingStore,adminStore,authStore | A:Data fetch and management | S:Get module/organization/tag/user list,dual layer config load,permission upper limit query getSuperAdminConfig
useAuthorizationState.js[FE7M]: F:Authorization state Hook | R:useState,useCallback | A:State management | S:currentGroup/selectedModules/tagConfigs/userConfigs state management,state reset/update methods
usePermissionLogic.js[FE8L]: F:Permission logic Hook | R:permissionBoundary,permissionCalculator | A:Business logic | S:Permission calculate/validate/merge,inheritance logic handling,boundary check,conflict detection
/var/www/ai-platform/frontend/src/components/admin/settings/ModuleAuthorizationManagement/utils/
permissionBoundary.js[FE7S]: F:Permission boundary validation utility | R:None | A:Utility function | S:validatePermissionBoundary frontend validation,recursive check tag user,error info collect
permissionCalculator.js[FE5S]: F:Permission calculation utility | R:None | A:Utility function | S:Calculate effective permission,inheritance chain calculate,max permission merge
permissionMigration.js[FE5S]: F:Permission migration utility | R:None | A:Utility function | S:v1->v2 dual layer architecture migration,config format convert,compatibility handling
deepCopy.js[FE3S]: F:Deep copy utility | R:None | A:Utility function | S:Deep clone object,prevent reference pollution
/var/www/ai-platform/frontend/src/components/admin/settings/ModuleAuthorizationManagement/constants/
permissionTypes.js[FE5S]: F:Permission type constants | R:None | A:Constant definitions | S:3-level permission definitions view_lesson/view_plan/edit,permission mapping,default values
uiMessages.js[FE3S]: F:UI message constants | R:None | A:Constant definitions | S:Error prompts/success messages/confirm dialog text
--Frontend State Management--
/var/www/ai-platform/frontend/src/stores/
teachingStore.js[FE7RL]: F:Smart teaching system state management | R:api,message | A:/teaching/modules,/teaching/lessons,/teaching/permissions,/teaching/groups,/teaching/teaching-plan | S:Zustand manage module+lesson+group+permission+teaching plan,403 error friendly handling avoid jump detail page error,teaching plan save+get function,draft auto save+browse history

Module 11: HTML Editor
--Backend Routes--
/var/www/ai-platform/backend/src/routes/
htmlEditor.js[RH5S]: F:HTML editor route definitions | R:HtmlEditorController,authenticate | A:/html-editor/credits-config,/html-editor/projects,/html-editor/pages,/html-editor/templates | S:Credits config query+project CRUD 4 endpoints+page CRUD 6 endpoints+publish toggle+template list
--Backend Controllers--
/var/www/ai-platform/backend/src/controllers/
HtmlEditorController.js[CH7PL]: F:HTML editor controller v1.1 page list limit fix | R:HtmlProject,HtmlPage,User,dbConnection | A:/html-editor/projects,/html-editor/pages,/pages/:userId/:slug | S:Auto create default project,3 credits deduction create 10/update 2/publish 5,title only update no credits,default project prevent delete,permanent link generate,v1.1 getPages default limit from 20 to 500 fix page lost issue
--Data Models--
/var/www/ai-platform/backend/src/models/
HtmlProject.js[DH7M]: F:HTML project/folder model | R:dbConnection | A:None | S:Tree structure recursive query,tag safeJsonParse encoding fix,cascade delete sub-projects,ownership check,default project mark
HtmlPage.js[DH7M]: F:HTML page model | R:dbConnection,crypto | A:None | S:Page CRUD,slug unique generate keep only alphanumeric+6 random,compileContent compile HTML+CSS+JS,publish management is_published/publish_url,version number auto increment
--Frontend Utils--
/var/www/ai-platform/frontend/src/utils/
monacoConfig.js[FUH5CS]: F:Monaco editor config | R:None | A:None | S:Simplified only provide editor options config no loading interference,defaultEditorOptions default config,themes theme config vs-dark/vs-light
--Frontend Pages--
/var/www/ai-platform/frontend/src/pages/htmlEditor/
HtmlEditor.jsx[FH8PL]: F:HTML editor main page v1.5 permanent link optimization | R:htmlEditorStore,authStore,@monaco-editor/react,i18n | A:/html-editor/projects,/html-editor/pages,/html-editor/credits-config | S:iOS style design,Monaco editor integration,project/page management CRUD,3 credits deduction,live preview iframe desktop/tablet/mobile 3 modes,permanent link generate,dark/light theme toggle,v1.1 fix Monaco right-click menu Paste not working+custom clipboard Action,v1.2-v1.4 fix auto create page loop refresh+useRef track state+wait credits load complete,v1.5 remove generate link confirm+success modal add close button
HtmlEditor.less[FH3S]: F:HTML editor styles | R:HtmlEditor.jsx | A:None | S:iOS style styles,page list scroll style page-list-scroll
--Frontend State Management--
/var/www/ai-platform/frontend/src/stores/
htmlEditorStore.js[FH7M]: F:HTML editor state management v1.1 page list limit fix | R:apiClient,message | A:/html-editor/projects,/html-editor/pages,/html-editor/templates | S:Project/page/template CRUD,current page state,publish/unpublish,page list local update,v1.1 getPages default limit changed to 500 fix page lost+added pagination/hasMore state+added loadMorePages method for scroll load

Module 12: Smart Calendar --Backend Routes-- /var/www/ai-platform/backend/src/routes/ calendar.js[RL7PM]: F:Calendar route definitions | R:CalendarController,authenticate,requirePermission,rateLimit | A:/calendar/events,/calendar/categories,/calendar/ai-analysis,/calendar/background-knowledge,/calendar/settings | S:26 endpoints,events management 8 endpoints+categories 4 endpoints+AI analysis 5 endpoints+background knowledge 5 endpoints+settings 3 endpoints+stats 1 endpoint,dual rate limit 60/min+AI analysis 5/5min --Backend Controllers-- /var/www/ai-platform/backend/src/controllers/ CalendarController.js[CL7PL]: F:Calendar controller | R:CalendarEvent,CalendarCategory,CalendarAIAnalysis,CalendarUserSettings,CalendarBackgroundKnowledge,CalendarService | A:/calendar/events,/calendar/categories,/calendar/ai-analysis,/calendar/background-knowledge,/calendar/settings | S:Events CRUD+category management+AI analysis+background knowledge management,content optional title required default status daily,monthly stats+batch delete+quick complete --Backend Services-- /var/www/ai-platform/backend/src/services/ CalendarService.js[SL8PECM]: F:Calendar AI analysis service | R:CalendarEvent,CalendarAIAnalysis,CalendarConfig,CalendarPromptTemplate,CalendarBackgroundKnowledge,AIModel,User,AIService,dayjs | A:Internal service | S:Configurable credits multiplier+prompt template render+background knowledge concatenate,Prompt build include title field,timezone fix dayjs handling --Data Models-- /var/www/ai-platform/backend/src/models/ CalendarEvent.js[DL7M]: F:Calendar event model | R:dbConnection | A:None | S:title required content optional,events CRUD+status management+recurring events+monthly stats backtick avoid MySQL reserved word conflict,importance range 0-10 validation CalendarConfig.js[DL5CS]: F:Calendar config model | R:dbConnection | A:None | S:Credits multiplier config singleton mode range 1.0-10.0,auto create default config 1.0 if not exist CalendarAIAnalysis.js[DL7M]: F:Calendar AI analysis record model | R:dbConnection,errors,logger | A:None | S:Analysis history CRUD+stats getUserStats,analysis_result JSON parse,credits consumed credits_consumed,paginated query getUserAnalyses,ownership check CalendarCategory.js[DL5M]: F:Calendar category data model | R:dbConnection,errors,logger | A:None | S:System preset+user custom dual types,getUserCategories get user available categories,system category cannot modify delete protection,check events under category prevent accidental delete CalendarUserSettings.js[DL5M]: F:Calendar user settings model | R:dbConnection,errors,logger | A:None | S:getOrCreate auto create default settings,AI analysis config scan_days_before/scan_days_after/template_id,auto analysis frequency daily/weekly/monthly,reset CalendarBackgroundKnowledge.js[DL5M]: F:Calendar background knowledge model | R:dbConnection,errors,logger | A:None | S:User background info management for AI analysis context,getEnabledKnowledge get enabled entries,title 100+content 2000 char limit,reorder batch sort transaction,toggleEnabled status toggle --Frontend Pages-- /var/www/ai-platform/frontend/src/pages/calendar/ Calendar.jsx[FL8L]: F:Smart calendar page | R:useCalendarStore,useAuthStore,BackgroundKnowledgeManager,dayjs,ReactMarkdown,antd | A:None | S:Mobile Tab navigation optimized+grid calendar view 3x3/4x4,AI analysis settings persist to database,content optional default status daily,background knowledge management Modal --Frontend State Management-- /var/www/ai-platform/frontend/src/stores/ calendarStore.js[FL8L]: F:Calendar state management | R:api,message | A:/calendar/events,/calendar/categories,/calendar/ai-analysis,/calendar/background-knowledge,/calendar/settings | S:Zustand manage events+categories+AI analysis+background knowledge+settings,autoPerformAnalysis auto analysis 24hr check

Module 13: Storage Management System --Frontend Pages-- /var/www/ai-platform/frontend/src/pages/storage/ StorageManager.jsx[FS8L]: F:Smart cloud storage main page v1.1 | R:storageStore,authStore,react-dnd | A:None | S:iOS style interface,drag upload,grid/list dual view,right-click menu,folder tree flatten,v1.1 added smart cloud storage title+folder list subtitle+current folder name display StorageManager.less[FS5M]: F:Smart cloud storage styles v1.1 | R:StorageManager.jsx | A:None | S:Gradient color system,iOS style card,file type color gradient,v1.1 added folder-list-title+current-folder-name styles --Frontend i18n-- /var/www/ai-platform/frontend/src/locales/zh-CN/ storage.json[FS5C]: F:Smart cloud storage i18n | R:i18n | A:None | S:File management all Chinese text,v1.1 added smartStorage/folderList/myFolder --Backend Routes-- /var/www/ai-platform/backend/src/routes/ storageRoutes.js[RS7S]: F:Storage management routes | R:StorageController,authMiddleware | A:/storage/files,/storage/folders | S:File upload/delete/move,folder create/rename/delete,storage stats,batch delete --Backend Controllers-- /var/www/ai-platform/backend/src/controllers/ StorageController.js[CS8PTRL]: F:Storage management controller | R:UserFile,UserFolder,ossService,multer,dbConnection | A:/storage/files/upload,/storage/folders/:id/rename | S:Disk storage avoid memory overflow,filename encoding fix latin1->utf8,3 folder types permission global/group/personal,credits deduct transaction+row lock fix concurrency,100+ file type whitelist,folder rename recursive update sub-paths --Backend Services-- /var/www/ai-platform/backend/src/services/ ossService.js[SS9EM]: F:OSS storage service | R:ali-oss,fs,dbConnection | A:Internal service | S:Aliyun OSS+local storage dual mode,config read from system_settings,key hidden detect ******,signed URL generate,thumbnail processing OSS image processing,batch delete --Data Models-- /var/www/ai-platform/backend/src/models/ UserFolder.js[DS7RTM]: F:User folder model | R:dbConnection | A:None | S:3 folder types personal/global/group,recursive update sub-folder paths on rename,tree structure query,cascade soft delete,auto create organization folder UserFile.js[DS7RM]: F:User file model | R:dbConnection,ossService | A:None | S:uploaded_by record uploader,soft delete+storage stats update,3 folder types permission query,file move,ownership check,default 10GB quota --Frontend State Management-- /var/www/ai-platform/frontend/src/stores/ storageStore.js[FS7M]: F:Storage management state | R:apiClient | A:/storage/files,/storage/folders,/admin/oss/,/admin/storage-credits/ | S:Folder tree+3 folder types global/org/personal,file upload progress,batch delete,folder rename,OSS config management,credits calculate 5MB segments

Module 14: OCR --Backend Routes-- /var/www/ai-platform/backend/src/routes/ ocrRoutes.js[RO5ES]: F:OCR route definitions | R:OcrController,authenticate,multer,requireSuperAdmin | A:/ocr/config,/ocr/process-image,/ocr/process-pdf,/ocr/process-batch,/ocr/tasks | S:7 endpoints,multer config 50MB+20 files+7 MIME types,single image/PDF/batch processing+task detail history+admin config update --Backend Controllers-- /var/www/ai-platform/backend/src/controllers/ OcrController.js[CO5EPS]: F:OCR controller | R:ocrService,ResponseHelper,dbConnection,User | A:/ocr/config,/ocr/process-image,/ocr/process-pdf,/ocr/process-batch,/ocr/tasks | S:7 endpoints,single image/PDF/batch processing+task history+config management,multer file upload validate 7 MIME types,credits check+deduct,batch processing error collect --Backend Services-- /var/www/ai-platform/backend/src/services/ ocrService.js[SO7PEL]: F:OCR recognition service | R:axios,dbConnection,ossService,User | A:Mistral OCR API | S:Mistral OCR API integration support image+PDF,Base64 convert+180s timeout,charge by page image 5 credits/PDF page 3 credits,filename encoding fix latin1->utf8,cleanup OCR result cleanupOCRResult remove empty tables,24hr dedup --Frontend State Management-- /var/www/ai-platform/frontend/src/stores/ ocrStore.js[FO5S]: F:OCR frontend state management | R:zustand,apiClient,message | A:/ocr/config,/ocr/process-image,/ocr/process-pdf,/ocr/process-batch,/ocr/tasks | S:Single image/PDF/batch processing 3 modes,FormData upload multipart,task list paginated,config management config

Module 15: Mind Map --Frontend Pages-- /var/www/ai-platform/frontend/src/pages/mindmap/ Mindmap.jsx[FH8PL]: F:Mind map main page v1.2 fix zoom error | R:markmap-lib,markmap-view,MermaidPreview,SvgPreview,authStore | A:/mindmap,/mindmap/credits-config,/mindmap/export-log | S:iOS tech style design,Markdown/Mermaid/SVG 3 modes,credits management,export SVG/PNG/PDF/MD,v1.1 fix PDF export text empty+layout 30%/70%,v1.2 fix SVG mode d3-zoom error+CSS transform zoom Mindmap.less[FH3S]: F:Mind map styles v1.2 fix zoom | R:Mindmap.jsx | A:None | S:iOS tech style styles,editor 30% preview 70% layout,v1.2 add explicit pixel size to SVG avoid d3-zoom error /var/www/ai-platform/frontend/src/pages/mindmap/components/ SvgPreview.jsx[FH4M]: F:SVG preview component v1.5 safe render | R:DOMPurify | A:None | S:v1.1 fix SVG size issue,v1.2 support foreignObject+HTML content,v1.3 complex SVG use iframe render,v1.4-v1.5 fix sandbox security warning+CSS work properly MermaidPreview.jsx[FH3S]: F:Mermaid flowchart preview component | R:mermaid | A:None | S:Mermaid syntax render,live preview /var/www/ai-platform/frontend/src/pages/mindmap/constants/ templates.js[FH2S]: F:Mind map default templates | R:None | A:None | S:Markdown/Mermaid/SVG 3 template example code --Backend Routes-- /var/www/ai-platform/backend/src/routes/ mindmapRoutes.js[RO5PBM]: F:Mind map route definitions | R:authenticate,dbConnection,SystemConfig,User | A:/mindmap/credits-config,/mindmap/,/mindmap/export-log | S:7 endpoints,credits config+check credits+list+save+update+export log+delete,support markdown/mermaid/svg 3 modes

Module 16: Admin Backend --Backend Routes-- /var/www/ai-platform/backend/src/routes/admin/ userRoutes.js[RAC8RS]: F:User management routes v1.1 batch create | R:UserManagementController,authMiddleware,permissions | A:/api/admin/users,/api/admin/users/batch-create,/api/admin/users/:id/* | S:User CRUD+account expiry+model permissions+remove from group,v1.1 added POST /batch-create batch create users route usageLogRoutes.js[RAC7RS]: F:Usage log routes v1.1 view chat permission | R:UsageLogController,authMiddleware | A:/api/admin/usage-logs,/api/admin/usage-logs/can-view-chat | S:Usage log list+summary+export,v1.1 added GET /can-view-chat check group admin view chat permission userTagRoutes.js[RAC7RS]: F:User tag routes | R:UserTagController,authMiddleware | A:/admin/user-tags/* | S:12 endpoints,group tag CRUD+user tag assign/remove+batch operations+filter users+stats,requirePermission('user.manage') permission control systemPromptRoutes.js[RAC7RS]: F:System prompt routes | R:SystemPromptController,authMiddleware | A:/admin/system-prompts/* | S:7 endpoints,CRUD+feature toggle+status query,requireRole(['super_admin']) super admin only groupRoutes.js[RAC8RSL]: F:User group routes | R:UserGroupController,permissions,systemUploadMiddleware | A:/admin/user-groups/* | S:16 endpoints,group CRUD+credits pool+invitation code+expiry+site config+Logo upload,dual layer permission user.manage/group.manage distinguish group admin and super admin modelRoutes.js[RAC7RS]: F:AI model management routes | R:AIModelController,permissions | A:/admin/models/* | S:7 endpoints,CRUD+test connection+group management,canViewAIModels/canManageAIModels dual layer permission analyticsRoutes.js[RAC7RS]: F:Data analytics routes | R:AnalyticsController,authMiddleware | A:/admin/analytics/* | S:3 endpoints,comprehensive analysis+export report+realtime dashboard,requireRole(['admin','super_admin']) moduleRoutes.js[RAC8RS]: F:System module routes | R:ModuleController,superAdminMiddleware | A:/admin/modules/* | S:9 endpoints,user modules 2 public+module CRUD 7 super admin only,health check+status toggle ossRoutes.js[RAC5RS]: F:OSS config routes | R:OSSConfigController,permissions | A:/admin/oss/* | S:6 endpoints,OSS config+test connection+credits config+stats,canManageSystem() super admin only --Backend Controllers-- /var/www/ai-platform/backend/src/controllers/admin/ UserManagementController.js[CA8RMv1.2]: F:User management controller v1.2 view chat permission | R:UserService,ResponseHelper,CacheService | A:GET/POST/PUT/DELETE /admin/users/,POST /admin/users/batch-create | S:User list with tags/details/CRUD,model permission query update,remove from group,account expiry set/extend/sync group expiry,v1.1 batch create users,v1.2 added can_view_chat_history field read/write support group admin view chat permission UsageLogController.js[CA7RSv1.1]: F:Usage log controller v1.1 view chat permission | R:UsageLogService,User,ResponseHelper | A:/admin/usage-logs,/admin/usage-logs/summary,/admin/usage-logs/export,/admin/usage-logs/can-view-chat | S:Usage log list+summary stats+Excel export,v1.1 added canViewChat method check group admin can_view_chat_history permission UserGroupController.js[CA8RETM]: F:User group management controller | R:GroupService,UserFolder,ossService,CacheService | A:GET/POST/PUT/DELETE /admin/groups/ | S:Group CRUD+auto create OSS folder,credits pool allocate/reclaim,invitation code CRUD+log query,member limit/expiry/site config AnalyticsController.js[CC7RS]: F:Data analytics controller | R:AnalyticsService,ResponseHelper,moment,ROLES | A:/admin/analytics,/admin/analytics/export,/admin/analytics/dashboard | S:3 methods getAnalytics/exportAnalytics/getDashboard,group admin data isolation actualGroupId,Excel export buffer response,serial query fix MySQL concurrency issue UserTagController.js[CA7RSM]: F:User tag management controller | R:UserTagService,ResponseHelper,logger,dbConnection | A:/admin/user-tags/group/:groupId,/admin/user-tags,/admin/user-tags/:id,/admin/user-tags/user/:userId,/admin/user-tags/filter-users,/admin/user-tags/statistics/:groupId | S:12 methods,group tag CRUD+batch get getBatchTagInfo,user tag assign/remove/overwrite update,filter users by tag AND/OR,group admin permission check only operate own group SystemPromptController.js[CA7RSM]: F:System prompt management controller | R:SystemPrompt,SystemConfig,ResponseHelper,logger,CacheService | A:/admin/system-prompts,/admin/system-prompts/:id,/admin/system-prompts/toggle,/admin/system-prompts/status | S:7 methods,CRUD+feature toggle+status query,cache clear,super admin only ModuleController.js[CA8RSL]: F:System module management controller | R:Module,ResponseHelper,JWTService,logger,CacheService | A:/admin/modules,/admin/modules/:id,/admin/modules/user-modules,/admin/modules/:id/auth-url,/admin/modules/:id/health | S:9 methods,system/external module dual type management,getUserModules user accessible modules,getModuleAuthUrl JWT auth URL generate,health check,core module cannot disable/delete protection OSSConfigController.js[CA5RCEM]: F:OSS config management controller | R:ResponseHelper,logger,dbConnection,ali-oss | A:/admin/oss/config,/admin/oss/test,/admin/oss/credits,/admin/oss/stats | S:6 methods,OSS config CRUD+test connection,Aliyun OSS+local storage dual mode,accessKeySecret key hidden ****,storage credits config transaction update,storage stats --Backend Services-- /var/www/ai-platform/backend/src/services/admin/ UserService.js[SAC9URETL]: F:User management service v1.1 batch create+email optional | R:User,GroupService,SystemConfig,moment,bcrypt | A:None | S:User CRUD+soft delete,group change credits return logic,model permission management,remove from group function,account expiry management+group sync,v1.1 added batchCreateUsers batch create users username rule generate+group credits pool deduct+random/uniform password+transaction row lock,email changed to optional validateUserData UsageLogService.js[SAC7S]: F:Usage log service | R:dbConnection | A:None | S:Usage log list paginated+summary stats+TOP users+model usage distribution,group admin data isolation,Excel export data format GroupService.js[SAC9GRETL]: F:User group service | R:User,AIModel,dbConnection | A:None | S:Group CRUD+clone,credits pool credits_pool/credits_pool_used allocate reclaim,member limit user_limit check,group expiry expire_date sync,site config site_customization,invitation code system 5 uppercase+usage limit+log,auto assign AI models UserTagService.js[SAC7UT]: F:User tag service | R:dbConnection | A:None | S:Tag CRUD,batch get getBatchTagInfo,assign/remove/overwrite update user tags,filter users by tags AND/OR relation,tag stats+user count,group tag isolation AnalyticsService.js[SCC7L]: F:Data analytics BI service | R:dbConnection,XLSX,moment,errors | A:Internal service | S:Comprehensive analysis 6 dimensions overview/timeSeries/users/models/modules/tags,time granularity day/week/month,user distribution 5 tier credits range,TOP20 user ranking,model analysis chat+image dual type,Excel export multi-Sheet,fix deleted_at filter 20+ queries StatsService.js[SCC8M]: F:System stats service | R:dbConnection,errors | A:Internal service | S:6 stats types user/group/conversation/model/credits/realtime,group admin data isolation,online user 5min activity check,today data stats,7-day trend analysis,credits expiring reminder expiring_soon,fix deleted_at filter 15+ queries --Stats Controller-- /var/www/ai-platform/backend/src/controllers/ statsController.js[COC7S]: F:Stats controller | R:StatsService,User,dbConnection | A:/stats/realtime,/stats/online-users,/stats/heartbeat,/stats/user-credits | S:Realtime stats,online user list,heartbeat interface 5min activity check,user credits stats today consumption+group info+expiry status,direct DB query no Redis --Frontend Pages-- /var/www/ai-platform/frontend/src/pages/admin/ Settings.jsx[FA9CRL]: F:Admin backend settings main page v1.4 smart apps | R:adminStore,authStore,systemConfigStore,25+ settings components | A:Aggregate all /admin/ settings | S:Tabs aggregate 25+ settings components,super admin see all/group admin see stats+logs+teaching+models,AI model CRUD+test,system module CRUD+health check,v1.4 added smart apps management Tab Users.jsx[FC8RL]: F:User management main page v1.1 batch create | R:adminStore,authStore,14 sub-components | A:/admin/users,/admin/user-groups,/admin/user-tags | S:3 tabs users/groups/tags,search state persist prevent lost,pagination dual layer user+group,group credits pool+invitation code+site config+expiry management,v1.1 added batch create button+BatchCreateUsersModal modal /var/www/ai-platform/frontend/src/pages/dashboard/ Dashboard.jsx[FC8M]: F:Workspace page | R:authStore,moduleStore,apiClient,ReactMarkdown | A:/stats/user-credits,/admin/announcement | S:Welcome message+date time,feature module grid exclude admin and dashboard,credits center 4 stats,system announcement Markdown edit super admin,mobile responsive --Frontend Components-- /var/www/ai-platform/frontend/src/components/admin/settings/ UsageLogs.jsx[FA7RMv1.2]: F:Usage logs component v1.2 permission hide | R:adminStore,authStore,apiClient,ConversationContentDrawer | A:/admin/usage-logs,/admin/usage-logs/summary,/admin/usage-logs/can-view-chat | S:Usage log list+stats summary+TOP users,v1.1 permission check canViewChat,v1.2 no permission completely hide content column useMemo dynamic column generate,group admin unaware view function exists SmartAppSettings.jsx[FA8CMv1.2]: F:Smart app management component v1.2 temperature input optimization | R:api,Form,Table,Modal,Switch | A:/admin/smart-apps/ | S:Smart app CRUD table+edit modal,category/publish status filter,toggle publish Switch,copy app function,v1.2 temperature from Slider to InputNumber manual input range 0-2 step 0.1 SystemModuleFormModal.jsx[FA7CRLv1.1]: F:System module form modal v1.1 icon extension | R:adminStore,Form,Modal,Select,*Icons | A:Via Settings.jsx | S:System/external module edit form,v1.1 icon selector from 22 extended to 180+ uniqueIcons dedupe sort+listHeight 400+filterOption fuzzy search,SSO JWT auth config secret/algorithm/expiresIn/tokenMethod/ssoEndpoint,Payload field select 11 user fields,access permission allowed_groups multi-select,core module isCoreModule restrict edit /var/www/ai-platform/frontend/src/components/admin/users/ BatchCreateUsersModal.jsx[FA7UPM]: F:Batch create users modal v1.1 added | R:Form,InputNumber,Select,Table,Statistic,adminStore | A:None | S:Username rule generate prefix+connector+sequence+digits,group credits pool balance check+deduct preview,uniform password/random password toggle,create result table,copy to clipboard+CSV export function UserFormModal.jsx[FA7UMv1.3]: F:User form modal v1.3 view chat permission | R:Form,Input,Select,Tabs,Switch,moment | A:None | S:User create/edit form,UUID display+copy,account expiry management Tab,password reset Tab,v1.1 email changed to optional,v1.2 group admin special permission area+view member chat record switch can_view_chat_history,v1.3 fix Switch initial value binding issue initialValues+setTimeout delayed set index.js[FA5S]: F:User components export index v1.1 update | R:16 user management components | A:None | S:Export UserTable/UserFormModal/UserSearchForm/UserDetailDrawer/UserGroupTable/UserGroupFormModal/UserCreditsTab/DistributeCreditsModal/GroupCreditsPoolModal/GroupUserLimitModal/GroupExpireDateModal/GroupSiteConfigModal/GroupInvitationCodeModal/GroupInvitationLogsModal/UserModelRestrictModal,v1.1 added BatchCreateUsersModal export UserTable.jsx[FA7M]: F:User list table | R:Table,Tag,Space,Popconfirm | A:None | S:User table display,status/role/group Tag,action buttons edit/delete/reset password/model permissions/tag management/credits allocate,permission control,pagination UserSearchForm.jsx[FA5S]: F:User search form | R:Form,Input,Select,Button | A:None | S:Username/email/role/status/group multi-condition search,reset function UserDetailDrawer.jsx[FA5M]: F:User detail drawer | R:Drawer,Descriptions,Statistic | A:None | S:User basic info/credits info/account info display,Token usage stats,expiry display UserGroupTable.jsx[FA7M]: F:User group list table | R:Table,Tag,Space,Popconfirm | A:None | S:Group table display,credits pool/member count/expiry,action buttons edit/delete/credits pool/limit/expiry/site config/invitation code,permission control UserGroupFormModal.jsx[FA5M]: F:User group form modal | R:Form,Input,ColorPicker | A:None | S:Group create/edit form,color picker,expiry setting UserCreditsTab.jsx[FA7PM]: F:User credits management Tab | R:Statistic,Table,Button | A:None | S:Credits stats card,recharge/deduct operations,credits history table,expiry management DistributeCreditsModal.jsx[FA5PM]: F:Credits distribute modal | R:Form,InputNumber,Radio | A:None | S:Group credits pool allocate/reclaim toggle,balance display,reason description GroupCreditsPoolModal.jsx[FA5PM]: F:Group credits pool setting modal | R:Form,InputNumber,Statistic | A:None | S:Credits pool total setting,current status display GroupUserLimitModal.jsx[FA5S]: F:Group member limit setting modal | R:Form,InputNumber | A:None | S:Member limit setting,current member count display GroupExpireDateModal.jsx[FA5S]: F:Group expiry setting modal | R:Form,DatePicker,Switch | A:None | S:Group expiry setting,sync to members switch GroupSiteConfigModal.jsx[FA5M]: F:Group site config modal | R:Form,Input,Upload | A:None | S:Site name/Logo config,preview function GroupInvitationCodeModal.jsx[FA5M]: F:Group invitation code management modal | R:Form,Input,Switch,InputNumber | A:None | S:Invitation code setting/generate,usage limit,expiry GroupInvitationLogsModal.jsx[FA5M]: F:Invitation code usage log modal | R:Table,Modal | A:None | S:Invitation registration record list,paginated query UserModelRestrictModal.jsx[FA7RM]: F:User model restriction modal | R:Modal,Checkbox,Table | A:/admin/users/:id/model-permissions,/admin/users/:id/model-restrictions | S:User available model list,restrict model selection,save restriction config --Frontend i18n-- /var/www/ai-platform/frontend/src/locales/zh-CN/ admin.json[FA5Cv1.1]: F:Admin backend Chinese i18n v1.1 view chat permission | R:i18n | A:None | S:Admin backend all Chinese text,v1.1 added canViewChatHistory/canViewChatHistory.help/canViewChatHistory.warning group admin view chat permission related text --Frontend State Management-- /var/www/ai-platform/frontend/src/stores/ moduleStore.js[FC7RS]: F:System module state management | R:apiClient | A:/admin/modules/user-modules | S:Zustand manage user accessible modules,getUserModules get active module list,getModuleByName query by name,control sidebar module display permission adminStore.js[FA8OL]: F:Admin backend state v1.1 batch create | R:apiClient | A:/admin/users,/admin/users/batch-create,/admin/user-groups,/admin/models,/admin/settings,/admin/system-prompts,/admin/usage-logs | S:User/group/credits/model/system full management,include_tags support,invitation code management,site config,expiry management,v1.1 added batchCreateUsers batch create users API call analyticsStore.js[FC7S]: F:Data analytics frontend state | R:zustand,api,message | A:/admin/analytics,/admin/analytics/dashboard,/admin/analytics/export | S:Fix API path remove /api prefix,filters filter startDate/endDate/groupId/tagIds/timeGranularity,Excel export blob download statsStore.js[FC7S]: F:Stats data frontend state | R:zustand,apiClient | A:/stats/realtime,/stats/heartbeat | S:Cancel WebSocket use 30s polling,realtimeStats 7 indicators,online count onlineCount,heartbeat interface

Module 17: Other Tools & Services --Database Services-- /var/www/ai-platform/backend/src/services/ statsService.js[SOC7M]: F:Stats data service | R:dbConnection | A:None | S:No Redis direct DB query,user online 5min check,today active stats,hot models Top3,realtime stats 7 indicators --Backend Routes-- /var/www/ai-platform/backend/src/routes/ stats.js[RC7S]: F:Stats data route definitions | R:StatsController,authMiddleware | A:/api/stats/realtime,/api/stats/online-users,/api/stats/heartbeat,/api/stats/user-credits | S:4 endpoints realtime stats+online users+heartbeat+user credits stats,all routes require authenticate,online user list requires user.manage permission --Frontend Pages-- /var/www/ai-platform/frontend/src/pages/ocr/ OcrTool.jsx[FO7PEL]: F:OCR text recognition tool page | R:useOcrStore,useAuthStore,Upload,Modal,Tabs,Collapse | A:/ocr/process-image,/ocr/process-pdf,/ocr/process-batch,/ocr/tasks,/ocr/config | S:3 recognition modes single image+PDF+batch max 20 files,credits pricing image 5/each+PDF by page 3/page,file upload max 50MB,drag upload Dragger component,history Table display,iOS glass card style

Module 18: Smart App Plaza --Backend Routes-- /var/www/ai-platform/backend/src/routes/ smartAppRoutes.js[RP8RM]: F:Smart app route definitions v2.2 favorite function | R:SmartAppController,authenticate,requireSuperAdmin | A:User side /smart-apps,admin side /admin/smart-apps | S:User side 10 endpoints GET list+GET categories+GET favorites list+GET detail+GET config+POST use record+POST add favorite+DELETE remove favorite+GET conversation+POST clear conversation,admin side 11 endpoints CRUD+toggle publish+category CRUD,v2.2 added 3 favorite routes GET /favorites+POST/:id/favorite+DELETE/:id/favorite,dual router export router+adminRouter --Backend Controllers-- /var/www/ai-platform/backend/src/controllers/ SmartAppController.js[CP8RM]: F:Smart app controller v2.2 favorite function | R:SmartApp,AIModel,ResponseHelper,logger,dbConnection | A:All smartAppRoutes endpoints | S:Dual controller SmartAppAdminController+SmartAppUserController,admin side CRUD+toggle publish+category CRUD return toFullJSON with system prompt,user side list return array format with is_favorited favorite status+detail+config+use record,v2.2 added 3 favorite methods getFavorites/addFavorite/removeFavorite,getCategories return favoriteCount count,v2.1 config sync getOrCreateConversation compare 4 config items auto UPDATE --Backend Data Models-- /var/www/ai-platform/backend/src/models/ SmartApp.js[DP7CRMv2.2]: F:Smart app data model v2.2 favorite function | R:dbConnection,logger | A:None | S:Smart app CRUD+publish toggle+use count stats,v2.2 added 5 favorite methods addFavorite/removeFavorite/getFavorites/getFavoriteIds/isFavorited,findPublished support userId parameter LEFT JOIN favorites table return is_favorited status,toJSON output is_favorited field,v2.0 category_ids JSON array 1-3 categories+credits_per_use credits 0-9999+JSON_CONTAINS query+populateCategories batch populate --Frontend Pages-- /var/www/ai-platform/frontend/src/pages/smartApps/ SmartApps.jsx[FP8L]: F:App plaza main page v2.3 compact layout | R:useSmartAppStore,SmartAppChatModal,HeartOutlined,HeartFilled | A:/smart-apps,/smart-apps/categories,/smart-apps/favorites | S:iOS style app card grid,v2.2 favorite function favoriteCount+toggleFavorite+handleFavoriteClick stop propagation,dynamic categories+categoryStats,Segmented category filter support favorites value,hot mark use_count>10,v2.3 added PC 4 columns xs=12/sm=12/md=8/lg=6+mobile 6-grid 2 columns+isMobile responsive hide category tags+description single line ellipsis rows=1+Row gutter mobile 8/PC 12 SmartApps.less[FP5S]: F:App plaza styles v2.3 compact 6-grid | R:SmartApps.jsx | A:None | S:iOS style design,v2.2 favorite button heartBeat animation,v2.3 added category horizontal scroll overflow-x:auto+hide scrollbar scrollbar-width:none+card compact min-height PC 160px/mobile 140px+padding PC 14px/mobile 10px+.mobile-card mobile center layout flex-direction:column+icon 52px --Frontend Components-- /var/www/ai-platform/frontend/src/components/admin/settings/ SmartAppSettings.jsx[FA8CM]: F:Smart app management component v2.0 category management+multi-category+credits | R:api,Form,Table,Modal,Switch,Drawer,ColorPicker | A:/admin/smart-apps/,/admin/smart-apps/categories/ | S:Smart app CRUD table+edit modal,v2.0 added category management Drawer+category CRUD+ColorPicker color select,category_ids multi-select Select max 3 categories,credits_per_use credits InputNumber range 0-9999,category/publish status filter by category_id,table display multi-category Tag+credits Tag,copy app function /var/www/ai-platform/frontend/src/components/smartApps/ SmartAppChatModal.jsx[FP8AL]: F:Smart app chat window component | R:apiClient,authStore,ReactMarkdown,remarkGfm,SyntaxHighlighter | A:/smart-apps/:id/conversation,/chat/conversations/:id/messages | S:Fixed center popup not draggable,bottom right resize-handle adjust size,minimize floating ball bottom right fixed position,pointer-events:none allow click outside window,conversation persist localStorage store window size,stream output postStream,messages sort by created_at,AI avatar lightning SVG+user first letter,code block highlight oneDark,ESC close SmartAppChatModal.less[FP5S]: F:Smart app chat window styles | R:SmartAppChatModal.jsx | A:None | S:wrapper layer pointer-events:none pass through+window pointer-events:auto,fixed center flex layout,gradient title bar+AI bubble,resize-handle bottom right resize handle gradient background,minimized-ball floating ball hover scale animation,streaming-cursor blink animation,responsive mobile full width index.js[FP3S]: F:Smart app components export index | R:SmartAppChatModal | A:None | S:Export SmartAppChatModal component --Frontend State Management-- /var/www/ai-platform/frontend/src/stores/ smartAppStore.js[FP7M]: F:Smart app state management v2.2 favorite function | R:apiClient,message | A:/smart-apps,/smart-apps/categories,/smart-apps/favorites,/smart-apps/:id,/smart-apps/:id/config,/smart-apps/:id/use,/smart-apps/:id/favorite,/smart-apps/:id/conversation,/smart-apps/:id/conversation/clear | S:Zustand manage apps array with is_favorited+categories+categoryStats+favoriteCount dynamically loaded from database,v2.2 added getFavorites get favorites list+toggleFavorite toggle favorite status update local apps and favoriteCount,getCategories return {categories,stats,favoriteCount} 3 data,getAppsByCategory filter by category_ids multi-category,getOrCreateConversation get or create conversation+clearConversation clear conversation

Module 19: Wiki Knowledge Base --Backend Routes-- /var/www/ai-platform/backend/src/routes/ wikiRoutes.js[RW7S]: F:Wiki route definitions v3.0 version equality | R:WikiController,authMiddleware | A:/wiki/items,/wiki/items/:id,/wiki/items/:id/version,/wiki/items/:id/versions,/wiki/versions/:id(GET+PUT),/wiki/items/:id/versions/:versionId(DELETE),/wiki/items/:id/pin,/wiki/items/:id/editors | S:Wiki CRUD+version management,v3.0 added PUT /wiki/versions/:id save to specified version,removed rollback(version equality no need),13 endpoints --Backend Controllers-- /var/www/ai-platform/backend/src/controllers/ WikiController.js[CW8RML]: F:Wiki controller v3.0 version equality | R:WikiItem,ResponseHelper,logger | A:All wikiRoutes endpoints | S:14 methods,v3.0 added updateVersion save to specified version,updateItem changed to only update basic info is_pinned/sort_order,3-level scope permission personal/team/global,version create/history/delete,editor add/remove,pin toggle --Backend Data Models-- /var/www/ai-platform/backend/src/models/ WikiItem.js[DW9RTJM]: F:Wiki data model type fix | R:dbConnection,errors,logger | A:None | S:Refactored version management all versions equal,added updateVersion save to specified version+createNewVersion copy based on specified version+updateBasicInfo update basic info,3-level scope personal/team/global,version management max 50 versions auto cleanup,JSON fields notes/links max 10 each,editor management wiki_editors table,permission check checkAccess/checkCanEdit/isEditor,fix createNewVersion type comparison bug convert wikiId/baseVersionId to parseInt+Number() ensure type consistency+auto fallback to latest version when current version not exist --Frontend State Management-- /var/www/ai-platform/frontend/src/stores/ wikiStore.js[FW8M]: F:Wiki state management v3.0 version equality | R:apiClient,message | A:/wiki/items,/wiki/items/:id,/wiki/items/:id/version,/wiki/items/:id/versions,/wiki/versions/:id(GET+PUT),/wiki/items/:id/versions/:versionId | S:v3.0 refactored use currentVersion replace selectedVersionNumber,added saveVersion save to specified version,switch version=switch workspace load full content,Zustand manage items+currentItem+currentVersion+versions+editors,CRUD+version management createVersion/getVersions/switchToVersion/saveVersion/deleteVersion+editor management+pin toggle --Frontend Pages-- /var/www/ai-platform/frontend/src/pages/wiki/ Wiki.jsx[FW8L]: F:Wiki main page v4.0 version equality | R:wikiStore,authStore,dayjs,i18n | A:None | S:v4.0 refactored version management logic:switch to which version edit that one+save to currently viewing version+new version copy based on current version,iOS frosted glass tech style design,3-level scope filter Segmented,card list Grid,edit Drawer,version dropdown select+3 buttons(new version/save/delete version),notes/links max 10 each Form.List Wiki.less[FW5M]: F:Wiki styles v3.1 | R:Wiki.jsx | A:None | S:iOS frosted glass tech style,gradient header+icon,card hover animation,scope tag colors,edit drawer custom header,version dropdown menu wiki-version-dropdown,content label row wiki-content-label-row toolbar inline,responsive mobile adaptation --Frontend i18n-- /var/www/ai-platform/frontend/src/locales/zh-CN/ wiki.json[FW5C]: F:Wiki i18n | R:i18n | A:None | S:Wiki all Chinese text,3-level scope/action buttons/form fields/version management/confirm dialogs

===AI Application Platform Code Index Section-Complete===

===AI Application Platform Database Full Index-20260123===
[Index Notes]
Compact tags[ABC]: A-Table type(U-User/T-Transaction/C-Content/S-System/L-Log/E-Teaching/A-Workflow/P-SmartApp/W-Wiki) B-Features(P-Credits/S-SoftDelete/U-UUID-PK/J-JSON-Field/F-MultiForeignKey) C-Priority(9-Core/7-Business/5-Config/3-Auxiliary)
Field constraints: PK-PrimaryKey UK-UniqueKey FK-ForeignKey IX-Index SD-SoftDelete JS-JSON CR-Credits DT-DateTime
Format: table_name[ABC] | primary_key | unique_keys | foreign_keys | indexes | special_fields

Total: 87 tables (incl 3 views, 4 backup tables)

User Authentication Module - 11 tables
users[U9PS] | id[PK] | uuid,email,username[UK] | group_id->user_groups[FK] | role,status,expire_at,credits_expire_at[IX] | credits_quota/used[CR],deleted_at[SD],can_view_chat_history[BOOL]
user_groups[U7PSJ] | id[PK] | name,invitation_code[UK] | created_by->users[FK] | is_active,sort_order[IX] | credits_pool/used[CR],expire_date[DT],site_customization[JS]
user_tags[U5F] | id[PK] | group_id+name[UK] | group_id->user_groups,created_by->users[FK] | is_active,sort_order[IX] | -
user_tag_relations[T5F] | id[PK] | - | user_id->users,tag_id->user_tags[FK] | - | -
user_tag_history[L3] | id[PK] | - | user_id->users,tag_id->user_tags,operator_id->users[FK] | created_at[IX] | -
user_sessions[L3] | id[PK] | - | user_id->users[FK] | expires_at[IX] | -
token_blacklist[L5] | id[PK] | token_jti[UK] | user_id->users[FK] | expires_at[IX] | -
invitation_codes[S5] | id[PK] | code[UK] | created_by->users[FK] | is_active,expires_at[IX] | -
invitation_code_logs[L3] | id[PK] | - | code_id->invitation_codes,user_id->users[FK] | created_at[IX] | -
user_activities[L5F] | id[PK] | - | user_id->users[FK] | created_at[IX] | -
permissions[S5] | id[PK] | - | - | - | -

Credits System - 4 tables
credit_transactions[T9PF] | id[PK] | - | user_id->users,operator_id->users,model_id->ai_models,conversation_id->conversations[FK] | user_id+created_at,transaction_type,request_id[IX] | amount,balance_after[CR]
billing_logs[L5PF] | id[PK] | - | user_id->users,conversation_id->conversations[FK] | user_id,created_at,billing_type[IX] | tokens_used,credits_used[CR]
storage_credit_config[S3P] | id[PK] | - | - | - | price_per_mb[CR]
storage_credits_config_simple[S3P] | id[PK] | - | - | - | base_credits,credits_per_5mb[CR]

Conversation System - 3 tables
conversations[C9USJF] | id(uuid)[PK] | - | user_id->users,system_prompt_id->system_prompts,module_combination_id->module_combinations,smart_app_id->smart_apps[FK] | user_id,priority,model_name,cleared_at[IX] | cleared_at[DT],smart_app_id[FK]
messages[C9USJF] | id(uuid)[PK] | - | conversation_id->conversations,file_id->files[FK] | conversation_id,sequence_number,status[IX] | generated_images[JS]
files[C7UF] | id(uuid)[PK] | - | user_id->users,conversation_id->conversations[FK] | user_id,status[IX] | extracted_content[TEXT]

AI Model Configuration - 5 tables
ai_models[S7PJCF] | id[PK] | name[UK] | - | provider,is_active,is_public,credits_per_chat[IX] | api_key[ENC],model_config[JS],credits_per_chat[CR]
ai_model_groups[T5F] | id[PK] | model_id+group_id[UK] | model_id->ai_models,group_id->user_groups[FK] | - | -
user_model_restrictions[T3F] | id[PK] | - | user_id->users,model_id->ai_models[FK] | - | -
system_prompts[S5J] | id[PK] | - | - | is_active,sort_order[IX] | group_ids[JS],content[TEXT]
system_prompt_groups[T3F] | id[PK] | - | prompt_id->system_prompts,group_id->user_groups[FK] | - | -

Knowledge Module Magic Cube - 5 tables
knowledge_modules[C7PSJ] | id[PK] | - | creator_id->users,group_id->user_groups[FK] | module_scope,is_active[IX] | group_ids[JS],content[TEXT],tokens[CR]
module_combinations[C5J] | id[PK] | - | user_id->users[FK] | is_active[IX] | estimated_tokens[CR]
module_combination_items[T5F] | id[PK] | combination_id+module_id[UK] | combination_id->module_combinations,module_id->knowledge_modules[FK] | order_index[IX] | -
knowledge_module_tag_permissions[T3F] | id[PK] | - | module_id->knowledge_modules,tag_id->user_tags[FK] | - | -
system_modules[S5J] | id[PK] | name[UK] | - | module_category,is_active,sort_order[IX] | config[JS]

Smart App Plaza - 3 tables
smart_apps[P7PJCF] | id[PK] | - | model_id->ai_models,creator_id->users[FK] | is_published,sort_order[IX] | system_prompt[TEXT],temperature[DEC],context_length[INT],use_count[CR],credits_per_use[CR],category_ids[JS]
smart_app_categories[P5C] | id[PK] | name[UK] | - | sort_order,is_active[IX] | color[VARCHAR],updated_at[DT]
user_smart_app_favorites[P5F] | id[PK] | user_id+smart_app_id[UK] | user_id->users,smart_app_id->smart_apps[FK] | user_id,smart_app_id[IX] | created_at[DT]

Agent Workflow - 7 tables
agent_workflows[A7UJ] | id[PK] | - | user_id->users[FK] | is_published[IX] | flow_data[JS]
agent_executions[A7PJF] | id[PK] | - | workflow_id->agent_workflows,user_id->users[FK] | status,started_at[IX] | input/output_data,execution_log[JS],total_credits_used[CR]
agent_node_executions[A5PJF] | id[PK] | - | execution_id->agent_executions[FK] | node_type,status[IX] | input/output_data[JS],credits_used[CR]
agent_node_types[S5PJ] | id[PK] | type_key[UK] | - | category,is_active,display_order[IX] | config_schema[JS],credits_per_execution[CR],max_inputs[INT],max_outputs[INT]
agent_workflow_templates[S3J] | id[PK] | - | - | - | template_data[JS]
api_services[S5PF] | id[PK] | service_id[UK] | - | - | api_key[ENC],credits_per_call[CR]
api_service_actions[S3PF] | id[PK] | service_id+action_type[UK] | service_id->api_services[FK] | status[IX] | credits[CR]

Smart Teaching - 11 tables
teaching_modules[E7SF] | id[PK] | - | creator_id->users,owner_group_id->user_groups,deleted_by->users[FK] | visibility,status,is_deleted[IX] | deleted_at[SD]
teaching_lessons[E7SJF] | id[PK] | - | module_id->teaching_modules,creator_id->users,deleted_by->users[FK] | content_type,status,is_deleted[IX] | materials,content[JS],deleted_at[SD]
teaching_permissions[E5F] | id[PK] | module_id+lesson_id+user_id/group_id/tag_id+permission_type[UK] | module_id->teaching_modules,user_id->users,group_id->user_groups,tag_id->user_tags[FK] | permission_type[IX] | expires_at[DT]
teaching_module_groups[E3F] | id[PK] | - | - | - | -
teaching_module_group_relations[T3F] | id[PK] | - | module_id->teaching_modules,group_id->teaching_module_groups[FK] | - | -
teaching_global_authorizations[E5J] | id[PK] | - | - | - | permissions[JS]
teaching_lesson_plans[E3J] | id[PK] | - | lesson_id->teaching_lessons,user_id->users[FK] | - | content[JS]
teaching_lesson_drafts[E3J] | id[PK] | - | lesson_id->teaching_lessons,user_id->users[FK] | - | draft_content[JS]
teaching_view_logs[L5F] | id[PK] | - | module_id->teaching_modules,lesson_id->teaching_lessons,user_id->users[FK] | created_at[IX] | -
teaching_permissions_backup_20251031[L1] | - | - | - | - | BACKUP
teaching_global_authorizations_backup_20251109_122011[L1] | - | - | - | - | BACKUP

Image Generation - 4 tables
image_models[S5PJ] | id[PK] | - | - | - | api_key[ENC],sizes_supported[JS],price_per_image[CR]
image_generations[C7PSJF] | id[PK] | - | user_id->users,model_id->image_models,parent_id->image_generations[FK] | task_id,status,is_public[IX] | buttons[JS],credits_consumed[CR]
midjourney_tasks[C5J] | id[PK] | - | user_id->users[FK] | task_id[IX] | response_data[JS]
gemini_files[L3] | id[PK] | - | - | - | -

Video Generation - 2 tables
video_models[S5PJ] | id[PK] | - | - | - | api_config[JS],price_multiplier[CR]
video_generations[C7PSJF] | id[PK] | - | user_id->users,model_id->video_models[FK] | task_id,status,is_public,provider[IX] | raw_response[JS],credits_consumed[CR]

HTML Editor - 5 tables
html_projects[E5SF] | id[PK] | - | user_id->users[FK] | is_default[IX] | deleted_at[SD]
html_pages[E7SJ] | id[PK] | user_id+slug[UK] | project_id->html_projects,user_id->users[FK] | is_published,view_count[IX] | compiled_content[TEXT],credits_consumed[CR]
html_templates[E3] | id[PK] | - | - | - | content[TEXT]
html_resources[E3] | id[PK] | - | - | - | -
html_pages_slug_backup[L1] | - | - | - | - | BACKUP

Storage System - 3 tables
user_folders[S7SF] | id[PK] | - | user_id->users,parent_id->user_folders,group_id->user_groups[FK] | folder_type,is_deleted[IX] | is_deleted[SD]
user_files[S7SF] | id[PK] | - | user_id->users,folder_id->user_folders,uploaded_by->users[FK] | is_deleted[IX] | is_deleted,deleted_at[SD]
user_storage[S5] | id[PK] | - | user_id->users[FK] | - | storage_used,quota[INT]

Smart Calendar - 8 tables
calendar_events[E5F] | id[PK] | - | user_id->users,parent_event_id->calendar_events[FK] | event_date,status,category[IX] | -
calendar_categories[E3] | id[PK] | - | user_id->users[FK] | - | -
calendar_ai_analyses[E5PJ] | id[PK] | - | user_id->users[FK] | analysis_date[IX] | ai_response[JS],credits_used[CR]
calendar_background_knowledge[E3J] | id[PK] | - | user_id->users[FK] | - | knowledge_content[JS]
calendar_config[S3P] | id[PK] | - | - | - | credit_multiplier[CR]
calendar_prompt_templates[E3] | id[PK] | - | - | - | template[TEXT]
calendar_prompt_templates_backup_20251011[L1] | - | - | - | - | BACKUP
calendar_user_settings[E3J] | id[PK] | - | user_id->users[FK] | - | settings[JS]

OCR - 2 tables
ocr_tasks[C5PF] | id[PK] | - | user_id->users[FK] | status[IX] | credits_consumed[CR]
ocr_results[C5J] | id[PK] | - | task_id->ocr_tasks[FK] | - | ocr_result[JS]

Wiki Knowledge Base - 3 tables
wiki_items[W7SJF] | id[PK] | - | creator_id->users,group_id->user_groups[FK] | scope,is_pinned,creator_id,group_id[IX] | notes[JS],links[JS],content[TEXT],current_version[INT],version_count[INT]
wiki_versions[W5JF] | id[PK] | wiki_id+version_number[UK] | wiki_id->wiki_items,created_by->users[FK] | wiki_id,version_number[IX] | notes_snapshot[JS],links_snapshot[JS],content[TEXT],change_summary[VARCHAR]
wiki_editors[W3F] | id[PK] | wiki_id+user_id[UK] | wiki_id->wiki_items,user_id->users,added_by->users[FK] | wiki_id[IX] | -

Other System - 11 tables
org_applications[S3] | id[PK] | - | - | - | -
application_form_config[S3J] | id[PK] | - | - | - | form_config[JS]
user_mindmaps[C3PJ] | id[PK] | - | user_id->users[FK] | - | mindmap_data[JS],credits_consumed[CR]
file_shares[C3F] | id[PK] | - | file_id->files,shared_by->users[FK] | - | expires_at[DT]
oss_config[S3J] | id[PK] | - | - | - | config[JS]
system_settings[S9J] | id[PK] | setting_key[UK] | - | - | setting_value[TEXT]
migrations_history[L3] | id[PK] | - | - | - | -
schema_migrations[L3] | version[PK] | - | - | - | -
casbin_rule[S5] | id[PK] | - | - | - | -
casbin_deny_policies[S3] | id[PK] | - | - | - | -
casbin_metadata[S3] | id[PK] | - | - | - | -

Views - 3
v_teaching_permission_hierarchy[VIEW] | Teaching permission hierarchy view
v_user_accessible_teaching_modules[VIEW] | User accessible modules view
v_user_tags_detail[VIEW] | User tags detail view

===AI Application Platform Database Full Index-20260123-Complete===
